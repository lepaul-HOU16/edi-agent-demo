{
  "version": 3,
  "sources": ["../../../lambda-functions/shared/proximityDetector.ts", "../../../lambda-functions/shared/projectLifecycleManager.ts", "../../../lambda-functions/renewable-orchestrator/handler.ts", "../../../lambda-functions/renewable-orchestrator/RenewableIntentClassifier.ts", "../../../lambda-functions/renewable-orchestrator/IntentRouter.ts", "../../../lambda-functions/renewable-orchestrator/parameterValidator.ts", "../../../lambda-functions/shared/projectStore.ts", "../../../lambda-functions/shared/projectNameGenerator.ts", "../../../lambda-functions/shared/sessionContextManager.ts", "../../../lambda-functions/shared/projectResolver.ts", "../../../lambda-functions/shared/errorMessageTemplates.ts", "../../../lambda-functions/shared/actionButtonTypes.ts", "../../../lambda-functions/shared/projectListHandler.ts", "../../../lambda-functions/renewable-orchestrator/strandsAgentHandler.ts"],
  "sourcesContent": ["/**\n * ProximityDetector Module\n * \n * Provides geospatial proximity detection for renewable energy projects.\n * Uses Haversine formula for accurate distance calculations between coordinates.\n * \n * Requirements: 1.1, 1.2, 1.6, 4.1\n */\n\nimport { ProjectData } from './projectStore';\n\n/**\n * Coordinates interface for latitude/longitude pairs\n */\nexport interface Coordinates {\n  latitude: number;\n  longitude: number;\n}\n\n/**\n * Result of duplicate detection with distance information\n */\nexport interface DuplicateMatch {\n  project: ProjectData;\n  distanceKm: number;\n}\n\n/**\n * Grouped duplicates by location\n */\nexport interface DuplicateGroup {\n  centerCoordinates: Coordinates;\n  projects: ProjectData[];\n  count: number;\n  averageDistance: number;\n}\n\n/**\n * ProximityDetector class for geospatial operations\n */\nexport class ProximityDetector {\n  private static readonly EARTH_RADIUS_KM = 6371;\n  private static readonly DEFAULT_RADIUS_KM = 1.0;\n\n  /**\n   * Calculate distance between two coordinates using Haversine formula\n   * \n   * @param coord1 First coordinate\n   * @param coord2 Second coordinate\n   * @returns Distance in kilometers\n   */\n  public calculateDistance(coord1: Coordinates, coord2: Coordinates): number {\n    // Validate coordinates\n    this.validateCoordinates(coord1);\n    this.validateCoordinates(coord2);\n\n    const dLat = this.toRadians(coord2.latitude - coord1.latitude);\n    const dLon = this.toRadians(coord2.longitude - coord1.longitude);\n\n    const a =\n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(this.toRadians(coord1.latitude)) *\n        Math.cos(this.toRadians(coord2.latitude)) *\n        Math.sin(dLon / 2) *\n        Math.sin(dLon / 2);\n\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    const distance = ProximityDetector.EARTH_RADIUS_KM * c;\n\n    return distance;\n  }\n\n  /**\n   * Find projects within specified radius of given coordinates\n   * \n   * @param projects Array of projects to search\n   * @param targetCoordinates Center point for search\n   * @param radiusKm Search radius in kilometers (default: 1km)\n   * @returns Array of projects within radius, sorted by distance\n   */\n  public findProjectsWithinRadius(\n    projects: ProjectData[],\n    targetCoordinates: Coordinates,\n    radiusKm: number = ProximityDetector.DEFAULT_RADIUS_KM\n  ): DuplicateMatch[] {\n    // Validate inputs\n    this.validateCoordinates(targetCoordinates);\n    if (radiusKm <= 0) {\n      throw new Error('Radius must be greater than 0');\n    }\n\n    const matches: DuplicateMatch[] = [];\n\n    for (const project of projects) {\n      // Skip projects without coordinates\n      if (!project.coordinates) {\n        continue;\n      }\n\n      const projectCoords: Coordinates = {\n        latitude: project.coordinates.latitude,\n        longitude: project.coordinates.longitude,\n      };\n\n      const distance = this.calculateDistance(targetCoordinates, projectCoords);\n\n      // Include projects within radius\n      if (distance <= radiusKm) {\n        matches.push({\n          project,\n          distanceKm: distance,\n        });\n      }\n    }\n\n    // Sort by distance (closest first)\n    matches.sort((a, b) => a.distanceKm - b.distanceKm);\n\n    return matches;\n  }\n\n  /**\n   * Group projects by proximity to detect duplicates\n   * \n   * @param projects Array of projects to analyze\n   * @param radiusKm Grouping radius in kilometers (default: 1km)\n   * @returns Array of duplicate groups\n   */\n  public groupDuplicates(\n    projects: ProjectData[],\n    radiusKm: number = ProximityDetector.DEFAULT_RADIUS_KM\n  ): DuplicateGroup[] {\n    // Filter projects with valid coordinates\n    const projectsWithCoords = projects.filter(\n      (p) => p.coordinates && p.coordinates.latitude && p.coordinates.longitude\n    );\n\n    if (projectsWithCoords.length === 0) {\n      return [];\n    }\n\n    const groups: DuplicateGroup[] = [];\n    const processed = new Set<string>();\n\n    for (const project of projectsWithCoords) {\n      // Skip if already processed\n      if (processed.has(project.project_name)) {\n        continue;\n      }\n\n      const projectCoords: Coordinates = {\n        latitude: project.coordinates!.latitude,\n        longitude: project.coordinates!.longitude,\n      };\n\n      // Find all projects within radius\n      const nearbyProjects = this.findProjectsWithinRadius(\n        projectsWithCoords,\n        projectCoords,\n        radiusKm\n      );\n\n      // Only create group if there are multiple projects\n      if (nearbyProjects.length > 1) {\n        // Mark all projects in this group as processed\n        nearbyProjects.forEach((match) => {\n          processed.add(match.project.project_name);\n        });\n\n        // Calculate average distance\n        const totalDistance = nearbyProjects.reduce(\n          (sum, match) => sum + match.distanceKm,\n          0\n        );\n        const averageDistance = totalDistance / nearbyProjects.length;\n\n        groups.push({\n          centerCoordinates: projectCoords,\n          projects: nearbyProjects.map((m) => m.project),\n          count: nearbyProjects.length,\n          averageDistance,\n        });\n      } else {\n        // Mark single project as processed\n        processed.add(project.project_name);\n      }\n    }\n\n    // Sort groups by count (largest first)\n    groups.sort((a, b) => b.count - a.count);\n\n    return groups;\n  }\n\n  /**\n   * Check if coordinates are within valid range\n   * \n   * @param coords Coordinates to validate\n   * @throws Error if coordinates are invalid\n   */\n  private validateCoordinates(coords: Coordinates): void {\n    if (\n      coords.latitude < -90 ||\n      coords.latitude > 90 ||\n      coords.longitude < -180 ||\n      coords.longitude > 180\n    ) {\n      throw new Error(\n        `Invalid coordinates: latitude must be between -90 and 90, longitude must be between -180 and 180. Got: ${coords.latitude}, ${coords.longitude}`\n      );\n    }\n  }\n\n  /**\n   * Convert degrees to radians\n   * \n   * @param degrees Angle in degrees\n   * @returns Angle in radians\n   */\n  private toRadians(degrees: number): number {\n    return (degrees * Math.PI) / 180;\n  }\n\n  /**\n   * Calculate bounding box for optimization (future enhancement)\n   * Can be used to filter projects before calculating exact distances\n   * \n   * @param center Center coordinates\n   * @param radiusKm Radius in kilometers\n   * @returns Bounding box coordinates\n   */\n  public getBoundingBox(\n    center: Coordinates,\n    radiusKm: number\n  ): {\n    minLat: number;\n    maxLat: number;\n    minLon: number;\n    maxLon: number;\n  } {\n    this.validateCoordinates(center);\n\n    // Approximate degrees per kilometer\n    const latDegreesPerKm = 1 / 111.32;\n    const lonDegreesPerKm =\n      1 / (111.32 * Math.cos(this.toRadians(center.latitude)));\n\n    const latDelta = radiusKm * latDegreesPerKm;\n    const lonDelta = radiusKm * lonDegreesPerKm;\n\n    return {\n      minLat: Math.max(-90, center.latitude - latDelta),\n      maxLat: Math.min(90, center.latitude + latDelta),\n      minLon: Math.max(-180, center.longitude - lonDelta),\n      maxLon: Math.min(180, center.longitude + lonDelta),\n    };\n  }\n\n  /**\n   * Check if a project is within bounding box (optimization helper)\n   * \n   * @param project Project to check\n   * @param boundingBox Bounding box to check against\n   * @returns True if project is within bounding box\n   */\n  public isWithinBoundingBox(\n    project: ProjectData,\n    boundingBox: {\n      minLat: number;\n      maxLat: number;\n      minLon: number;\n      maxLon: number;\n    }\n  ): boolean {\n    if (!project.coordinates) {\n      return false;\n    }\n\n    const { latitude, longitude } = project.coordinates;\n\n    return (\n      latitude >= boundingBox.minLat &&\n      latitude <= boundingBox.maxLat &&\n      longitude >= boundingBox.minLon &&\n      longitude <= boundingBox.maxLon\n    );\n  }\n}\n", "/**\n * ProjectLifecycleManager - Core class for project lifecycle operations\n * \n * Manages project lifecycle including:\n * - Deduplication detection and resolution\n * - Project deletion (single and bulk)\n * - Project renaming\n * - Project merging\n * - Project archiving/unarchiving\n * - Project search and filtering\n * - Export/import functionality\n * \n * Requirements: All\n */\n\nimport { ProjectStore, ProjectData } from './projectStore';\nimport { ProjectResolver } from './projectResolver';\nimport { ProjectNameGenerator } from './projectNameGenerator';\nimport { SessionContextManager, SessionContext } from './sessionContextManager';\nimport { ProximityDetector, Coordinates, DuplicateMatch, DuplicateGroup } from './proximityDetector';\n\n// ============================================================================\n// Result Type Interfaces\n// ============================================================================\n\n/**\n * Result of duplicate detection\n */\nexport interface DuplicateDetectionResult {\n  hasDuplicates: boolean;\n  duplicates: DuplicateMatch[];\n  message?: string;\n}\n\n/**\n * User's choice for duplicate resolution\n */\nexport interface DuplicateResolutionChoice {\n  action: 'continue' | 'create_new' | 'view_details';\n  selectedProject?: string;\n}\n\n/**\n * Result of project deletion\n */\nexport interface DeleteResult {\n  success: boolean;\n  projectName: string;\n  message: string;\n  error?: string;\n}\n\n/**\n * Result of bulk deletion\n */\nexport interface BulkDeleteResult {\n  success: boolean;\n  deletedCount: number;\n  deletedProjects: string[];\n  failedProjects: Array<{ name: string; error: string }>;\n  message: string;\n}\n\n/**\n * Result of project rename\n */\nexport interface RenameResult {\n  success: boolean;\n  oldName: string;\n  newName: string;\n  message: string;\n  error?: string;\n}\n\n/**\n * Result of project merge\n */\nexport interface MergeResult {\n  success: boolean;\n  mergedProject: string;\n  deletedProject: string;\n  message: string;\n  error?: string;\n}\n\n/**\n * Result of archive operation\n */\nexport interface ArchiveResult {\n  success: boolean;\n  projectName: string;\n  message: string;\n  error?: string;\n}\n\n/**\n * Result of unarchive operation\n */\nexport interface UnarchiveResult {\n  success: boolean;\n  projectName: string;\n  message: string;\n  error?: string;\n}\n\n/**\n * Result of import operation\n */\nexport interface ImportResult {\n  success: boolean;\n  projectName: string;\n  message: string;\n  error?: string;\n}\n\n/**\n * Export data structure\n */\nexport interface ExportData {\n  version: string;\n  exportedAt: string;\n  project: ProjectData;\n  artifacts: {\n    terrain?: string;\n    layout?: string;\n    simulation?: string;\n    report?: string;\n  };\n}\n\n/**\n * Search criteria for filtering projects\n */\nexport interface ProjectSearchFilters {\n  location?: string;\n  dateFrom?: string;\n  dateTo?: string;\n  incomplete?: boolean;\n  coordinates?: Coordinates;\n  radiusKm?: number;\n  archived?: boolean;\n}\n\n/**\n * Project dashboard data\n */\nexport interface ProjectDashboard {\n  projects: Array<{\n    name: string;\n    location: string;\n    completionPercentage: number;\n    lastUpdated: string;\n    isActive: boolean;\n    isDuplicate: boolean;\n    status: string;\n  }>;\n  totalProjects: number;\n  activeProject: string | null;\n  duplicateGroups: DuplicateGroup[];\n}\n\n// ============================================================================\n// Error Types and Messages\n// ============================================================================\n\n/**\n * Error types for lifecycle operations\n */\nexport enum ProjectLifecycleError {\n  PROJECT_NOT_FOUND = 'PROJECT_NOT_FOUND',\n  NAME_ALREADY_EXISTS = 'NAME_ALREADY_EXISTS',\n  PROJECT_IN_PROGRESS = 'PROJECT_IN_PROGRESS',\n  CONFIRMATION_REQUIRED = 'CONFIRMATION_REQUIRED',\n  INVALID_COORDINATES = 'INVALID_COORDINATES',\n  S3_ERROR = 'S3_ERROR',\n  UNSUPPORTED_VERSION = 'UNSUPPORTED_VERSION',\n  INVALID_PROJECT_NAME = 'INVALID_PROJECT_NAME',\n  MERGE_CONFLICT = 'MERGE_CONFLICT',\n  EXPORT_ERROR = 'EXPORT_ERROR',\n  IMPORT_ERROR = 'IMPORT_ERROR',\n  INVALID_SEARCH_RADIUS = 'INVALID_SEARCH_RADIUS',\n}\n\n/**\n * Error message templates with user-friendly formatting and suggested actions\n */\nexport const ERROR_MESSAGES = {\n  PROJECT_NOT_FOUND: (name: string) =>\n    `Project '${name}' not found. Use 'list projects' to see available projects.`,\n\n  NAME_ALREADY_EXISTS: (name: string) =>\n    `Project name '${name}' already exists. Please choose a different name.`,\n\n  PROJECT_IN_PROGRESS: (name: string) =>\n    `Cannot delete '${name}' - project is currently being processed. Please wait for completion.`,\n\n  CONFIRMATION_REQUIRED: (action: string, target: string) =>\n    `Are you sure you want to ${action} '${target}'? Type 'yes' to confirm.`,\n\n  S3_ERROR: (operation: string) =>\n    `Failed to ${operation} due to storage error. Please try again.`,\n\n  INVALID_COORDINATES: (coords: string) =>\n    `Invalid coordinates: ${coords}. Latitude must be between -90 and 90, longitude between -180 and 180.`,\n\n  UNSUPPORTED_VERSION: (version: string) =>\n    `Unsupported export version: ${version}. This system supports version 1.0.`,\n\n  INVALID_PROJECT_NAME: (name: string) =>\n    `Invalid project name: '${name}'. Project names must be lowercase with hyphens (kebab-case).`,\n\n  MERGE_CONFLICT: (name1: string, name2: string) =>\n    `Cannot merge projects '${name1}' and '${name2}'. Both projects must exist and have compatible data.`,\n\n  EXPORT_ERROR: (name: string, reason: string) =>\n    `Failed to export project '${name}': ${reason}`,\n\n  IMPORT_ERROR: (reason: string) =>\n    `Failed to import project: ${reason}`,\n\n  // Search and filtering error messages (Requirements 5.1-5.5)\n  NO_PROJECTS_FOUND: (criteria: string) =>\n    `No projects found matching: ${criteria}`,\n\n  INVALID_DATE_RANGE: (dateFrom: string, dateTo: string) =>\n    `Invalid date range: ${dateFrom} to ${dateTo}. Start date must be before end date.`,\n\n  INVALID_SEARCH_RADIUS: (radius: number) =>\n    `Invalid search radius: ${radius}km. Radius must be between 0.1 and 100 km.`,\n\n  NO_LOCATION_MATCH: (location: string) =>\n    `No projects found in location: ${location}`,\n\n  NO_INCOMPLETE_PROJECTS: () =>\n    `No incomplete projects found. All projects have completed analysis.`,\n\n  NO_ARCHIVED_PROJECTS: () =>\n    `No archived projects found.`,\n\n  SEARCH_ERROR: (reason: string) =>\n    `Search failed: ${reason}`,\n};\n\n/**\n * User-friendly error message formatter with context and suggestions\n */\nexport class LifecycleErrorFormatter {\n  /**\n   * Format project not found error with suggestions\n   */\n  static formatProjectNotFound(projectName: string, availableProjects: string[]): string {\n    let message = `\u274C Project '${projectName}' not found.\\n\\n`;\n    \n    if (availableProjects.length > 0) {\n      message += `**Available projects:**\\n`;\n      availableProjects.slice(0, 5).forEach((name, index) => {\n        message += `${index + 1}. ${name}\\n`;\n      });\n      \n      if (availableProjects.length > 5) {\n        message += `... and ${availableProjects.length - 5} more\\n`;\n      }\n      \n      message += `\\n**Suggestions:**\\n`;\n      message += `\u2022 Use 'list projects' to see all projects\\n`;\n      message += `\u2022 Check spelling of project name\\n`;\n      message += `\u2022 Try searching: 'search projects in [location]'\\n`;\n    } else {\n      message += `**No projects exist yet.**\\n\\n`;\n      message += `**Get started:**\\n`;\n      message += `\u2022 Create a project: 'analyze terrain at [latitude], [longitude]'\\n`;\n      message += `\u2022 Import a project: 'import project from [file]'\\n`;\n    }\n    \n    return message;\n  }\n\n  /**\n   * Format search results with context\n   */\n  static formatSearchResults(\n    projects: ProjectData[],\n    filters: ProjectSearchFilters\n  ): string {\n    if (projects.length === 0) {\n      return this.formatNoSearchResults(filters);\n    }\n\n    let message = `**Found ${projects.length} project(s)**\\n\\n`;\n    \n    // Show applied filters\n    const appliedFilters: string[] = [];\n    if (filters.location) appliedFilters.push(`Location: ${filters.location}`);\n    if (filters.dateFrom) appliedFilters.push(`From: ${filters.dateFrom}`);\n    if (filters.dateTo) appliedFilters.push(`To: ${filters.dateTo}`);\n    if (filters.incomplete) appliedFilters.push(`Status: Incomplete`);\n    if (filters.archived !== undefined) appliedFilters.push(`Archived: ${filters.archived}`);\n    if (filters.coordinates) {\n      appliedFilters.push(\n        `Near: ${filters.coordinates.latitude}, ${filters.coordinates.longitude} (${filters.radiusKm}km)`\n      );\n    }\n    \n    if (appliedFilters.length > 0) {\n      message += `**Filters:** ${appliedFilters.join(' | ')}\\n\\n`;\n    }\n    \n    // List projects\n    projects.forEach((project, index) => {\n      const completion = this.calculateCompletionPercentage(project);\n      const status = this.getProjectStatus(project);\n      message += `${index + 1}. **${project.project_name}**\\n`;\n      message += `   Status: ${status} (${completion}% complete)\\n`;\n      message += `   Created: ${new Date(project.created_at).toLocaleDateString()}\\n`;\n      if (project.coordinates) {\n        message += `   Location: ${project.coordinates.latitude.toFixed(4)}, ${project.coordinates.longitude.toFixed(4)}\\n`;\n      }\n      message += `\\n`;\n    });\n    \n    return message;\n  }\n\n  /**\n   * Format no search results with suggestions\n   */\n  static formatNoSearchResults(filters: ProjectSearchFilters): string {\n    let message = `\u274C No projects found matching your search criteria.\\n\\n`;\n    \n    message += `**Your search:**\\n`;\n    if (filters.location) message += `\u2022 Location: ${filters.location}\\n`;\n    if (filters.dateFrom) message += `\u2022 From: ${filters.dateFrom}\\n`;\n    if (filters.dateTo) message += `\u2022 To: ${filters.dateTo}\\n`;\n    if (filters.incomplete) message += `\u2022 Status: Incomplete only\\n`;\n    if (filters.archived !== undefined) message += `\u2022 Archived: ${filters.archived}\\n`;\n    if (filters.coordinates) {\n      message += `\u2022 Near: ${filters.coordinates.latitude}, ${filters.coordinates.longitude} (${filters.radiusKm}km)\\n`;\n    }\n    \n    message += `\\n**Suggestions:**\\n`;\n    message += `\u2022 Try broader search criteria\\n`;\n    message += `\u2022 Remove some filters\\n`;\n    message += `\u2022 Use 'list projects' to see all projects\\n`;\n    message += `\u2022 Check if projects are archived: 'list archived projects'\\n`;\n    \n    return message;\n  }\n\n  /**\n   * Format duplicate projects with action suggestions\n   */\n  static formatDuplicateGroups(groups: DuplicateGroup[]): string {\n    if (groups.length === 0) {\n      return `\u2705 No duplicate projects found. All projects are at unique locations.\\n`;\n    }\n\n    let message = `**Found ${groups.length} group(s) of duplicate projects:**\\n\\n`;\n    \n    groups.forEach((group, groupIndex) => {\n      message += `**Group ${groupIndex + 1}** (${group.count} projects, avg distance: ${group.averageDistance.toFixed(2)}km):\\n`;\n      message += `Location: ${group.centerCoordinates.latitude.toFixed(4)}, ${group.centerCoordinates.longitude.toFixed(4)}\\n\\n`;\n      \n      group.projects.forEach((project, projIndex) => {\n        const completion = this.calculateCompletionPercentage(project);\n        message += `  ${projIndex + 1}. ${project.project_name} (${completion}% complete)\\n`;\n      });\n      \n      message += `\\n**Actions:**\\n`;\n      message += `\u2022 Merge projects: 'merge projects ${group.projects[0].project_name} and ${group.projects[1].project_name}'\\n`;\n      message += `\u2022 Delete duplicates: 'delete project ${group.projects[1].project_name}'\\n`;\n      message += `\u2022 View details: 'show project ${group.projects[0].project_name}'\\n\\n`;\n    });\n    \n    return message;\n  }\n\n  /**\n   * Format deletion confirmation with project details\n   */\n  static formatDeleteConfirmation(project: ProjectData): string {\n    const completion = this.calculateCompletionPercentage(project);\n    const status = this.getProjectStatus(project);\n    \n    let message = `\u26A0\uFE0F  **Confirm Deletion**\\n\\n`;\n    message += `You are about to delete:\\n`;\n    message += `\u2022 Project: **${project.project_name}**\\n`;\n    message += `\u2022 Status: ${status} (${completion}% complete)\\n`;\n    message += `\u2022 Created: ${new Date(project.created_at).toLocaleDateString()}\\n`;\n    \n    if (project.coordinates) {\n      message += `\u2022 Location: ${project.coordinates.latitude.toFixed(4)}, ${project.coordinates.longitude.toFixed(4)}\\n`;\n    }\n    \n    message += `\\n**This will permanently remove:**\\n`;\n    if (project.terrain_results) message += `\u2022 Terrain analysis data\\n`;\n    if (project.layout_results) message += `\u2022 Layout optimization data\\n`;\n    if (project.simulation_results) message += `\u2022 Wake simulation results\\n`;\n    if (project.report_results) message += `\u2022 Generated reports\\n`;\n    \n    message += `\\n**Type 'yes' to confirm deletion, or 'no' to cancel.**\\n`;\n    \n    return message;\n  }\n\n  /**\n   * Format bulk deletion confirmation\n   */\n  static formatBulkDeleteConfirmation(projects: ProjectData[], pattern: string): string {\n    let message = `\u26A0\uFE0F  **Confirm Bulk Deletion**\\n\\n`;\n    message += `You are about to delete ${projects.length} project(s) matching pattern: **${pattern}**\\n\\n`;\n    \n    message += `**Projects to be deleted:**\\n`;\n    projects.forEach((project, index) => {\n      const completion = this.calculateCompletionPercentage(project);\n      message += `${index + 1}. ${project.project_name} (${completion}% complete)\\n`;\n    });\n    \n    message += `\\n**This action cannot be undone.**\\n`;\n    message += `**Type 'yes' to confirm deletion, or 'no' to cancel.**\\n`;\n    \n    return message;\n  }\n\n  /**\n   * Format merge confirmation with project comparison\n   */\n  static formatMergeConfirmation(\n    sourceProject: ProjectData,\n    targetProject: ProjectData\n  ): string {\n    let message = `\uD83D\uDD00 **Confirm Project Merge**\\n\\n`;\n    message += `Merging: **${sourceProject.project_name}** \u2192 **${targetProject.project_name}**\\n\\n`;\n    \n    message += `**Source Project (will be deleted):**\\n`;\n    message += this.formatProjectSummary(sourceProject);\n    \n    message += `\\n**Target Project (will be kept):**\\n`;\n    message += this.formatProjectSummary(targetProject);\n    \n    message += `\\n**Merge strategy:**\\n`;\n    message += `\u2022 Keep most complete data from both projects\\n`;\n    message += `\u2022 Preserve all analysis results\\n`;\n    message += `\u2022 Delete source project after merge\\n`;\n    \n    message += `\\n**Which name would you like to keep?**\\n`;\n    message += `1. ${sourceProject.project_name}\\n`;\n    message += `2. ${targetProject.project_name}\\n`;\n    \n    return message;\n  }\n\n  /**\n   * Format project summary for display\n   */\n  private static formatProjectSummary(project: ProjectData): string {\n    const completion = this.calculateCompletionPercentage(project);\n    let summary = `\u2022 Name: ${project.project_name}\\n`;\n    summary += `\u2022 Completion: ${completion}%\\n`;\n    summary += `\u2022 Terrain: ${project.terrain_results ? '\u2713' : '\u2717'}\\n`;\n    summary += `\u2022 Layout: ${project.layout_results ? '\u2713' : '\u2717'}\\n`;\n    summary += `\u2022 Simulation: ${project.simulation_results ? '\u2713' : '\u2717'}\\n`;\n    summary += `\u2022 Report: ${project.report_results ? '\u2713' : '\u2717'}\\n`;\n    return summary;\n  }\n\n  /**\n   * Calculate completion percentage\n   */\n  private static calculateCompletionPercentage(project: ProjectData): number {\n    let completed = 0;\n    const total = 4;\n    if (project.terrain_results) completed++;\n    if (project.layout_results) completed++;\n    if (project.simulation_results) completed++;\n    if (project.report_results) completed++;\n    return Math.round((completed / total) * 100);\n  }\n\n  /**\n   * Get project status\n   */\n  private static getProjectStatus(project: ProjectData): string {\n    if (project.report_results) return 'Complete';\n    if (project.simulation_results) return 'Simulation Complete';\n    if (project.layout_results) return 'Layout Complete';\n    if (project.terrain_results) return 'Terrain Complete';\n    return 'Not Started';\n  }\n\n  /**\n   * Format archive suggestion for old projects\n   */\n  static formatArchiveSuggestion(oldProjects: ProjectData[]): string {\n    if (oldProjects.length === 0) {\n      return '';\n    }\n\n    let message = `\uD83D\uDCA1 **Suggestion:** You have ${oldProjects.length} project(s) older than 30 days with no recent activity.\\n\\n`;\n    message += `**Consider archiving:**\\n`;\n    \n    oldProjects.slice(0, 5).forEach((project, index) => {\n      const daysSinceUpdate = Math.floor(\n        (Date.now() - new Date(project.updated_at).getTime()) / (1000 * 60 * 60 * 24)\n      );\n      message += `${index + 1}. ${project.project_name} (${daysSinceUpdate} days old)\\n`;\n    });\n    \n    if (oldProjects.length > 5) {\n      message += `... and ${oldProjects.length - 5} more\\n`;\n    }\n    \n    message += `\\n**Archive projects to:**\\n`;\n    message += `\u2022 Keep your project list clean\\n`;\n    message += `\u2022 Preserve historical data\\n`;\n    message += `\u2022 Improve performance\\n`;\n    \n    message += `\\n**Example:** 'archive project ${oldProjects[0].project_name}'\\n`;\n    \n    return message;\n  }\n\n  /**\n   * Format validation error with context\n   */\n  static formatValidationError(\n    errorType: ProjectLifecycleError,\n    context: Record<string, any>\n  ): string {\n    switch (errorType) {\n      case ProjectLifecycleError.INVALID_COORDINATES:\n        return `\u274C Invalid coordinates: ${context.coordinates}\\n\\n` +\n               `**Requirements:**\\n` +\n               `\u2022 Latitude: -90 to 90\\n` +\n               `\u2022 Longitude: -180 to 180\\n\\n` +\n               `**Example:** 'analyze terrain at 35.067482, -101.395466'\\n`;\n\n      case ProjectLifecycleError.INVALID_PROJECT_NAME:\n        return `\u274C Invalid project name: '${context.name}'\\n\\n` +\n               `**Requirements:**\\n` +\n               `\u2022 Lowercase letters only\\n` +\n               `\u2022 Use hyphens (-) instead of spaces\\n` +\n               `\u2022 No special characters\\n\\n` +\n               `**Examples:**\\n` +\n               `\u2022 west-texas-wind-farm \u2713\\n` +\n               `\u2022 West Texas Wind Farm \u2717\\n` +\n               `\u2022 west_texas_wind_farm \u2717\\n`;\n\n      case ProjectLifecycleError.INVALID_SEARCH_RADIUS:\n        return `\u274C Invalid search radius: ${context.radius}km\\n\\n` +\n               `**Requirements:**\\n` +\n               `\u2022 Minimum: 0.1 km\\n` +\n               `\u2022 Maximum: 100 km\\n\\n` +\n               `**Example:** 'search projects within 5km of 35.067482, -101.395466'\\n`;\n\n      default:\n        return `\u274C Validation error: ${errorType}\\n`;\n    }\n  }\n}\n\n// ============================================================================\n// ProjectLifecycleManager Class\n// ============================================================================\n\n/**\n * Main class for managing project lifecycle operations\n */\nexport class ProjectLifecycleManager {\n  private projectStore: ProjectStore;\n  private projectResolver: ProjectResolver;\n  private projectNameGenerator: ProjectNameGenerator;\n  private sessionContextManager: SessionContextManager;\n  private proximityDetector: ProximityDetector;\n\n  /**\n   * Constructor\n   * \n   * @param projectStore - Project storage service\n   * @param projectResolver - Project name resolution service\n   * @param projectNameGenerator - Project name generation service\n   * @param sessionContextManager - Session context management service\n   */\n  constructor(\n    projectStore: ProjectStore,\n    projectResolver: ProjectResolver,\n    projectNameGenerator: ProjectNameGenerator,\n    sessionContextManager: SessionContextManager\n  ) {\n    this.projectStore = projectStore;\n    this.projectResolver = projectResolver;\n    this.projectNameGenerator = projectNameGenerator;\n    this.sessionContextManager = sessionContextManager;\n    this.proximityDetector = new ProximityDetector();\n\n    console.log('[ProjectLifecycleManager] Initialized');\n  }\n\n  // ============================================================================\n  // Deduplication Methods\n  // ============================================================================\n\n  /**\n   * Detect duplicate projects at given coordinates\n   * \n   * @param coordinates - Target coordinates\n   * @param radiusKm - Search radius in kilometers (default: 1km)\n   * @returns Duplicate detection result\n   */\n  async detectDuplicates(\n    coordinates: Coordinates,\n    radiusKm: number = 1.0\n  ): Promise<DuplicateDetectionResult> {\n    try {\n      console.log('[ProjectLifecycleManager] Detecting duplicates at:', coordinates);\n\n      // Get all projects\n      const allProjects = await this.projectStore.list();\n\n      // Find projects within radius\n      const matches = this.proximityDetector.findProjectsWithinRadius(\n        allProjects,\n        coordinates,\n        radiusKm\n      );\n\n      const hasDuplicates = matches.length > 0;\n\n      if (hasDuplicates) {\n        console.log(`[ProjectLifecycleManager] Found ${matches.length} duplicate(s)`);\n      }\n\n      return {\n        hasDuplicates,\n        duplicates: matches,\n        message: hasDuplicates\n          ? `Found ${matches.length} existing project(s) within ${radiusKm}km`\n          : 'No existing projects found at this location',\n      };\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error detecting duplicates:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Check for duplicate projects at given coordinates\n   * Combines detection and prompt generation\n   * \n   * @param coordinates - Target coordinates\n   * @param radiusKm - Search radius in kilometers (default: 1km)\n   * @returns Object with hasDuplicates flag and user prompt\n   */\n  async checkForDuplicates(\n    coordinates: Coordinates,\n    radiusKm: number = 1.0\n  ): Promise<{\n    hasDuplicates: boolean;\n    duplicates: DuplicateMatch[];\n    userPrompt: string;\n    message: string;\n  }> {\n    try {\n      console.log('[ProjectLifecycleManager] Checking for duplicates at:', coordinates);\n\n      // Detect duplicates\n      const detectionResult = await this.detectDuplicates(coordinates, radiusKm);\n\n      if (!detectionResult.hasDuplicates) {\n        return {\n          hasDuplicates: false,\n          duplicates: [],\n          userPrompt: '',\n          message: 'No existing projects found at this location',\n        };\n      }\n\n      // Generate user prompt\n      const userPrompt = await this.promptForDuplicateResolution(\n        detectionResult.duplicates.map((d) => d.project),\n        coordinates\n      );\n\n      return {\n        hasDuplicates: true,\n        duplicates: detectionResult.duplicates,\n        userPrompt,\n        message: detectionResult.message || '',\n      };\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error checking for duplicates:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Generate user prompt for duplicate resolution\n   * \n   * @param existingProjects - Array of existing projects found\n   * @param newCoordinates - Coordinates of new project\n   * @returns Formatted prompt message\n   */\n  async promptForDuplicateResolution(\n    existingProjects: ProjectData[],\n    newCoordinates: Coordinates\n  ): Promise<string> {\n    if (existingProjects.length === 0) {\n      return '';\n    }\n\n    const projectList = existingProjects\n      .map((p, index) => {\n        const distance = this.proximityDetector.calculateDistance(\n          newCoordinates,\n          p.coordinates!\n        );\n        return `${index + 1}. ${p.project_name} (${distance.toFixed(2)}km away)`;\n      })\n      .join('\\n');\n\n    return `Found existing project(s) at these coordinates:\\n\\n${projectList}\\n\\nWould you like to:\\n1. Continue with existing project\\n2. Create new project\\n3. View existing project details\\n\\nPlease respond with your choice (1, 2, or 3).`;\n  }\n\n  /**\n   * Handle user's duplicate resolution choice\n   * \n   * @param choice - User's choice (1, 2, or 3)\n   * @param duplicates - Array of duplicate matches\n   * @param sessionId - Session ID for context management\n   * @returns Result with action to take\n   */\n  async handleDuplicateChoice(\n    choice: string,\n    duplicates: DuplicateMatch[],\n    sessionId: string\n  ): Promise<{\n    action: 'continue' | 'create_new' | 'view_details';\n    projectName?: string;\n    message: string;\n  }> {\n    try {\n      console.log(`[ProjectLifecycleManager] Handling duplicate choice: ${choice}`);\n\n      // Parse choice\n      const choiceNum = parseInt(choice.trim());\n\n      if (choiceNum === 1) {\n        // Continue with existing project (use the closest one)\n        const closestProject = duplicates[0].project;\n        \n        // Set as active project\n        await this.sessionContextManager.setActiveProject(sessionId, closestProject.project_name);\n        await this.sessionContextManager.addToHistory(sessionId, closestProject.project_name);\n\n        return {\n          action: 'continue',\n          projectName: closestProject.project_name,\n          message: `Continuing with existing project: ${closestProject.project_name}`,\n        };\n      } else if (choiceNum === 2) {\n        // Create new project\n        return {\n          action: 'create_new',\n          message: 'Creating new project at these coordinates',\n        };\n      } else if (choiceNum === 3) {\n        // View details of existing projects\n        const projectDetails = duplicates\n          .map((d, index) => {\n            const completionStatus = this.calculateCompletionStatus(d.project);\n            return `\\n${index + 1}. ${d.project.project_name} (${d.distanceKm.toFixed(2)}km away)\\n   Created: ${new Date(d.project.created_at).toLocaleDateString()}\\n   Completion: ${completionStatus.percentage}% (${completionStatus.completed}/${completionStatus.total} steps)\\n   Status: ${completionStatus.steps.join(', ')}`;\n          })\n          .join('\\n');\n\n        return {\n          action: 'view_details',\n          message: `Project Details:${projectDetails}\\n\\nWould you like to:\\n1. Continue with existing project\\n2. Create new project`,\n        };\n      } else {\n        return {\n          action: 'create_new',\n          message: 'Invalid choice. Creating new project.',\n        };\n      }\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error handling duplicate choice:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * Calculate completion status for a project\n   * \n   * @param project - Project data\n   * @returns Completion status\n   */\n  private calculateCompletionStatus(project: ProjectData): {\n    percentage: number;\n    completed: number;\n    total: number;\n    steps: string[];\n  } {\n    const steps = [\n      { name: 'Terrain', completed: !!project.terrain_results },\n      { name: 'Layout', completed: !!project.layout_results },\n      { name: 'Simulation', completed: !!project.simulation_results },\n      { name: 'Report', completed: !!project.report_results },\n    ];\n\n    const completed = steps.filter((s) => s.completed).length;\n    const total = steps.length;\n    const percentage = Math.round((completed / total) * 100);\n    const stepNames = steps\n      .map((s) => `${s.name}: ${s.completed ? '\u2713' : '\u2717'}`)\n      .filter((_, i) => steps[i].completed);\n\n    return {\n      percentage,\n      completed,\n      total,\n      steps: stepNames,\n    };\n  }\n\n  // ============================================================================\n  // Deletion Methods\n  // ============================================================================\n\n  /**\n   * Delete a single project\n   * \n   * Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.7\n   * \n   * @param projectName - Name of project to delete\n   * @param skipConfirmation - Skip confirmation prompt (default: false)\n   * @param sessionId - Optional session ID for context management\n   * @returns Delete result\n   */\n  async deleteProject(\n    projectName: string,\n    skipConfirmation: boolean = false,\n    sessionId?: string\n  ): Promise<DeleteResult> {\n    try {\n      console.log(`[ProjectLifecycleManager] Deleting project: ${projectName}`);\n\n      // 1. Check if project exists (Requirement 2.2)\n      const project = await this.projectStore.load(projectName);\n      if (!project) {\n        return {\n          success: false,\n          projectName,\n          message: ERROR_MESSAGES.PROJECT_NOT_FOUND(projectName),\n          error: ProjectLifecycleError.PROJECT_NOT_FOUND,\n        };\n      }\n\n      // 2. Check if project is in progress (Requirement 2.7)\n      if (project.metadata?.status === 'in_progress') {\n        return {\n          success: false,\n          projectName,\n          message: ERROR_MESSAGES.PROJECT_IN_PROGRESS(projectName),\n          error: ProjectLifecycleError.PROJECT_IN_PROGRESS,\n        };\n      }\n\n      // 3. Check if confirmation is required (Requirement 2.1)\n      if (!skipConfirmation) {\n        return {\n          success: false,\n          projectName,\n          message: ERROR_MESSAGES.CONFIRMATION_REQUIRED('delete', projectName),\n          error: ProjectLifecycleError.CONFIRMATION_REQUIRED,\n        };\n      }\n\n      // 4. Delete from S3 (Requirement 2.2, 2.3)\n      await this.projectStore.delete(projectName);\n\n      // 5. Update session context if active project deleted (Requirement 2.4)\n      if (sessionId) {\n        const activeProject = await this.sessionContextManager.getActiveProject(sessionId);\n        if (activeProject === projectName) {\n          await this.sessionContextManager.setActiveProject(sessionId, '');\n          console.log(`[ProjectLifecycleManager] Cleared active project from session ${sessionId}`);\n        }\n      }\n\n      // 6. Clear resolver cache (Requirement 2.5)\n      this.projectResolver.clearCache();\n\n      console.log(`[ProjectLifecycleManager] Successfully deleted project: ${projectName}`);\n\n      return {\n        success: true,\n        projectName,\n        message: `Project '${projectName}' has been deleted.`,\n      };\n    } catch (error) {\n      console.error(`[ProjectLifecycleManager] Error deleting project ${projectName}:`, error);\n      return {\n        success: false,\n        projectName,\n        message: `Failed to delete project '${projectName}'`,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  /**\n   * Delete multiple projects matching a pattern\n   * \n   * @param pattern - Pattern to match project names\n   * @param skipConfirmation - Skip confirmation prompt (default: false)\n   * @returns Bulk delete result\n   */\n  async deleteBulk(\n    pattern: string,\n    skipConfirmation: boolean = false\n  ): Promise<BulkDeleteResult> {\n    try {\n      console.log(`[ProjectLifecycleManager] Bulk delete with pattern: ${pattern}`);\n\n      // Find matching projects\n      const matches = await this.projectStore.findByPartialName(pattern);\n\n      if (matches.length === 0) {\n        return {\n          success: false,\n          deletedCount: 0,\n          deletedProjects: [],\n          failedProjects: [],\n          message: `No projects match pattern '${pattern}'.`,\n        };\n      }\n\n      // Check if confirmation is required\n      if (!skipConfirmation) {\n        const projectList = matches.map((p) => p.project_name).join(', ');\n        return {\n          success: false,\n          deletedCount: 0,\n          deletedProjects: [],\n          failedProjects: [],\n          message: `Found ${matches.length} project(s) matching '${pattern}': ${projectList}. Type 'yes' to delete all.`,\n        };\n      }\n\n      // Delete each project\n      const results = await Promise.allSettled(\n        matches.map((p) => this.projectStore.delete(p.project_name))\n      );\n\n      const deleted: string[] = [];\n      const failed: Array<{ name: string; error: string }> = [];\n\n      results.forEach((result, index) => {\n        const projectName = matches[index].project_name;\n        if (result.status === 'fulfilled') {\n          deleted.push(projectName);\n        } else {\n          failed.push({\n            name: projectName,\n            error: result.reason instanceof Error ? result.reason.message : String(result.reason),\n          });\n        }\n      });\n\n      // Clear resolver cache\n      this.projectResolver.clearCache();\n\n      console.log(\n        `[ProjectLifecycleManager] Bulk delete complete: ${deleted.length} deleted, ${failed.length} failed`\n      );\n\n      return {\n        success: failed.length === 0,\n        deletedCount: deleted.length,\n        deletedProjects: deleted,\n        failedProjects: failed,\n        message:\n          failed.length === 0\n            ? `Successfully deleted ${deleted.length} project(s).`\n            : `Deleted ${deleted.length} project(s). Failed to delete ${failed.length} project(s).`,\n      };\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error in bulk delete:', error);\n      return {\n        success: false,\n        deletedCount: 0,\n        deletedProjects: [],\n        failedProjects: [],\n        message: `Bulk delete failed: ${error instanceof Error ? error.message : String(error)}`,\n      };\n    }\n  }\n\n  // ============================================================================\n  // Rename Methods\n  // ============================================================================\n\n  /**\n   * Rename a project\n   * \n   * Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6\n   * \n   * @param oldName - Current project name\n   * @param newName - New project name\n   * @param sessionId - Optional session ID for context management\n   * @returns Rename result\n   */\n  async renameProject(\n    oldName: string, \n    newName: string,\n    sessionId?: string\n  ): Promise<RenameResult> {\n    try {\n      console.log(`[ProjectLifecycleManager] Renaming project: ${oldName} -> ${newName}`);\n\n      // 1. Validate old project exists (Requirement 3.1)\n      const project = await this.projectStore.load(oldName);\n      if (!project) {\n        return {\n          success: false,\n          oldName,\n          newName,\n          message: ERROR_MESSAGES.PROJECT_NOT_FOUND(oldName),\n          error: ProjectLifecycleError.PROJECT_NOT_FOUND,\n        };\n      }\n\n      // 2. Normalize new name (Requirement 3.1)\n      const normalizedNewName = this.projectNameGenerator.normalize(newName);\n\n      // 3. Check if new name already exists (Requirement 3.1, 3.4)\n      const existing = await this.projectStore.load(normalizedNewName);\n      if (existing) {\n        return {\n          success: false,\n          oldName,\n          newName: normalizedNewName,\n          message: ERROR_MESSAGES.NAME_ALREADY_EXISTS(normalizedNewName),\n          error: ProjectLifecycleError.NAME_ALREADY_EXISTS,\n        };\n      }\n\n      // 4. Create updated project with new name (Requirement 3.2)\n      const updatedProject: ProjectData = {\n        ...project,\n        project_name: normalizedNewName,\n        updated_at: new Date().toISOString(),\n      };\n\n      // 5. Save with new name (Requirement 3.3 - S3 path update)\n      await this.projectStore.save(normalizedNewName, updatedProject);\n\n      // 6. Delete old project (Requirement 3.3 - S3 path update)\n      await this.projectStore.delete(oldName);\n\n      // 7. Update session context if active project (Requirement 3.5)\n      if (sessionId) {\n        const activeProject = await this.sessionContextManager.getActiveProject(sessionId);\n        if (activeProject === oldName) {\n          await this.sessionContextManager.setActiveProject(sessionId, normalizedNewName);\n          console.log(`[ProjectLifecycleManager] Updated active project in session ${sessionId}: ${oldName} -> ${normalizedNewName}`);\n        }\n\n        // 8. Update project history (Requirement 3.5)\n        const context = await this.sessionContextManager.getContext(sessionId);\n        if (context.project_history.includes(oldName)) {\n          // Replace old name with new name in history\n          const updatedHistory = context.project_history.map(name => \n            name === oldName ? normalizedNewName : name\n          );\n          \n          // Update history in session context\n          // We need to update the history directly since there's no updateHistory method\n          // We'll add the new name to ensure it's in the history\n          await this.sessionContextManager.addToHistory(sessionId, normalizedNewName);\n          console.log(`[ProjectLifecycleManager] Updated project history in session ${sessionId}`);\n        }\n      }\n\n      // 9. Clear resolver cache (Requirement 3.6)\n      this.projectResolver.clearCache();\n\n      console.log(`[ProjectLifecycleManager] Successfully renamed project: ${oldName} -> ${normalizedNewName}`);\n\n      return {\n        success: true,\n        oldName,\n        newName: normalizedNewName,\n        message: `Project renamed from '${oldName}' to '${normalizedNewName}'.`,\n      };\n    } catch (error) {\n      console.error(`[ProjectLifecycleManager] Error renaming project ${oldName}:`, error);\n      return {\n        success: false,\n        oldName,\n        newName,\n        message: `Failed to rename project '${oldName}'`,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  // ============================================================================\n  // Merge Methods\n  // ============================================================================\n\n  /**\n   * Merge two projects into one\n   * \n   * @param sourceProjectName - Project to merge from (will be deleted)\n   * @param targetProjectName - Project to merge into (will be kept)\n   * @param keepName - Which name to keep (default: target)\n   * @returns Merge result\n   */\n  async mergeProjects(\n    sourceProjectName: string,\n    targetProjectName: string,\n    keepName?: string\n  ): Promise<MergeResult> {\n    try {\n      console.log(`[ProjectLifecycleManager] Merging projects: ${sourceProjectName} -> ${targetProjectName}`);\n\n      // Load both projects\n      const sourceProject = await this.projectStore.load(sourceProjectName);\n      const targetProject = await this.projectStore.load(targetProjectName);\n\n      if (!sourceProject || !targetProject) {\n        const missing = !sourceProject ? sourceProjectName : targetProjectName;\n        return {\n          success: false,\n          mergedProject: '',\n          deletedProject: '',\n          message: ERROR_MESSAGES.PROJECT_NOT_FOUND(missing),\n          error: ProjectLifecycleError.PROJECT_NOT_FOUND,\n        };\n      }\n\n      // Determine which name to keep\n      const finalName = keepName || targetProjectName;\n      if (finalName !== sourceProjectName && finalName !== targetProjectName) {\n        return {\n          success: false,\n          mergedProject: '',\n          deletedProject: '',\n          message: `Keep name must be either '${sourceProjectName}' or '${targetProjectName}'.`,\n          error: ProjectLifecycleError.MERGE_CONFLICT,\n        };\n      }\n\n      // Merge data (keep most complete)\n      const mergedProject: ProjectData = {\n        ...targetProject,\n        project_name: finalName,\n        updated_at: new Date().toISOString(),\n        // Keep non-null values from either project\n        coordinates: targetProject.coordinates || sourceProject.coordinates,\n        terrain_results: targetProject.terrain_results || sourceProject.terrain_results,\n        layout_results: targetProject.layout_results || sourceProject.layout_results,\n        simulation_results: targetProject.simulation_results || sourceProject.simulation_results,\n        report_results: targetProject.report_results || sourceProject.report_results,\n        metadata: {\n          ...sourceProject.metadata,\n          ...targetProject.metadata,\n        },\n      };\n\n      // Save merged project\n      await this.projectStore.save(finalName, mergedProject);\n\n      // Delete the other project\n      const deleteTarget = finalName === sourceProjectName ? targetProjectName : sourceProjectName;\n      await this.projectStore.delete(deleteTarget);\n\n      // Clear resolver cache\n      this.projectResolver.clearCache();\n\n      console.log(`[ProjectLifecycleManager] Successfully merged projects into: ${finalName}`);\n\n      return {\n        success: true,\n        mergedProject: finalName,\n        deletedProject: deleteTarget,\n        message: `Projects merged into '${finalName}'. Deleted '${deleteTarget}'.`,\n      };\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error merging projects:', error);\n      return {\n        success: false,\n        mergedProject: '',\n        deletedProject: '',\n        message: `Failed to merge projects`,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  // ============================================================================\n  // Archive Methods\n  // ============================================================================\n\n  /**\n   * Archive a project\n   * \n   * Requirements: 8.1, 8.2, 8.3, 8.4, 8.5, 8.6\n   * \n   * @param projectName - Name of project to archive\n   * @param sessionId - Optional session ID for context management\n   * @returns Archive result\n   */\n  async archiveProject(projectName: string, sessionId?: string): Promise<ArchiveResult> {\n    try {\n      console.log(`[ProjectLifecycleManager] Archiving project: ${projectName}`);\n\n      // 1. Check if project exists (Requirement 8.1)\n      const project = await this.projectStore.load(projectName);\n      if (!project) {\n        return {\n          success: false,\n          projectName,\n          message: ERROR_MESSAGES.PROJECT_NOT_FOUND(projectName),\n          error: ProjectLifecycleError.PROJECT_NOT_FOUND,\n        };\n      }\n\n      // 2. Add archived flag (Requirement 8.1, 8.2)\n      const archivedProject: ProjectData = {\n        ...project,\n        updated_at: new Date().toISOString(),\n        metadata: {\n          ...project.metadata,\n          archived: true,\n          archived_at: new Date().toISOString(),\n        },\n      };\n\n      // 3. Save archived project (Requirement 8.1)\n      await this.projectStore.save(projectName, archivedProject);\n\n      // 4. Clear active project if this was the active one (Requirement 8.5)\n      if (sessionId) {\n        const activeProject = await this.sessionContextManager.getActiveProject(sessionId);\n        if (activeProject === projectName) {\n          await this.sessionContextManager.setActiveProject(sessionId, '');\n          console.log(`[ProjectLifecycleManager] Cleared active project from session ${sessionId}`);\n        }\n      }\n\n      // 5. Clear resolver cache\n      this.projectResolver.clearCache();\n\n      console.log(`[ProjectLifecycleManager] Successfully archived project: ${projectName}`);\n\n      return {\n        success: true,\n        projectName,\n        message: `Project '${projectName}' has been archived.`,\n      };\n    } catch (error) {\n      console.error(`[ProjectLifecycleManager] Error archiving project ${projectName}:`, error);\n      return {\n        success: false,\n        projectName,\n        message: `Failed to archive project '${projectName}'`,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  /**\n   * Unarchive a project\n   * \n   * Requirements: 8.4\n   * \n   * @param projectName - Name of project to unarchive\n   * @returns Unarchive result\n   */\n  async unarchiveProject(projectName: string): Promise<UnarchiveResult> {\n    try {\n      console.log(`[ProjectLifecycleManager] Unarchiving project: ${projectName}`);\n\n      // 1. Check if project exists (Requirement 8.4)\n      const project = await this.projectStore.load(projectName);\n      if (!project) {\n        return {\n          success: false,\n          projectName,\n          message: ERROR_MESSAGES.PROJECT_NOT_FOUND(projectName),\n          error: ProjectLifecycleError.PROJECT_NOT_FOUND,\n        };\n      }\n\n      // 2. Remove archived flag (Requirement 8.4)\n      const unarchivedProject: ProjectData = {\n        ...project,\n        updated_at: new Date().toISOString(),\n        metadata: {\n          ...project.metadata,\n          archived: false,\n          archived_at: undefined,\n        },\n      };\n\n      // 3. Save unarchived project (Requirement 8.4)\n      await this.projectStore.save(projectName, unarchivedProject);\n\n      // 4. Clear resolver cache\n      this.projectResolver.clearCache();\n\n      console.log(`[ProjectLifecycleManager] Successfully unarchived project: ${projectName}`);\n\n      return {\n        success: true,\n        projectName,\n        message: `Project '${projectName}' has been unarchived.`,\n      };\n    } catch (error) {\n      console.error(`[ProjectLifecycleManager] Error unarchiving project ${projectName}:`, error);\n      return {\n        success: false,\n        projectName,\n        message: `Failed to unarchive project '${projectName}'`,\n        error: error instanceof Error ? error.message : String(error),\n      };\n    }\n  }\n\n  /**\n   * List active (non-archived) projects\n   * \n   * Requirements: 8.2\n   * \n   * @returns Array of active projects (excludes archived)\n   */\n  async listActiveProjects(): Promise<ProjectData[]> {\n    try {\n      console.log('[ProjectLifecycleManager] Listing active projects');\n      \n      // Get all projects and filter out archived ones (Requirement 8.2)\n      const allProjects = await this.projectStore.list();\n      const activeProjects = allProjects.filter((p) => p.metadata?.archived !== true);\n      \n      console.log(`[ProjectLifecycleManager] Found ${activeProjects.length} active project(s)`);\n      \n      return activeProjects;\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error listing active projects:', error);\n      return [];\n    }\n  }\n\n  /**\n   * List archived projects\n   * \n   * Requirements: 8.3\n   * \n   * @returns Array of archived projects\n   */\n  async listArchivedProjects(): Promise<ProjectData[]> {\n    try {\n      console.log('[ProjectLifecycleManager] Listing archived projects');\n      \n      // Get all projects and filter for archived ones (Requirement 8.3)\n      const allProjects = await this.projectStore.list();\n      const archivedProjects = allProjects.filter((p) => p.metadata?.archived === true);\n      \n      console.log(`[ProjectLifecycleManager] Found ${archivedProjects.length} archived project(s)`);\n      \n      return archivedProjects;\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error listing archived projects:', error);\n      return [];\n    }\n  }\n\n  // ============================================================================\n  // Search and Filter Methods\n  // ============================================================================\n\n  /**\n   * Search projects with filters\n   * \n   * @param filters - Search criteria\n   * @returns Array of matching projects\n   */\n  async searchProjects(filters: ProjectSearchFilters): Promise<ProjectData[]> {\n    try {\n      console.log('[ProjectLifecycleManager] Searching projects with filters:', filters);\n\n      let projects = await this.projectStore.list();\n\n      // Filter by location\n      if (filters.location) {\n        const locationLower = filters.location.toLowerCase();\n        projects = projects.filter((p) =>\n          p.project_name.toLowerCase().includes(locationLower)\n        );\n      }\n\n      // Filter by date range\n      if (filters.dateFrom) {\n        const fromDate = new Date(filters.dateFrom);\n        projects = projects.filter((p) => new Date(p.created_at) >= fromDate);\n      }\n\n      if (filters.dateTo) {\n        const toDate = new Date(filters.dateTo);\n        projects = projects.filter((p) => new Date(p.created_at) <= toDate);\n      }\n\n      // Filter by completion status\n      if (filters.incomplete) {\n        projects = projects.filter(\n          (p) =>\n            !p.terrain_results ||\n            !p.layout_results ||\n            !p.simulation_results ||\n            !p.report_results\n        );\n      }\n\n      // Filter by coordinates proximity\n      if (filters.coordinates && filters.radiusKm) {\n        const matches = this.proximityDetector.findProjectsWithinRadius(\n          projects,\n          filters.coordinates,\n          filters.radiusKm\n        );\n        projects = matches.map((m) => m.project);\n      }\n\n      // Filter by archived status\n      if (filters.archived !== undefined) {\n        projects = projects.filter(\n          (p) => (p.metadata?.archived || false) === filters.archived\n        );\n      }\n\n      console.log(`[ProjectLifecycleManager] Found ${projects.length} matching projects`);\n\n      return projects;\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error searching projects:', error);\n      return [];\n    }\n  }\n\n  /**\n   * Find duplicate projects\n   * \n   * @param radiusKm - Grouping radius in kilometers (default: 1km)\n   * @returns Array of duplicate groups\n   */\n  async findDuplicates(radiusKm: number = 1.0): Promise<DuplicateGroup[]> {\n    try {\n      console.log('[ProjectLifecycleManager] Finding duplicate projects');\n\n      const projects = await this.projectStore.list();\n      const groups = this.proximityDetector.groupDuplicates(projects, radiusKm);\n\n      console.log(`[ProjectLifecycleManager] Found ${groups.length} duplicate group(s)`);\n\n      return groups;\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error finding duplicates:', error);\n      return [];\n    }\n  }\n\n  // ============================================================================\n  // Export/Import Methods\n  // ============================================================================\n\n  /**\n   * Export project data\n   * \n   * @param projectName - Name of project to export\n   * @returns Export data\n   */\n  async exportProject(projectName: string): Promise<ExportData | null> {\n    try {\n      console.log(`[ProjectLifecycleManager] Exporting project: ${projectName}`);\n\n      const project = await this.projectStore.load(projectName);\n      if (!project) {\n        throw new Error(ERROR_MESSAGES.PROJECT_NOT_FOUND(projectName));\n      }\n\n      const exportData: ExportData = {\n        version: '1.0',\n        exportedAt: new Date().toISOString(),\n        project,\n        artifacts: {\n          terrain: project.terrain_results?.s3_key,\n          layout: project.layout_results?.s3_key,\n          simulation: project.simulation_results?.s3_key,\n          report: project.report_results?.s3_key,\n        },\n      };\n\n      console.log(`[ProjectLifecycleManager] Successfully exported project: ${projectName}`);\n\n      return exportData;\n    } catch (error) {\n      console.error(`[ProjectLifecycleManager] Error exporting project ${projectName}:`, error);\n      throw error;\n    }\n  }\n\n  /**\n   * Import project data\n   * \n   * @param data - Export data to import\n   * @returns Import result\n   */\n  async importProject(data: ExportData): Promise<ImportResult> {\n    try {\n      console.log('[ProjectLifecycleManager] Importing project');\n\n      // Validate format version\n      if (data.version !== '1.0') {\n        return {\n          success: false,\n          projectName: '',\n          message: ERROR_MESSAGES.UNSUPPORTED_VERSION(data.version),\n          error: ProjectLifecycleError.UNSUPPORTED_VERSION,\n        };\n      }\n\n      // Check for name conflict\n      const existing = await this.projectStore.load(data.project.project_name);\n      let importName = data.project.project_name;\n\n      if (existing) {\n        importName = await this.projectNameGenerator.ensureUnique(\n          `${importName}-imported`\n        );\n      }\n\n      // Save imported project\n      const importedProject: ProjectData = {\n        ...data.project,\n        project_name: importName,\n        updated_at: new Date().toISOString(),\n        metadata: {\n          ...data.project.metadata,\n          imported_at: new Date().toISOString(),\n        },\n      };\n\n      await this.projectStore.save(importName, importedProject);\n\n      console.log(`[ProjectLifecycleManager] Successfully imported project as: ${importName}`);\n\n      return {\n        success: true,\n        projectName: importName,\n        message: `Project imported as '${importName}'.`,\n      };\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error importing project:', error);\n      return {\n        success: false,\n        projectName: '',\n        message: ERROR_MESSAGES.IMPORT_ERROR(\n          error instanceof Error ? error.message : String(error)\n        ),\n        error: ProjectLifecycleError.IMPORT_ERROR,\n      };\n    }\n  }\n\n  // ============================================================================\n  // Dashboard Methods\n  // ============================================================================\n\n  /**\n   * Generate project dashboard data\n   * \n   * @param sessionContext - Current session context\n   * @returns Dashboard data\n   */\n  async generateDashboard(sessionContext: SessionContext): Promise<ProjectDashboard> {\n    try {\n      console.log('[ProjectLifecycleManager] Generating project dashboard');\n\n      const allProjects = await this.projectStore.list();\n      const duplicateGroups = await this.findDuplicates();\n\n      // Create set of duplicate project names\n      const duplicateProjectNames = new Set<string>();\n      duplicateGroups.forEach((group) => {\n        group.projects.forEach((p) => duplicateProjectNames.add(p.project_name));\n      });\n\n      // Map projects to dashboard format\n      const dashboardProjects = allProjects.map((project) => {\n        const completionPercentage = this.calculateCompletionPercentage(project);\n        const location = this.extractLocation(project);\n        const status = this.getProjectStatus(project);\n\n        return {\n          name: project.project_name,\n          location,\n          completionPercentage,\n          lastUpdated: project.updated_at,\n          isActive: project.project_name === sessionContext.active_project,\n          isDuplicate: duplicateProjectNames.has(project.project_name),\n          status,\n        };\n      });\n\n      // Sort by last updated (most recent first)\n      dashboardProjects.sort(\n        (a, b) => new Date(b.lastUpdated).getTime() - new Date(a.lastUpdated).getTime()\n      );\n\n      return {\n        projects: dashboardProjects,\n        totalProjects: allProjects.length,\n        activeProject: sessionContext.active_project || null,\n        duplicateGroups,\n      };\n    } catch (error) {\n      console.error('[ProjectLifecycleManager] Error generating dashboard:', error);\n      return {\n        projects: [],\n        totalProjects: 0,\n        activeProject: null,\n        duplicateGroups: [],\n      };\n    }\n  }\n\n  // ============================================================================\n  // Helper Methods\n  // ============================================================================\n\n  /**\n   * Calculate project completion percentage\n   */\n  private calculateCompletionPercentage(project: ProjectData): number {\n    let completed = 0;\n    const total = 4;\n\n    if (project.terrain_results) completed++;\n    if (project.layout_results) completed++;\n    if (project.simulation_results) completed++;\n    if (project.report_results) completed++;\n\n    return Math.round((completed / total) * 100);\n  }\n\n  /**\n   * Extract location from project name\n   */\n  private extractLocation(project: ProjectData): string {\n    // Try to extract location from project name\n    // e.g., \"west-texas-wind-farm\" -> \"West Texas\"\n    const parts = project.project_name.split('-');\n    const locationParts = parts.filter(\n      (part) => part !== 'wind' && part !== 'farm' && part !== 'project'\n    );\n\n    if (locationParts.length > 0) {\n      return locationParts\n        .map((part) => part.charAt(0).toUpperCase() + part.slice(1))\n        .join(' ');\n    }\n\n    // Fallback to coordinates if available\n    if (project.coordinates) {\n      return `${project.coordinates.latitude.toFixed(2)}, ${project.coordinates.longitude.toFixed(2)}`;\n    }\n\n    return 'Unknown';\n  }\n\n  /**\n   * Get project status\n   */\n  private getProjectStatus(project: ProjectData): string {\n    if (project.report_results) return 'Complete';\n    if (project.simulation_results) return 'Simulation Complete';\n    if (project.layout_results) return 'Layout Complete';\n    if (project.terrain_results) return 'Terrain Complete';\n    return 'Not Started';\n  }\n}\n", "/**\n * Renewable Energy Orchestrator Lambda\n * \n * NOW USES STRANDS AGENTS for intelligent decision-making!\n * Falls back to direct tool invocation if Strands Agents unavailable.\n * \n * Routes renewable energy queries to appropriate tool Lambdas and aggregates results.\n * Enhanced with validation and fallback capabilities.\n */\n\nimport { LambdaClient, InvokeCommand } from '@aws-sdk/client-lambda';\nimport type { \n  OrchestratorRequest, \n  OrchestratorResponse, \n  RenewableIntent, \n  ToolResult,\n  ThoughtStep,\n  Artifact\n} from './types';\nimport { IntentRouter } from './IntentRouter';\nimport { \n  validateParameters, \n  applyDefaultParameters, \n  formatValidationError,\n  logValidationFailure,\n  logValidationSuccess,\n  type ProjectContext\n} from './parameterValidator';\nimport { ProjectStore } from '../shared/projectStore';\nimport { ProjectNameGenerator } from '../shared/projectNameGenerator';\nimport { SessionContextManager } from '../shared/sessionContextManager';\nimport { ProjectResolver } from '../shared/projectResolver';\nimport { ErrorMessageTemplates, RENEWABLE_ERROR_MESSAGES, RenewableErrorFormatter } from '../shared/errorMessageTemplates';\nimport { generateActionButtons, generateNextStepSuggestion, formatProjectStatusChecklist } from '../shared/actionButtonTypes';\nimport { ProjectListHandler } from '../shared/projectListHandler';\n\n// STRANDS AGENT INTEGRATION\nimport { handleWithStrandsAgents, isStrandsAgentAvailable } from './strandsAgentHandler';\n\ninterface ValidationResult {\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n  canProceed: boolean;\n}\n\nconst lambdaClient = new LambdaClient({});\n\n/**\n * Execution time tracker for detailed performance monitoring\n */\ninterface ExecutionTimings {\n  validation: number;\n  intentDetection: number;\n  toolInvocation: number;\n  resultFormatting: number;\n  total: number;\n}\n\n/**\n * Main Lambda handler\n */\nexport async function handler(event: OrchestratorRequest): Promise<OrchestratorResponse> {\n  const startTime = Date.now();\n  const requestId = `req-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n  const thoughtSteps: ThoughtStep[] = [];\n  const toolsUsed: string[] = [];\n  const timings: Partial<ExecutionTimings> = {};\n  \n  try {\n    // Enhanced entry point logging\n    console.log('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n    console.log('\uD83D\uDE80 ORCHESTRATOR ENTRY POINT');\n    console.log('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\u23F0 Timestamp: ${new Date(startTime).toISOString()}`);\n    console.log(`\uD83D\uDCE6 Full Request Payload: ${JSON.stringify(event, null, 2)}`);\n    console.log(`\uD83D\uDD0D Query: ${event.query}`);\n    console.log(`\uD83D\uDCDD Context: ${JSON.stringify(event.context || {}, null, 2)}`);\n    console.log(`\uD83D\uDD04 Async Mode: ${event.sessionId ? 'YES (will write to DynamoDB)' : 'NO (sync response)'}`);\n    console.log('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n    \n    // ============================================\n    // PRIORITY ROUTING - Check for dashboard/list queries FIRST\n    // ============================================\n    const projectListHandler = new ProjectListHandler(\n      process.env.RENEWABLE_S3_BUCKET,\n      process.env.SESSION_CONTEXT_TABLE\n    );\n    \n    // Check if this is a \"show project dashboard\" query (HIGHEST PRIORITY)\n    if (ProjectListHandler.isProjectDashboardQuery(event.query)) {\n      console.log('\uD83D\uDCCA Detected project dashboard query - bypassing Strands Agent');\n      const dashboardStartTime = Date.now();\n      thoughtSteps.push({\n        step: 1,\n        action: 'Loading project dashboard',\n        reasoning: 'Generating interactive dashboard with all projects',\n        status: 'in_progress',\n        timestamp: new Date(dashboardStartTime).toISOString()\n      });\n      \n      const dashboardResponse = await projectListHandler.generateDashboardArtifact(event.sessionId);\n      const dashboardDuration = Date.now() - dashboardStartTime;\n      \n      // Update thought step with completion\n      thoughtSteps[0] = {\n        ...thoughtSteps[0],\n        status: dashboardResponse.success ? 'complete' : 'error',\n        duration: dashboardDuration,\n        result: dashboardResponse.success \n          ? `Generated dashboard with ${dashboardResponse.projectCount} project(s)` \n          : 'Failed to generate dashboard',\n        ...(dashboardResponse.success ? {} : {\n          error: {\n            message: 'Dashboard generation failed',\n            suggestion: 'Check CloudWatch logs for details'\n          }\n        })\n      };\n      \n      return {\n        success: dashboardResponse.success,\n        message: dashboardResponse.message,\n        artifacts: dashboardResponse.artifacts,\n        thoughtSteps,\n        responseComplete: true,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: ['project_dashboard'],\n          projectCount: dashboardResponse.projectCount\n        }\n      };\n    }\n    \n    // Check if this is a \"list my projects\" query\n    if (ProjectListHandler.isProjectListQuery(event.query)) {\n      console.log('\uD83D\uDCCB Detected project list query - bypassing Strands Agent');\n      const listStartTime = Date.now();\n      thoughtSteps.push({\n        step: 1,\n        action: 'Listing projects',\n        reasoning: 'Retrieving all renewable energy projects',\n        status: 'in_progress',\n        timestamp: new Date(listStartTime).toISOString()\n      });\n      \n      const listResponse = await projectListHandler.listProjects(event.sessionId);\n      const listDuration = Date.now() - listStartTime;\n      \n      // Update thought step with completion\n      thoughtSteps[0] = {\n        ...thoughtSteps[0],\n        status: 'complete',\n        duration: listDuration,\n        result: `Found ${listResponse.projects?.length || 0} project(s)`\n      };\n      \n      return {\n        success: listResponse.success,\n        message: listResponse.message,\n        artifacts: [],\n        thoughtSteps,\n        responseComplete: true,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: ['project_list'],\n          projectCount: listResponse.projects?.length || 0,\n          activeProject: listResponse.activeProject\n        }\n      };\n    }\n    \n    // ============================================\n    // STRANDS AGENT ROUTING (NEW!)\n    // ============================================\n    if (isStrandsAgentAvailable()) {\n      console.log('\uD83E\uDD16 STRANDS AGENTS AVAILABLE - Using intelligent agent system');\n      \n      try {\n        const agentResponse = await handleWithStrandsAgents({\n          userMessage: event.query,\n          chatSessionId: event.sessionId || requestId,\n          projectContext: event.context || {}\n        });\n        \n        console.log('\u2705 Strands Agent response received');\n        \n        return {\n          success: agentResponse.success,\n          message: agentResponse.message,\n          artifacts: agentResponse.artifacts,\n          thoughtSteps: agentResponse.thoughtSteps || [],\n          metadata: {\n            ...agentResponse.metadata,\n            executionTime: Date.now() - startTime,\n            requestId\n          }\n        };\n      } catch (agentError: any) {\n        // Check if this is a timeout or throttling error\n        const errorMessage = agentError.message || String(agentError);\n        const isTimeoutError = errorMessage.includes('timeout') || \n                              errorMessage.includes('Timeout') ||\n                              errorMessage.includes('timed out');\n        const isThrottlingError = agentError.name === 'TooManyRequestsException' ||\n                                 errorMessage.includes('TooManyRequestsException') ||\n                                 errorMessage.includes('Rate exceeded');\n        \n        if (isTimeoutError || isThrottlingError) {\n          console.warn('\u26A0\uFE0F  Strands Agent timeout/throttling detected, falling back to direct tool invocation');\n          console.warn(`   Error type: ${isTimeoutError ? 'Timeout' : 'Throttling'}`);\n          console.warn(`   Error message: ${errorMessage}`);\n          \n          // Log fallback event for monitoring\n          console.log('\uD83D\uDCCA FALLBACK EVENT:', {\n            timestamp: new Date().toISOString(),\n            requestId,\n            errorType: isTimeoutError ? 'timeout' : 'throttling',\n            errorMessage: errorMessage.substring(0, 200),\n            query: event.query.substring(0, 100)\n          });\n          \n          // Fall through to legacy handler with fallback flag\n          thoughtSteps.push({\n            step: thoughtSteps.length + 1,\n            action: 'Fallback to direct tools',\n            reasoning: `Strands Agent ${isTimeoutError ? 'timed out' : 'throttled'}, using direct tool invocation`,\n            status: 'complete',\n            timestamp: new Date().toISOString(),\n            duration: 0,\n            result: 'Switched to basic mode'\n          });\n        } else {\n          // Other errors - log and fall through\n          console.error('\u274C Strands Agent error (non-timeout), falling back to direct tool invocation:', agentError);\n          \n          thoughtSteps.push({\n            step: thoughtSteps.length + 1,\n            action: 'Fallback to direct tools',\n            reasoning: 'Strands Agent encountered an error',\n            status: 'complete',\n            timestamp: new Date().toISOString(),\n            duration: 0,\n            result: 'Switched to basic mode'\n          });\n        }\n        // Fall through to legacy handler\n      }\n    } else {\n      console.log('\u26A0\uFE0F  Strands Agents not available - using legacy tool invocation');\n    }\n    \n    // ============================================\n    // LEGACY HANDLER (Fallback)\n    // ============================================\n    \n    // Handle health check requests\n    if (event.query === '__health_check__') {\n      console.log('Health check requested');\n      \n      // Log environment variables for debugging\n      console.log('Environment variables:', {\n        RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME: process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME,\n        RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME: process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME,\n        RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME: process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME,\n        RENEWABLE_REPORT_TOOL_FUNCTION_NAME: process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME,\n        AWS_LAMBDA_FUNCTION_NAME: process.env.AWS_LAMBDA_FUNCTION_NAME,\n        AWS_LAMBDA_FUNCTION_VERSION: process.env.AWS_LAMBDA_FUNCTION_VERSION,\n        AWS_REGION: process.env.AWS_REGION\n      });\n      \n      return {\n        success: true,\n        message: 'Orchestrator is healthy',\n        artifacts: [],\n        thoughtSteps: [],\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: [],\n          health: {\n            functionName: process.env.AWS_LAMBDA_FUNCTION_NAME || 'unknown',\n            version: process.env.AWS_LAMBDA_FUNCTION_VERSION || 'unknown',\n            region: process.env.AWS_REGION || 'unknown',\n            toolsConfigured: {\n              terrain: !!process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME,\n              layout: !!process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME,\n              simulation: !!process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME,\n              report: !!process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME\n            },\n            toolFunctionNames: {\n              terrain: process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME || 'not configured',\n              layout: process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME || 'not configured',\n              simulation: process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME || 'not configured',\n              report: process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME || 'not configured'\n            }\n          }\n        }\n      };\n    }\n    \n    // Handle duplicate resolution choice (1, 2, or 3)\n    if (event.context?.duplicateCheckResult && /^[123]$/.test(event.query.trim())) {\n      console.log('\uD83D\uDD04 Handling duplicate resolution choice');\n      \n      const { ProjectLifecycleManager } = await import('../shared/projectLifecycleManager');\n      const projectStore = new ProjectStore(process.env.RENEWABLE_S3_BUCKET);\n      const sessionContextManager = new SessionContextManager(process.env.SESSION_CONTEXT_TABLE);\n      const projectNameGenerator = new ProjectNameGenerator(projectStore);\n      const projectResolver = new ProjectResolver(projectStore);\n      \n      const lifecycleManager = new ProjectLifecycleManager(\n        projectStore,\n        projectResolver,\n        projectNameGenerator,\n        sessionContextManager\n      );\n      \n      const sessionId = event.sessionId || `session-${Date.now()}`;\n      const duplicateCheckResult = event.context.duplicateCheckResult;\n      \n      const choiceResult = await lifecycleManager.handleDuplicateChoice(\n        event.query,\n        duplicateCheckResult.duplicates,\n        sessionId\n      );\n      \n      if (choiceResult.action === 'continue' && choiceResult.projectName) {\n        // User chose to continue with existing project\n        return {\n          success: true,\n          message: `${choiceResult.message}. You can now continue with terrain analysis, layout optimization, or other operations.`,\n          artifacts: [],\n          thoughtSteps: [{\n            step: 1,\n            action: 'Set active project',\n            reasoning: 'User chose to continue with existing project',\n            status: 'complete',\n            timestamp: new Date().toISOString(),\n            result: `Active project: ${choiceResult.projectName}`\n          }],\n          responseComplete: true,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            toolsUsed: ['duplicate_resolution'],\n            activeProject: choiceResult.projectName\n          }\n        };\n      } else if (choiceResult.action === 'create_new') {\n        // User chose to create new project - return message and wait for next query\n        return {\n          success: true,\n          message: `${choiceResult.message}. Please repeat your terrain analysis query to create a new project.`,\n          artifacts: [],\n          thoughtSteps: [{\n            step: 1,\n            action: 'Prepare for new project',\n            reasoning: 'User chose to create new project',\n            status: 'complete',\n            timestamp: new Date().toISOString(),\n            result: 'Ready to create new project'\n          }],\n          responseComplete: true,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            toolsUsed: ['duplicate_resolution'],\n            createNew: true\n          }\n        };\n      } else if (choiceResult.action === 'view_details') {\n        // User chose to view details - show details and ask again\n        return {\n          success: true,\n          message: choiceResult.message,\n          artifacts: [],\n          thoughtSteps: [{\n            step: 1,\n            action: 'Show project details',\n            reasoning: 'User requested project details',\n            status: 'complete',\n            timestamp: new Date().toISOString(),\n            result: 'Displayed project details'\n          }],\n          responseComplete: true,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            toolsUsed: ['duplicate_resolution'],\n            duplicateCheckResult: duplicateCheckResult\n          }\n        };\n      }\n    }\n    \n    // Check if this is a \"show project {name}\" query\n    const projectDetailsCheck = ProjectListHandler.isProjectDetailsQuery(event.query);\n    if (projectDetailsCheck.isMatch && projectDetailsCheck.projectName) {\n      console.log(`\uD83D\uDCCB Detected project details query for: ${projectDetailsCheck.projectName}`);\n      const detailsStartTime = Date.now();\n      thoughtSteps.push({\n        step: 1,\n        action: 'Loading project details',\n        reasoning: `Retrieving details for project: ${projectDetailsCheck.projectName}`,\n        status: 'in_progress',\n        timestamp: new Date(detailsStartTime).toISOString()\n      });\n      \n      const detailsResponse = await projectListHandler.showProjectDetails(projectDetailsCheck.projectName);\n      const detailsDuration = Date.now() - detailsStartTime;\n      \n      // Update thought step with completion\n      thoughtSteps[0] = {\n        ...thoughtSteps[0],\n        status: detailsResponse.success ? 'complete' : 'error',\n        duration: detailsDuration,\n        result: detailsResponse.success ? 'Project details loaded' : 'Project not found',\n        ...(detailsResponse.success ? {} : {\n          error: {\n            message: 'Project not found',\n            suggestion: 'Check project name or list all projects'\n          }\n        })\n      };\n      \n      return {\n        success: detailsResponse.success,\n        message: detailsResponse.message,\n        artifacts: [],\n        thoughtSteps,\n        responseComplete: true,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: ['project_details'],\n          projectName: projectDetailsCheck.projectName\n        }\n      };\n    }\n    \n    // Step 1: Quick validation check\n    const validationStartTime = Date.now();\n    thoughtSteps.push({\n      step: 1,\n      action: 'Validating deployment',\n      reasoning: 'Checking if renewable energy tools are available',\n      status: 'in_progress',\n      timestamp: new Date(validationStartTime).toISOString()\n    });\n    \n    const validation = await quickValidationCheck();\n    timings.validation = Date.now() - validationStartTime;\n    \n    // Update thought step with completion\n    thoughtSteps[thoughtSteps.length - 1] = {\n      ...thoughtSteps[thoughtSteps.length - 1],\n      status: 'complete',\n      duration: timings.validation,\n      result: validation.canProceed ? 'All tools available' : 'Deployment issues detected'\n    };\n    \n    console.log(`\u23F1\uFE0F  Validation Duration: ${timings.validation}ms`);\n    \n    if (!validation.canProceed) {\n      return {\n        success: false,\n        message: `Deployment issues detected: ${validation.errors.join(', ')}. Please run: npx ampx sandbox`,\n        artifacts: [],\n        thoughtSteps,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: [],\n          validationErrors: validation.errors\n        }\n      };\n    }\n    \n    // Step 2: Parse intent from query\n    const intentStartTime = Date.now();\n    thoughtSteps.push({\n      step: 2,\n      action: 'Analyzing query',\n      reasoning: 'Determining which renewable energy tool to use',\n      status: 'in_progress',\n      timestamp: new Date(intentStartTime).toISOString()\n    });\n    \n    const intent = await parseIntent(event.query, event.context);\n    timings.intentDetection = Date.now() - intentStartTime;\n    \n    // Update thought step with completion\n    thoughtSteps[thoughtSteps.length - 1] = {\n      ...thoughtSteps[thoughtSteps.length - 1],\n      status: 'complete',\n      duration: timings.intentDetection,\n      result: `Detected: ${intent.type}`\n    };\n    \n    // Enhanced intent detection logging\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log('\uD83C\uDFAF INTENT DETECTION RESULTS');\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\uD83D\uDD0D Detected Type: ${intent.type}`);\n    console.log(`\uD83D\uDCCA Confidence: ${intent.confidence}%`);\n    console.log(`\u2699\uFE0F  Parameters: ${JSON.stringify(intent.params, null, 2)}`);\n    console.log(`\u23F1\uFE0F  Detection Duration: ${timings.intentDetection}ms`);\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    \n    if (intent.type === 'unknown') {\n      return {\n        success: false,\n        message: 'Could not understand the renewable energy query. Please specify terrain analysis, layout optimization, wake simulation, or report generation.',\n        artifacts: [],\n        thoughtSteps,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: []\n        }\n      };\n    }\n    \n    // Handle project lifecycle management intents\n    const lifecycleIntents = ['delete_project', 'rename_project', 'merge_projects', 'archive_project', 'export_project', 'search_projects'];\n    if (lifecycleIntents.includes(intent.type)) {\n      console.log('\uD83D\uDD04 Detected lifecycle management intent:', intent.type);\n      \n      thoughtSteps.push({\n        step: thoughtSteps.length + 1,\n        action: 'Routing to lifecycle manager',\n        reasoning: `Detected ${intent.type} operation`,\n        status: 'in_progress',\n        timestamp: new Date().toISOString()\n      });\n      \n      try {\n        const { ProjectLifecycleManager } = await import('../shared/projectLifecycleManager');\n        const projectStore = new ProjectStore(process.env.RENEWABLE_S3_BUCKET);\n        const sessionContextManager = new SessionContextManager(process.env.SESSION_CONTEXT_TABLE);\n        const projectNameGenerator = new ProjectNameGenerator(projectStore);\n        const projectResolver = new ProjectResolver(projectStore);\n        \n        const lifecycleManager = new ProjectLifecycleManager(\n          projectStore,\n          projectResolver,\n          projectNameGenerator,\n          sessionContextManager\n        );\n        \n        const sessionId = event.sessionId || `session-${Date.now()}`;\n        const lifecycleResult = await handleLifecycleIntent(\n          intent,\n          event.query,\n          lifecycleManager,\n          sessionContextManager,\n          sessionId\n        );\n        \n        // Update thought step with completion\n        thoughtSteps[thoughtSteps.length - 1] = {\n          ...thoughtSteps[thoughtSteps.length - 1],\n          status: lifecycleResult.success ? 'complete' : 'error',\n          duration: Date.now() - new Date(thoughtSteps[thoughtSteps.length - 1].timestamp).getTime(),\n          result: lifecycleResult.success ? 'Lifecycle operation completed' : 'Lifecycle operation failed',\n          ...(lifecycleResult.success ? {} : {\n            error: {\n              message: lifecycleResult.message,\n              suggestion: 'Check parameters and try again'\n            }\n          })\n        };\n        \n        return {\n          success: lifecycleResult.success,\n          message: lifecycleResult.message,\n          artifacts: lifecycleResult.artifacts || [],\n          thoughtSteps,\n          responseComplete: true,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            toolsUsed: [intent.type],\n            lifecycleOperation: intent.type,\n            ...lifecycleResult.metadata\n          }\n        };\n      } catch (error) {\n        console.error('\u274C Error handling lifecycle intent:', error);\n        \n        // Update thought step with error\n        thoughtSteps[thoughtSteps.length - 1] = {\n          ...thoughtSteps[thoughtSteps.length - 1],\n          status: 'error',\n          duration: Date.now() - new Date(thoughtSteps[thoughtSteps.length - 1].timestamp).getTime(),\n          error: {\n            message: error instanceof Error ? error.message : 'Unknown error',\n            suggestion: 'Check CloudWatch logs for details'\n          }\n        };\n        \n        return {\n          success: false,\n          message: `Failed to execute ${intent.type}: ${error instanceof Error ? error.message : 'Unknown error'}`,\n          artifacts: [],\n          thoughtSteps,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            toolsUsed: [intent.type],\n            error: {\n              type: error instanceof Error ? error.name : 'UnknownError',\n              message: error instanceof Error ? error.message : 'Unknown error',\n              remediationSteps: [\n                'Check CloudWatch logs for detailed error information',\n                'Verify all required parameters are provided',\n                'Ensure project data is accessible'\n              ]\n            }\n          }\n        };\n      }\n    }\n    \n    // Step 3: Project name resolution (MOVED BEFORE VALIDATION)\n    const projectResolutionStartTime = Date.now();\n    thoughtSteps.push({\n      step: 3,\n      action: 'Resolving project context',\n      reasoning: 'Loading project data to auto-fill parameters',\n      status: 'in_progress',\n      timestamp: new Date(projectResolutionStartTime).toISOString()\n    });\n    \n    let projectName: string | null = null;\n    let projectData: any = null;\n    let projectContext: ProjectContext = {};\n    \n    try {\n      // Initialize project persistence components\n      const projectStore = new ProjectStore(process.env.RENEWABLE_S3_BUCKET);\n      const sessionContextManager = new SessionContextManager(process.env.SESSION_CONTEXT_TABLE);\n      const projectNameGenerator = new ProjectNameGenerator(projectStore);\n      const projectResolver = new ProjectResolver(projectStore);\n      \n      // Get session context\n      const sessionId = event.sessionId || `session-${Date.now()}`;\n      const sessionContext = await sessionContextManager.getContext(sessionId);\n      \n      console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n      console.log('\uD83C\uDD94 PROJECT CONTEXT RESOLUTION');\n      console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n      console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n      console.log(`\uD83D\uDD17 Session ID: ${sessionId}`);\n      console.log(`\uD83D\uDCDD Active Project: ${sessionContext.active_project || 'none'}`);\n      console.log(`\uD83D\uDCDA Project History: ${sessionContext.project_history.join(', ') || 'empty'}`);\n      console.log(`\uD83D\uDCE6 Context project_name: ${event.context?.project_name || 'none'}`);\n      \n      // CRITICAL FIX: Check for explicit project_name in context FIRST\n      // This ensures that when a project name is explicitly provided, we use it\n      // instead of trying to resolve from the query (which may generate a different name)\n      let resolveResult: any;\n      if (event.context?.project_name) {\n        console.log(`\u2705 Using explicit project_name from context: ${event.context.project_name}`);\n        resolveResult = {\n          projectName: event.context.project_name,\n          isAmbiguous: false,\n          confidence: 'explicit'\n        };\n      } else {\n        // Try to resolve existing project reference from query\n        resolveResult = await projectResolver.resolve(event.query, sessionContext);\n      }\n      \n      console.log(`\uD83D\uDD0D Resolution Result: ${JSON.stringify(resolveResult, null, 2)}`);\n      \n      if (resolveResult.isAmbiguous && resolveResult.matches) {\n        // Multiple projects match - return user-friendly error with suggestions\n        const errorMessage = ErrorMessageTemplates.formatAmbiguousReferenceForUser(\n          resolveResult.matches,\n          event.query\n        );\n        \n        console.log('\u274C Ambiguous project reference detected');\n        console.log(`   Query: ${event.query}`);\n        console.log(`   Matches: ${resolveResult.matches.join(', ')}`);\n        \n        return {\n          success: false,\n          message: errorMessage,\n          artifacts: [],\n          thoughtSteps,\n          metadata: {\n            executionTime: Date.now() - startTime,\n            toolsUsed: [],\n            errorCategory: 'AMBIGUOUS_REFERENCE',\n            ambiguousProjects: resolveResult.matches,\n            matchCount: resolveResult.matches.length\n          }\n        };\n      }\n      \n      if (resolveResult.projectName) {\n        // Found existing project\n        projectName = resolveResult.projectName;\n        console.log(`\u2705 Resolved to existing project: ${projectName}`);\n      } else {\n        // No existing project found - check if user wants to create NEW analysis\n        // Skip duplicate check if query explicitly indicates new analysis\n        const isExplicitNewAnalysis = /\\b(analyze|create|new|generate|run|perform|do)\\b.*\\bterrain\\b/i.test(event.query) ||\n                                      /\\bterrain\\b.*\\b(analyze|analysis|create|new|generate|run|perform)\\b/i.test(event.query);\n        \n        // Check for duplicates ONLY if this is NOT an explicit new analysis request\n        if (intent.type === 'terrain_analysis' && \n            intent.params.latitude && \n            intent.params.longitude && \n            !isExplicitNewAnalysis) {\n          console.log('\uD83D\uDD0D Checking for duplicate projects at coordinates (ambiguous query)...');\n          \n          const { ProjectLifecycleManager } = await import('../shared/projectLifecycleManager');\n          const lifecycleManager = new ProjectLifecycleManager(\n            projectStore,\n            projectResolver,\n            projectNameGenerator,\n            sessionContextManager\n          );\n          \n          const duplicateCheck = await lifecycleManager.checkForDuplicates(\n            {\n              latitude: intent.params.latitude,\n              longitude: intent.params.longitude\n            },\n            1.0 // 1km radius\n          );\n          \n          if (duplicateCheck.hasDuplicates) {\n            console.log(`\u26A0\uFE0F  Found ${duplicateCheck.duplicates.length} duplicate project(s)`);\n            \n            // Return prompt to user asking what they want to do\n            return {\n              success: true,\n              message: duplicateCheck.userPrompt,\n              artifacts: [],\n              thoughtSteps,\n              responseComplete: true,\n              metadata: {\n                executionTime: Date.now() - startTime,\n                toolsUsed: ['duplicate_detection'],\n                duplicateProjects: duplicateCheck.duplicates.map(d => ({\n                  name: d.project.project_name,\n                  distance: d.distanceKm\n                })),\n                requiresUserChoice: true,\n                duplicateCheckResult: duplicateCheck\n              }\n            };\n          }\n          \n          console.log('\u2705 No duplicates found, proceeding with new project');\n        } else if (isExplicitNewAnalysis) {\n          console.log('\u2705 Explicit new analysis request detected - skipping duplicate check');\n        }\n        \n        // No existing project found - generate new project name\n        const coordinates = intent.params.latitude && intent.params.longitude\n          ? { lat: intent.params.latitude, lon: intent.params.longitude }\n          : undefined;\n        \n        projectName = await projectNameGenerator.generateFromQuery(event.query, coordinates);\n        console.log(`\uD83C\uDD95 Generated new project name: ${projectName}`);\n      }\n      \n      // Load project data from S3 if project name exists\n      if (projectName) {\n        try {\n          projectData = await projectStore.load(projectName);\n          \n          if (projectData) {\n            console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n            console.log('\uD83D\uDCE6 PROJECT DATA LOADED');\n            console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n            console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n            console.log(`\uD83C\uDD94 Project Name: ${projectName}`);\n            console.log(`\uD83D\uDCC5 Created: ${projectData.created_at}`);\n            console.log(`\uD83D\uDCC5 Updated: ${projectData.updated_at}`);\n            console.log(`\uD83D\uDCCD Has Coordinates: ${!!projectData.coordinates}`);\n            console.log(`\uD83D\uDDFA\uFE0F  Has Terrain Results: ${!!projectData.terrain_results}`);\n            console.log(`\uD83D\uDCD0 Has Layout Results: ${!!projectData.layout_results}`);\n            console.log(`\uD83D\uDCA8 Has Simulation Results: ${!!projectData.simulation_results}`);\n            console.log(`\uD83D\uDCC4 Has Report Results: ${!!projectData.report_results}`);\n            \n            // DIAGNOSTIC: Log terrain results structure if present\n            if (projectData.terrain_results) {\n              console.log(`\uD83D\uDCE6 Terrain Results Keys: ${Object.keys(projectData.terrain_results).join(', ')}`);\n              if (projectData.terrain_results.exclusionZones) {\n                const ez = projectData.terrain_results.exclusionZones;\n                console.log(`\uD83D\uDEAB Exclusion Zones in Loaded Data:`, {\n                  buildings: ez.buildings?.length || 0,\n                  roads: ez.roads?.length || 0,\n                  waterBodies: ez.waterBodies?.length || 0\n                });\n              } else {\n                console.log(`\u26A0\uFE0F  WARNING: Loaded terrain_results has no exclusionZones!`);\n              }\n            }\n            console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n            \n            // Create project context for validation\n            projectContext = {\n              projectName,\n              coordinates: projectData.coordinates,\n              terrain_results: projectData.terrain_results,\n              layout_results: projectData.layout_results,\n              simulation_results: projectData.simulation_results,\n              report_results: projectData.report_results\n            };\n            \n            // Auto-fill missing parameters from project data BEFORE validation\n            const autoFilledParams: string[] = [];\n            \n            if (!intent.params.latitude && projectData.coordinates) {\n              intent.params.latitude = projectData.coordinates.latitude;\n              intent.params.longitude = projectData.coordinates.longitude;\n              autoFilledParams.push('latitude', 'longitude');\n              console.log(`\u2705 Auto-filled coordinates from project: (${projectData.coordinates.latitude}, ${projectData.coordinates.longitude})`);\n            }\n            \n            if (!intent.params.layout && projectData.layout_results) {\n              intent.params.layout = projectData.layout_results;\n              autoFilledParams.push('layout');\n              console.log(`\u2705 Auto-filled layout from project`);\n            }\n            \n            if (autoFilledParams.length > 0) {\n              console.log(`\uD83D\uDCDD Auto-filled parameters: ${autoFilledParams.join(', ')}`);\n            }\n            \n            // Merge project data into context for tool Lambda calls\n            const mergedContext = {\n              ...event.context,\n              projectData,\n              coordinates: projectData.coordinates,\n              terrain_results: projectData.terrain_results,\n              terrainResults: projectData.terrain_results,\n              layout_results: projectData.layout_results,\n              layoutResults: projectData.layout_results,\n              simulation_results: projectData.simulation_results,\n              simulationResults: projectData.simulation_results,\n              report_results: projectData.report_results,\n              reportResults: projectData.report_results\n            };\n            \n            // Update event context for tool Lambda calls\n            event.context = mergedContext;\n          } else {\n            console.log(`\u2139\uFE0F  No existing data found for project: ${projectName} (new project)`);\n          }\n        } catch (loadError) {\n          console.error('\u274C Error loading project data:', loadError);\n          console.warn('\u26A0\uFE0F  Continuing without project data');\n        }\n      }\n      \n      // Set as active project in session\n      if (projectName) {\n        await sessionContextManager.setActiveProject(sessionId, projectName);\n        await sessionContextManager.addToHistory(sessionId, projectName);\n        \n        // Add project name to intent params\n        intent.params.project_name = projectName;\n        if (!intent.params.project_id) {\n          intent.params.project_id = projectName; // Use project name as ID for now\n        }\n      }\n      \n      const projectResolutionDuration = Date.now() - projectResolutionStartTime;\n      console.log(`\u23F1\uFE0F  Project Context Resolution Duration: ${projectResolutionDuration}ms`);\n      console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n      \n      // Update thought step with completion\n      thoughtSteps[thoughtSteps.length - 1] = {\n        ...thoughtSteps[thoughtSteps.length - 1],\n        status: 'complete',\n        duration: projectResolutionDuration,\n        result: projectData ? `Loaded project: ${projectName}` : (projectName ? `New project: ${projectName}` : 'No project context')\n      };\n      \n    } catch (error) {\n      console.error('\u274C Error in project context resolution:', error);\n      // Continue without project context - will use fallback logic\n      console.warn('\u26A0\uFE0F  Continuing without project context');\n      \n      // Update thought step with error\n      const projectResolutionDuration = Date.now() - projectResolutionStartTime;\n      thoughtSteps[thoughtSteps.length - 1] = {\n        ...thoughtSteps[thoughtSteps.length - 1],\n        status: 'error',\n        duration: projectResolutionDuration,\n        error: {\n          message: 'Failed to resolve project context',\n          suggestion: 'Continuing without project context'\n        }\n      };\n    }\n    \n    // Step 4: Validate parameters (NOW WITH PROJECT CONTEXT)\n    const paramValidationStartTime = Date.now();\n    thoughtSteps.push({\n      step: 4,\n      action: 'Validating parameters',\n      reasoning: 'Checking parameters with project context',\n      status: 'in_progress',\n      timestamp: new Date(paramValidationStartTime).toISOString()\n    });\n    \n    const paramValidation = validateParameters(intent, projectContext);\n    const paramValidationDuration = Date.now() - paramValidationStartTime;\n    \n    // Log validation results with context information\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log('\u2705 PARAMETER VALIDATION RESULTS');\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\u2713 Valid: ${paramValidation.isValid}`);\n    console.log(`\uD83D\uDCDD Context Used: ${paramValidation.contextUsed}`);\n    console.log(`\u2705 Satisfied by Context: ${paramValidation.satisfiedByContext.join(', ') || 'none'}`);\n    console.log(`\u274C Missing Required: ${paramValidation.missingRequired.join(', ') || 'none'}`);\n    console.log(`\u26A0\uFE0F  Warnings: ${paramValidation.warnings.join(', ') || 'none'}`);\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    \n    // Update thought step with completion\n    thoughtSteps[thoughtSteps.length - 1] = {\n      ...thoughtSteps[thoughtSteps.length - 1],\n      status: paramValidation.isValid ? 'complete' : 'error',\n      duration: paramValidationDuration,\n      result: paramValidation.isValid \n        ? (paramValidation.contextUsed \n            ? `Parameters valid (${paramValidation.satisfiedByContext.length} from context)` \n            : 'All parameters valid')\n        : 'Missing required parameters',\n      ...(paramValidation.isValid ? {} : {\n        error: {\n          message: `Missing: ${paramValidation.missingRequired.join(', ')}`,\n          suggestion: 'Please provide all required parameters'\n        }\n      })\n    };\n    \n    if (!paramValidation.isValid) {\n      // Log validation failure to CloudWatch\n      logValidationFailure(paramValidation, intent, requestId, projectContext);\n      \n      const errorMessage = formatValidationError(paramValidation, intent.type, projectContext);\n      \n      return {\n        success: false,\n        message: errorMessage,\n        artifacts: [],\n        thoughtSteps,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed: [],\n          validationErrors: paramValidation.errors,\n          parameterValidation: {\n            missingRequired: paramValidation.missingRequired,\n            invalidValues: paramValidation.invalidValues,\n            contextUsed: paramValidation.contextUsed,\n            satisfiedByContext: paramValidation.satisfiedByContext\n          }\n        }\n      } as OrchestratorResponse;\n    }\n    \n    // Log validation success to CloudWatch (especially useful when context is used)\n    logValidationSuccess(paramValidation, intent, requestId, projectContext);\n    \n    // Apply default values for optional parameters\n    const intentWithDefaults = applyDefaultParameters(intent);\n    \n    console.log('\u2705 Parameter validation passed');\n    console.log(`\uD83D\uDCE6 Final parameters: ${JSON.stringify(intentWithDefaults.params, null, 2)}`);\n    \n    const toolStartTime = Date.now();\n    thoughtSteps.push({\n      step: 6,\n      action: `Calling ${intentWithDefaults.type} tool`,\n      reasoning: `Query matches ${intentWithDefaults.type} pattern with ${intentWithDefaults.confidence}% confidence, all parameters validated`,\n      status: 'in_progress',\n      timestamp: new Date(toolStartTime).toISOString()\n    });\n    \n    // Add NREL-specific thought steps for wind data operations\n    if (intentWithDefaults.type === 'wake_simulation' || intentWithDefaults.type === 'wind_rose' || intentWithDefaults.type === 'wind_rose_analysis' || intentWithDefaults.type === 'terrain_analysis') {\n      thoughtSteps.push({\n        step: thoughtSteps.length + 1,\n        action: 'Fetching wind data from NREL Wind Toolkit API',\n        reasoning: `Retrieving real meteorological data for coordinates (${intentWithDefaults.params.latitude}, ${intentWithDefaults.params.longitude}) from year 2023`,\n        status: 'in_progress',\n        timestamp: new Date().toISOString()\n      });\n    }\n    \n    // Step 5: Call appropriate tool Lambda(s) with fallback\n    // CRITICAL FIX: Pass full project data as context, not just event.context\n    const toolContext = {\n      ...event.context,\n      // Include loaded project data for parameter auto-fill\n      layout_results: projectData?.layout_results,\n      layoutResults: projectData?.layout_results,  // camelCase for backward compatibility\n      terrain_results: projectData?.terrain_results,\n      terrainResults: projectData?.terrain_results,  // camelCase for backward compatibility\n      simulation_results: projectData?.simulation_results,\n      simulationResults: projectData?.simulation_results,  // camelCase for backward compatibility\n      coordinates: projectData?.coordinates,\n      projectData: projectData  // Full project data for reference\n    };\n    \n    // DIAGNOSTIC: Log toolContext structure before calling tool Lambdas\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log('\uD83D\uDD27 TOOL CONTEXT PREPARATION');\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\uD83C\uDFAF Intent Type: ${intentWithDefaults.type}`);\n    console.log(`\uD83D\uDCE6 Tool Context Keys: ${Object.keys(toolContext).join(', ')}`);\n    console.log(`\uD83D\uDDFA\uFE0F  Has terrain_results: ${!!toolContext.terrain_results}`);\n    if (toolContext.terrain_results) {\n      console.log(`\uD83D\uDCE6 Terrain Results Keys: ${Object.keys(toolContext.terrain_results).join(', ')}`);\n      if (toolContext.terrain_results.exclusionZones) {\n        const ez = toolContext.terrain_results.exclusionZones;\n        console.log(`\uD83D\uDEAB Exclusion Zones in Tool Context:`, {\n          buildings: ez.buildings?.length || 0,\n          roads: ez.roads?.length || 0,\n          waterBodies: ez.waterBodies?.length || 0\n        });\n      } else {\n        console.log(`\u26A0\uFE0F  WARNING: terrain_results in toolContext has no exclusionZones!`);\n      }\n    } else {\n      console.log(`\u26A0\uFE0F  WARNING: No terrain_results in toolContext!`);\n    }\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    \n    const results = await callToolLambdasWithFallback(intentWithDefaults, event.query, toolContext, requestId, thoughtSteps);\n    timings.toolInvocation = Date.now() - toolStartTime;\n    toolsUsed.push(intentWithDefaults.type);\n    \n    // Update thought step with completion\n    thoughtSteps[5] = {\n      ...thoughtSteps[5],\n      status: results && results.length > 0 ? 'complete' : 'error',\n      duration: timings.toolInvocation,\n      result: results && results.length > 0 ? `Generated ${results.length} artifact(s)` : 'Tool execution failed',\n      ...(results && results.length > 0 ? {} : {\n        error: {\n          message: 'Tool execution failed',\n          suggestion: 'Check CloudWatch logs for details'\n        }\n      })\n    };\n    \n    if (!results || results.length === 0) {\n      return {\n        success: false,\n        message: 'Tool execution failed',\n        artifacts: [],\n        thoughtSteps,\n        metadata: {\n          executionTime: Date.now() - startTime,\n          toolsUsed\n        }\n      };\n    }\n    \n    const processingStartTime = Date.now();\n    thoughtSteps.push({\n      step: 7,\n      action: 'Processing results',\n      reasoning: 'Formatting tool output for display',\n      status: 'complete',\n      timestamp: new Date(processingStartTime).toISOString(),\n      duration: Date.now() - processingStartTime,\n      result: `Successfully processed ${results.length} result(s)`\n    });\n    \n    // Step 6: Save project data to S3\n    if (projectName && results && results.length > 0) {\n      const saveProjectStartTime = Date.now();\n      thoughtSteps.push({\n        step: 8,\n        action: 'Saving project data',\n        reasoning: `Persisting results for project: ${projectName}`,\n        status: 'in_progress',\n        timestamp: new Date(saveProjectStartTime).toISOString()\n      });\n      \n      try {\n        const projectStore = new ProjectStore(process.env.RENEWABLE_S3_BUCKET);\n        \n        // Extract results by type\n        const resultsByType: Record<string, any> = {};\n        for (const result of results) {\n          if (result.success && result.data) {\n            resultsByType[result.type] = result.data;\n          }\n        }\n        \n        // Prepare project data update\n        const projectDataUpdate: any = {\n          project_name: projectName,\n          updated_at: new Date().toISOString()\n        };\n        \n        // Add coordinates if this is terrain analysis\n        if (intentWithDefaults.type === 'terrain_analysis' && intentWithDefaults.params.latitude && intentWithDefaults.params.longitude) {\n          projectDataUpdate.coordinates = {\n            latitude: intentWithDefaults.params.latitude,\n            longitude: intentWithDefaults.params.longitude\n          };\n        }\n        \n        // Add results based on intent type\n        if (intentWithDefaults.type === 'terrain_analysis' && resultsByType.terrain_analysis) {\n          projectDataUpdate.terrain_results = resultsByType.terrain_analysis;\n          \n          // DIAGNOSTIC: Log terrain results structure being saved\n          console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n          console.log('\uD83D\uDCBE SAVING TERRAIN RESULTS TO CONTEXT');\n          console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n          console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n          console.log(`\uD83C\uDD94 Project Name: ${projectName}`);\n          console.log(`\uD83D\uDCE6 Terrain Results Keys: ${Object.keys(resultsByType.terrain_analysis).join(', ')}`);\n          if (resultsByType.terrain_analysis.exclusionZones) {\n            const ez = resultsByType.terrain_analysis.exclusionZones;\n            console.log(`\uD83D\uDEAB Exclusion Zones:`, {\n              buildings: ez.buildings?.length || 0,\n              roads: ez.roads?.length || 0,\n              waterBodies: ez.waterBodies?.length || 0\n            });\n          } else {\n            console.log(`\u26A0\uFE0F  WARNING: No exclusionZones in terrain results!`);\n          }\n          if (resultsByType.terrain_analysis.geojson) {\n            console.log(`\uD83D\uDDFA\uFE0F  GeoJSON Features: ${resultsByType.terrain_analysis.geojson.features?.length || 0}`);\n          }\n          console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        } else if (intentWithDefaults.type === 'layout_optimization' && resultsByType.layout_optimization) {\n          projectDataUpdate.layout_results = resultsByType.layout_optimization;\n          \n          // Extract metadata\n          if (resultsByType.layout_optimization.turbine_count) {\n            projectDataUpdate.metadata = {\n              turbine_count: resultsByType.layout_optimization.turbine_count,\n              total_capacity_mw: resultsByType.layout_optimization.total_capacity_mw\n            };\n          }\n        } else if (intentWithDefaults.type === 'wake_simulation' && resultsByType.wake_simulation) {\n          projectDataUpdate.simulation_results = resultsByType.wake_simulation;\n          \n          // Extract metadata\n          if (resultsByType.wake_simulation.annual_energy_gwh) {\n            projectDataUpdate.metadata = {\n              ...projectDataUpdate.metadata,\n              annual_energy_gwh: resultsByType.wake_simulation.annual_energy_gwh\n            };\n          }\n        } else if (intentWithDefaults.type === 'report_generation' && resultsByType.report_generation) {\n          projectDataUpdate.report_results = resultsByType.report_generation;\n        }\n        \n        // Save to S3\n        await projectStore.save(projectName, projectDataUpdate);\n        \n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        console.log('\uD83D\uDCBE PROJECT DATA SAVED');\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n        console.log(`\uD83C\uDD94 Project Name: ${projectName}`);\n        console.log(`\uD83D\uDCDD Updated Fields: ${Object.keys(projectDataUpdate).join(', ')}`);\n        console.log(`\u23F0 Saved At: ${projectDataUpdate.updated_at}`);\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        \n        const saveProjectDuration = Date.now() - saveProjectStartTime;\n        \n        // Update thought step with completion\n        thoughtSteps[thoughtSteps.length - 1] = {\n          ...thoughtSteps[thoughtSteps.length - 1],\n          status: 'complete',\n          duration: saveProjectDuration,\n          result: 'Project data saved to S3'\n        };\n        \n      } catch (error) {\n        console.error('\u274C Error saving project data:', error);\n        console.warn('\u26A0\uFE0F  Continuing without saving project data');\n        \n        const saveProjectDuration = Date.now() - saveProjectStartTime;\n        \n        // Update thought step with error\n        thoughtSteps[thoughtSteps.length - 1] = {\n          ...thoughtSteps[thoughtSteps.length - 1],\n          status: 'error',\n          duration: saveProjectDuration,\n          error: {\n            message: 'Failed to save project data',\n            suggestion: 'Results are still available but not persisted'\n          }\n        };\n        // Don't fail the request if saving fails\n      }\n    }\n    \n    // Step 7: Reload project data to get updated status\n    let updatedProjectData = projectData;\n    if (projectName) {\n      try {\n        const projectStore = new ProjectStore(process.env.RENEWABLE_S3_BUCKET);\n        updatedProjectData = await projectStore.load(projectName);\n      } catch (error) {\n        console.warn('Could not reload project data for status:', error);\n      }\n    }\n    \n    // Format results as EDI artifacts with action buttons\n    const formattingStartTime = Date.now();\n    console.log('\uD83D\uDD0D DEBUG - Results count before formatting:', results.length);\n    console.log('\uD83D\uDD0D DEBUG - Results types:', results.map(r => r.type));\n    const artifacts = formatArtifacts(results, intentWithDefaults.type, projectName || undefined, updatedProjectData);\n    console.log('\uD83D\uDD0D DEBUG - Artifacts count after formatting:', artifacts.length);\n    console.log('\uD83D\uDD0D DEBUG - Artifact types:', artifacts.map(a => a.type));\n    console.log('\uD83D\uDD0D DEBUG - Artifacts with actions:', artifacts.filter(a => a.actions).length);\n    \n    const message = generateResponseMessage(intentWithDefaults, results, projectName || undefined, updatedProjectData);\n    timings.resultFormatting = Date.now() - formattingStartTime;\n    \n    // Enhanced project ID logging\n    let projectId = intentWithDefaults.params.project_id || event.context?.projectId;\n    \n    // Ensure we always have a project ID (should already be set by applyDefaultParameters)\n    if (!projectId) {\n      projectId = `project-${Date.now()}`;\n    }\n    \n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log('\uD83C\uDD94 PROJECT ID GENERATION');\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\uD83C\uDD94 Project ID: ${projectId}`);\n    console.log(`\uD83D\uDCDD Source: ${intent.params.project_id ? 'From intent params' : (event.context?.projectId ? 'From context' : 'Generated')}`);\n    console.log(`\u23F0 Generated At: ${new Date().toISOString()}`);\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    \n    timings.total = Date.now() - startTime;\n    \n    // Calculate project status\n    const projectStatus = updatedProjectData ? {\n      terrain: !!updatedProjectData.terrain_results,\n      layout: !!updatedProjectData.layout_results,\n      simulation: !!updatedProjectData.simulation_results,\n      report: !!updatedProjectData.report_results\n    } : undefined;\n    \n    const response: OrchestratorResponse = {\n      success: true,\n      message,\n      artifacts,\n      thoughtSteps,\n      responseComplete: true,  // Signal to frontend that response is complete\n      metadata: {\n        executionTime: timings.total,\n        toolsUsed,\n        projectId,\n        projectName: projectName || undefined,\n        projectStatus,\n        requestId,\n        timings: {\n          validation: timings.validation || 0,\n          intentDetection: timings.intentDetection || 0,\n          toolInvocation: timings.toolInvocation || 0,\n          resultFormatting: timings.resultFormatting || 0,\n          total: timings.total\n        }\n      }\n    };\n    \n    // Enhanced final response logging\n    console.log('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n    console.log('\uD83C\uDF89 FINAL RESPONSE STRUCTURE');\n    console.log('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\u2705 Success: ${response.success}`);\n    console.log(`\uD83D\uDCDD Message: ${response.message}`);\n    console.log(`\uD83D\uDCCA Artifact Count: ${response.artifacts.length}`);\n    console.log(`\uD83D\uDD27 Tools Used: ${response.metadata.toolsUsed.join(', ')}`);\n    console.log(`\uD83C\uDD94 Project ID: ${response.metadata.projectId}`);\n    console.log('\u23F1\uFE0F  Execution Time Breakdown:');\n    console.log(`   - Validation: ${timings.validation}ms`);\n    console.log(`   - Intent Detection: ${timings.intentDetection}ms`);\n    console.log(`   - Tool Invocation: ${timings.toolInvocation}ms`);\n    console.log(`   - Result Formatting: ${timings.resultFormatting}ms`);\n    console.log(`   - Total: ${timings.total}ms`);\n    console.log('\uD83D\uDCE6 Artifacts:', response.artifacts.map(a => ({\n      type: a.type,\n      hasData: !!a.data,\n      dataKeys: Object.keys(a.data || {})\n    })));\n    console.log(`\uD83C\uDFAF Thought Steps: ${response.thoughtSteps.length}`);\n    console.log(`\uD83D\uDCE4 Full Response: ${JSON.stringify(response, null, 2)}`);\n    console.log('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n    \n    // CRITICAL: Do NOT save to database - frontend handles all saves\n    // This prevents duplicate messages (orchestrator + frontend both saving)\n    // Frontend save ensures proper loading state management and UI updates\n    if (event.sessionId && event.userId) {\n      console.log('\uD83D\uDD04 Session context provided - frontend will save message with artifacts');\n      console.log('   (Orchestrator skips save to prevent duplicates)');\n    }\n    \n    return response;\n    \n  } catch (error) {\n    console.error('Orchestrator error:', error);\n    \n    // Use renewable-specific error templates for better user experience\n    // Extract context from error if available\n    const errorContext: any = (error as any).template ? {\n      intentType: (error as any).intentType,\n      projectName: (error as any).projectName,\n      projectId: (error as any).projectId\n    } : {};\n    \n    const errorResult = RenewableErrorFormatter.generateErrorMessage(error, errorContext);\n    \n    // Enhanced error handling with specific remediation\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n    let remediationSteps: string[] = errorResult.template.nextSteps || [];\n    \n    // Add deployment-specific remediation if needed\n    if (errorMessage.includes('ResourceNotFoundException')) {\n      remediationSteps = [\n        'Run: npx ampx sandbox',\n        'Verify all Lambda functions are deployed',\n        'Check AWS Lambda console for function existence',\n        ...remediationSteps\n      ];\n    } else if (errorMessage.includes('AccessDenied')) {\n      remediationSteps = [\n        'Check AWS credentials: aws sts get-caller-identity',\n        'Verify IAM permissions for Lambda invocation',\n        'Update execution role if necessary',\n        ...remediationSteps\n      ];\n    }\n    \n    // Add error thought step\n    thoughtSteps.push({\n      step: thoughtSteps.length + 1,\n      action: 'Error occurred',\n      reasoning: errorResult.template.title,\n      status: 'error',\n      timestamp: new Date().toISOString(),\n      duration: 0,\n      error: {\n        message: errorResult.template.message,\n        suggestion: remediationSteps.join('; ')\n      }\n    });\n    \n    return {\n      success: false,\n      message: errorResult.formatted,\n      artifacts: [],\n      thoughtSteps,\n      metadata: {\n        executionTime: Date.now() - startTime,\n        toolsUsed,\n        errorCategory: 'RENEWABLE_WORKFLOW_ERROR',\n        errorTitle: errorResult.template.title,\n        error: {\n          type: error instanceof Error ? error.name : 'UnknownError',\n          message: errorMessage,\n          remediationSteps\n        }\n      }\n    };\n  }\n}\n\n/**\n * Fallback to direct tool invocation when Strands Agent fails\n * Maps agent type to direct tool Lambda and invokes it\n */\nasync function fallbackToDirectTools(\n  agentType: string,\n  query: string,\n  parameters: Record<string, any>,\n  requestId: string\n): Promise<OrchestratorResponse> {\n  console.log('\uD83D\uDD04 FALLBACK TO DIRECT TOOLS');\n  console.log(`   Agent type: ${agentType}`);\n  console.log(`   Query: ${query.substring(0, 100)}`);\n  \n  try {\n    // Map agent type to tool Lambda function name\n    let functionName: string | undefined;\n    let toolType: string;\n    \n    switch (agentType) {\n      case 'terrain':\n        functionName = process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME;\n        toolType = 'terrain_analysis';\n        break;\n      case 'layout':\n        functionName = process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME;\n        toolType = 'layout_optimization';\n        break;\n      case 'simulation':\n        functionName = process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME;\n        toolType = 'wake_simulation';\n        break;\n      case 'report':\n        functionName = process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME;\n        toolType = 'report_generation';\n        break;\n      default:\n        // For multi-agent or unknown, try to infer from query\n        const intent = await parseIntent(query, parameters);\n        toolType = intent.type;\n        \n        switch (intent.type) {\n          case 'terrain_analysis':\n            functionName = process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME;\n            break;\n          case 'layout_optimization':\n            functionName = process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME;\n            break;\n          case 'wake_simulation':\n          case 'wind_rose':\n            functionName = process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME;\n            break;\n          case 'report_generation':\n            functionName = process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME;\n            break;\n        }\n    }\n    \n    if (!functionName) {\n      throw new Error(`No direct tool Lambda configured for agent type: ${agentType}`);\n    }\n    \n    console.log(`\u2705 Mapped to direct tool: ${functionName}`);\n    \n    // Prepare payload for direct tool invocation\n    const payload = {\n      parameters: {\n        ...parameters,\n        project_id: parameters.project_id || parameters.projectId || `fallback-${Date.now()}`\n      }\n    };\n    \n    // Invoke direct tool Lambda\n    const command = new InvokeCommand({\n      FunctionName: functionName,\n      Payload: JSON.stringify(payload)\n    });\n    \n    const response = await lambdaClient.send(command);\n    \n    if (!response.Payload) {\n      throw new Error('No payload in direct tool response');\n    }\n    \n    const result = JSON.parse(new TextDecoder().decode(response.Payload));\n    \n    // Parse response body if it's a Lambda proxy response\n    let toolResult = result;\n    if (result.body) {\n      toolResult = typeof result.body === 'string' ? JSON.parse(result.body) : result.body;\n    }\n    \n    console.log('\u2705 Direct tool invocation successful');\n    \n    // Format as orchestrator response with fallbackUsed flag\n    const artifacts = toolResult.data ? [{\n      type: toolType,\n      data: {\n        ...toolResult.data,\n        fallbackUsed: true\n      }\n    }] : [];\n    \n    return {\n      success: true,\n      message: toolResult.message || 'Analysis completed using basic mode',\n      artifacts,\n      thoughtSteps: [],\n      metadata: {\n        executionTime: 0,\n        toolsUsed: [toolType],\n        requestId,\n        fallbackUsed: true,\n        fallbackReason: 'Strands Agent timeout/throttling'\n      }\n    };\n    \n  } catch (error) {\n    console.error('\u274C Fallback to direct tools failed:', error);\n    \n    return {\n      success: false,\n      message: `Fallback failed: ${error instanceof Error ? error.message : String(error)}`,\n      artifacts: [],\n      thoughtSteps: [],\n      metadata: {\n        executionTime: 0,\n        toolsUsed: [],\n        requestId,\n        fallbackUsed: true,\n        fallbackFailed: true\n      }\n    };\n  }\n}\n\n/**\n * Parse user query to determine intent using the new IntentRouter\n */\nasync function parseIntent(query: string, context?: any): Promise<RenewableIntent> {\n  const router = new IntentRouter();\n  \n  try {\n    const routingResult = await router.routeQuery(query, context);\n    \n    // Handle confirmation requirements\n    if (routingResult.requiresConfirmation && routingResult.confirmationMessage) {\n      console.log('\u26A0\uFE0F Intent requires confirmation:', routingResult.confirmationMessage);\n      \n      // For now, proceed with the suggested intent but log the uncertainty\n      // In a full implementation, this would trigger a user confirmation dialog\n      console.log('\uD83D\uDCDD Fallback options available:', routingResult.fallbackOptions);\n    }\n    \n    return routingResult.intent;\n  } catch (error) {\n    console.error('\u274C Error in intent routing:', error);\n    \n    // Fallback to basic terrain analysis\n    return {\n      type: 'terrain_analysis',\n      params: extractTerrainParams(query),\n      confidence: 30\n    };\n  }\n}\n\n/**\n * Check if query matches any of the patterns\n */\nfunction matchesAny(query: string, patterns: RegExp[]): boolean {\n  return patterns.some(pattern => pattern.test(query));\n}\n\n/**\n * Extract terrain analysis parameters from query\n */\nfunction extractTerrainParams(query: string): Record<string, any> {\n  const params: Record<string, any> = {};\n  \n  // Safety check for undefined query\n  if (!query || typeof query !== 'string') {\n    console.warn('extractTerrainParams called with invalid query:', query);\n    return params;\n  }\n  \n  // Extract coordinates - look for decimal coordinates (latitude, longitude)\n  const coordMatch = query.match(/(-?\\d+\\.\\d+)\\s*,\\s*(-?\\d+\\.\\d+)/);\n  if (coordMatch) {\n    params.latitude = parseFloat(coordMatch[1]);\n    params.longitude = parseFloat(coordMatch[2]);\n  }\n  \n  // Extract radius\n  const radiusMatch = query.match(/(\\d+)\\s*km/i);\n  if (radiusMatch) {\n    params.radius_km = parseFloat(radiusMatch[1]);\n  }\n  \n  // Extract setback\n  const setbackMatch = query.match(/(\\d+)\\s*m.*setback/i);\n  if (setbackMatch) {\n    params.setback_m = parseInt(setbackMatch[1]);\n  }\n  \n  // Extract or generate project ID\n  const projectIdMatch = query.match(/project[_\\s]id[:\\s]+['\"]?([a-zA-Z0-9-]+)['\"]?/i);\n  if (projectIdMatch) {\n    params.project_id = projectIdMatch[1];\n  } else {\n    params.project_id = `project-${Date.now()}`;\n  }\n  \n  return params;\n}\n\n/**\n * Extract layout optimization parameters from query\n */\nfunction extractLayoutParams(query: string): Record<string, any> {\n  const params: Record<string, any> = {};\n  \n  // Safety check for undefined query\n  if (!query || typeof query !== 'string') {\n    console.warn('extractLayoutParams called with invalid query:', query);\n    return params;\n  }\n  \n  // Extract coordinates - look for decimal coordinates (latitude, longitude)\n  const coordMatch = query.match(/(-?\\d+\\.\\d+)\\s*,\\s*(-?\\d+\\.\\d+)/);\n  if (coordMatch) {\n    params.center_lat = parseFloat(coordMatch[1]);\n    params.center_lon = parseFloat(coordMatch[2]);\n  }\n  \n  // Extract number of turbines\n  const turbineMatch = query.match(/(\\d+)\\s*turbine/i);\n  if (turbineMatch) {\n    params.num_turbines = parseInt(turbineMatch[1]);\n  }\n  \n  // Extract capacity\n  const capacityMatch = query.match(/(\\d+)\\s*mw/i);\n  if (capacityMatch) {\n    const totalCapacity = parseInt(capacityMatch[1]);\n    params.num_turbines = params.num_turbines || Math.ceil(totalCapacity / 2.5);\n  }\n  \n  // Extract layout type\n  if (/offset.*grid/i.test(query)) {\n    params.layout_type = 'offset_grid';\n  } else if (/spiral/i.test(query)) {\n    params.layout_type = 'spiral';\n  } else if (/greedy/i.test(query)) {\n    params.layout_type = 'greedy';\n  } else {\n    params.layout_type = 'grid';\n  }\n  \n  // Extract or generate project ID\n  const projectIdMatch = query.match(/project[_\\s]id[:\\s]+['\"]?([a-zA-Z0-9-]+)['\"]?/i);\n  if (projectIdMatch) {\n    params.project_id = projectIdMatch[1];\n  } else {\n    params.project_id = `project-${Date.now()}`;\n  }\n  \n  return params;\n}\n\n/**\n * Extract simulation parameters from query\n */\nfunction extractSimulationParams(query: string): Record<string, any> {\n  const params: Record<string, any> = {};\n  \n  // Extract project ID\n  const projectIdMatch = query.match(/project[_\\s]id[:\\s]+['\"]?([a-zA-Z0-9-]+)['\"]?/i);\n  if (projectIdMatch) {\n    params.project_id = projectIdMatch[1];\n  }\n  \n  // Extract wind speed\n  const windSpeedMatch = query.match(/(\\d+\\.?\\d*)\\s*m\\/s/i);\n  if (windSpeedMatch) {\n    params.wind_speed = parseFloat(windSpeedMatch[1]);\n  }\n  \n  return params;\n}\n\n/**\n * Extract report parameters from query\n */\nfunction extractReportParams(query: string): Record<string, any> {\n  const params: Record<string, any> = {};\n  \n  // Extract project ID\n  const projectIdMatch = query.match(/project[_\\s]id[:\\s]+['\"]?([a-zA-Z0-9-]+)['\"]?/i);\n  if (projectIdMatch) {\n    params.project_id = projectIdMatch[1];\n  }\n  \n  return params;\n}\n\n/**\n * Quick validation check for deployment status\n */\nasync function quickValidationCheck(): Promise<ValidationResult> {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n  \n  // Check environment variables\n  const requiredEnvVars = [\n    'RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME',\n    'RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME',\n    'RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME',\n    'RENEWABLE_REPORT_TOOL_FUNCTION_NAME'\n  ];\n  \n  for (const envVar of requiredEnvVars) {\n    if (!process.env[envVar]) {\n      errors.push(`Missing environment variable: ${envVar}`);\n    }\n  }\n  \n  // If we have critical errors, we can't proceed\n  const canProceed = errors.length === 0;\n  \n  return {\n    isValid: canProceed && warnings.length === 0,\n    errors,\n    warnings,\n    canProceed\n  };\n}\n\n/**\n * Call appropriate tool Lambda(s) with fallback\n */\nasync function callToolLambdasWithFallback(\n  intent: RenewableIntent,\n  query: string,\n  context: any | undefined,\n  requestId: string,\n  thoughtSteps: ThoughtStep[]\n): Promise<ToolResult[]> {\n  // NEVER use fallback mock data - let errors surface\n  return await callToolLambdas(intent, query, context, requestId, thoughtSteps);\n}\n\n/**\n * Call appropriate tool Lambda(s)\n */\nasync function callToolLambdas(\n  intent: RenewableIntent,\n  query: string,\n  context: any | undefined,\n  requestId: string,\n  thoughtSteps: ThoughtStep[]\n): Promise<ToolResult[]> {\n  const results: ToolResult[] = [];\n  let functionName: string = '';\n  let payload: any;\n  \n  try {\n    \n    switch (intent.type) {\n      case 'terrain_analysis':\n        // Use lightweight ZIP-deployed terrain Lambda\n        functionName = process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME || 'renewable-terrain-simple';\n        payload = {\n          parameters: {\n            project_id: intent.params.project_id,\n            latitude: intent.params.latitude,\n            longitude: intent.params.longitude,\n            radius_km: intent.params.radius_km || 5\n          }\n        };\n        break;\n        \n      case 'layout_optimization':\n        // Use lightweight layout Lambda\n        functionName = process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME || 'renewable-layout-simple';\n        \n        // DIAGNOSTIC: Log context structure before passing to layout\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        console.log('\uD83D\uDD0D LAYOUT INVOCATION - Context Diagnostic');\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n        console.log(`\uD83D\uDCE6 Context Keys: ${Object.keys(context || {}).join(', ')}`);\n        console.log(`\uD83D\uDDFA\uFE0F  Has terrain_results: ${!!context?.terrain_results}`);\n        console.log(`\uD83D\uDDFA\uFE0F  Has terrainResults (camelCase): ${!!context?.terrainResults}`);\n        \n        if (context?.terrain_results) {\n          console.log(`\uD83D\uDCE6 Terrain Results Keys: ${Object.keys(context.terrain_results).join(', ')}`);\n          console.log(`\uD83D\uDEAB Has exclusionZones: ${!!context.terrain_results.exclusionZones}`);\n          \n          if (context.terrain_results.exclusionZones) {\n            const ez = context.terrain_results.exclusionZones;\n            console.log(`\uD83D\uDEAB Exclusion Zones Being Passed to Layout:`, {\n              buildings: ez.buildings?.length || 0,\n              roads: ez.roads?.length || 0,\n              waterBodies: ez.waterBodies?.length || 0,\n              totalFeatures: (ez.buildings?.length || 0) + (ez.roads?.length || 0) + (ez.waterBodies?.length || 0)\n            });\n            \n            // Log sample of each type if available\n            if (ez.buildings && ez.buildings.length > 0) {\n              console.log(`   Sample building:`, JSON.stringify(ez.buildings[0]).substring(0, 200));\n            }\n            if (ez.roads && ez.roads.length > 0) {\n              console.log(`   Sample road:`, JSON.stringify(ez.roads[0]).substring(0, 200));\n            }\n            if (ez.waterBodies && ez.waterBodies.length > 0) {\n              console.log(`   Sample water body:`, JSON.stringify(ez.waterBodies[0]).substring(0, 200));\n            }\n          } else {\n            console.log(`\u26A0\uFE0F  WARNING: terrain_results exists but has NO exclusionZones!`);\n            console.log(`   This means intelligent placement will fall back to grid pattern`);\n          }\n          \n          if (context.terrain_results.geojson) {\n            console.log(`\uD83D\uDDFA\uFE0F  GeoJSON Features: ${context.terrain_results.geojson.features?.length || 0}`);\n          }\n        } else {\n          console.log(`\u26A0\uFE0F  WARNING: No terrain_results in context!`);\n          console.log(`   Layout will use grid pattern instead of intelligent placement`);\n        }\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        \n        payload = {\n          parameters: {\n            project_id: intent.params.project_id,\n            latitude: intent.params.latitude,\n            longitude: intent.params.longitude,\n            area_km2: intent.params.area_km2 || 5.0,\n            turbine_spacing_m: intent.params.turbine_spacing_m || 500,\n            constraints: context?.terrainFeatures || []\n          },\n          // Pass project context to layout Lambda for parameter auto-fill\n          // CRITICAL: This must include terrain_results with exclusionZones\n          project_context: context || {}\n        };\n        \n        // DIAGNOSTIC: Log the actual payload being sent\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        console.log('\uD83D\uDCE4 LAYOUT LAMBDA PAYLOAD');\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n        console.log(`\uD83D\uDCE6 Payload Keys: ${Object.keys(payload).join(', ')}`);\n        console.log(`\uD83D\uDCE6 project_context Keys: ${Object.keys(payload.project_context || {}).join(', ')}`);\n        console.log(`\uD83D\uDDFA\uFE0F  project_context has terrain_results: ${!!payload.project_context?.terrain_results}`);\n        if (payload.project_context?.terrain_results?.exclusionZones) {\n          const ez = payload.project_context.terrain_results.exclusionZones;\n          console.log(`\uD83D\uDEAB Exclusion Zones in Payload:`, {\n            buildings: ez.buildings?.length || 0,\n            roads: ez.roads?.length || 0,\n            waterBodies: ez.waterBodies?.length || 0\n          });\n        }\n        console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n        break;\n        \n      case 'wake_simulation':\n        // Use lightweight simulation Lambda\n        functionName = process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME || 'renewable-simulation-simple';\n        \n        // Fetch layout data from S3 if not in context\n        // Check both snake_case and camelCase for backward compatibility\n        let layoutData = context?.layout || context?.layout_results || context?.layoutResults || intent.params.layout;\n        \n        if (!layoutData && intent.params.project_id) {\n          try {\n            console.log(`\uD83D\uDCE6 Fetching layout data for project ${intent.params.project_id} from S3`);\n            const { S3Client, GetObjectCommand } = await import('@aws-sdk/client-s3');\n            const s3Client = new S3Client({ region: process.env.AWS_REGION || 'us-east-1' });\n            \n            const s3Key = `renewable/layout/${intent.params.project_id}/layout.json`;\n            const command = new GetObjectCommand({\n              Bucket: process.env.RENEWABLE_S3_BUCKET,\n              Key: s3Key\n            });\n            \n            const response = await s3Client.send(command);\n            const bodyString = await response.Body?.transformToString();\n            \n            if (bodyString) {\n              const layoutResult = JSON.parse(bodyString);\n              layoutData = layoutResult.layout || layoutResult;\n              console.log(`\u2705 Retrieved layout with ${layoutData.features?.length || 0} turbines from S3`);\n            }\n          } catch (s3Error: any) {\n            console.warn(`\u26A0\uFE0F Could not fetch layout from S3: ${s3Error.message}`);\n            console.warn(`   This is expected if layout hasn't been generated yet for project ${intent.params.project_id}`);\n          }\n        }\n        \n        // If still no layout data, log warning but continue with empty layout\n        // The error will be caught and handled by the main handler\n        if (!layoutData) {\n          console.warn(`\u26A0\uFE0F No layout data available for project ${intent.params.project_id}`);\n          console.warn(`   User should run layout optimization first`);\n          \n          // Throw error with renewable-specific template\n          const errorTemplate = RENEWABLE_ERROR_MESSAGES.LAYOUT_MISSING;\n          const error = new Error(errorTemplate.message);\n          (error as any).template = errorTemplate;\n          (error as any).errorCategory = 'MISSING_PREREQUISITE';\n          (error as any).missingData = 'layout';\n          throw error;\n        }\n        \n        payload = {\n          parameters: {\n            project_id: intent.params.project_id,\n            layout: layoutData,\n            wind_speed: intent.params.wind_speed || 8.5,\n            wind_direction: intent.params.wind_direction || 270\n          },\n          // Pass project context to simulation Lambda for parameter auto-fill\n          project_context: context || {}\n        };\n        break;\n        \n      case 'wind_rose':\n        // Use lightweight simulation Lambda with wind_rose action\n        functionName = process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME || 'renewable-simulation-simple';\n        payload = {\n          action: 'wind_rose',\n          parameters: {\n            project_id: intent.params.project_id,\n            latitude: intent.params.latitude,\n            longitude: intent.params.longitude,\n            wind_speed: intent.params.wind_speed || 8.5\n          }\n        };\n        break;\n        \n      case 'report_generation':\n        functionName = process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME || '';\n        payload = {\n          query,\n          parameters: {\n            ...intent.params,\n            terrain_results: context?.terrain_results || context?.terrainResults,\n            layout_results: context?.layout_results || context?.layoutResults,\n            simulation_results: context?.simulation_results || context?.simulationResults\n          }\n        };\n        break;\n        \n      default:\n        throw new Error(`Unknown intent type: ${intent.type}`);\n    }\n    \n    if (!functionName) {\n      // Log the actual environment variables to debug deployment issue\n      console.error(`Tool Lambda not configured for ${intent.type}`);\n      console.error('Environment variables:', {\n        RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME: process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME,\n        RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME: process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME,\n        RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME: process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME,\n        RENEWABLE_REPORT_TOOL_FUNCTION_NAME: process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME\n      });\n      \n      // NEVER return mock data - throw error for missing Lambda\n      throw new Error(`Lambda function not configured for ${intent.type}. Function name: ${functionName}. Check environment variables.`);\n    }\n    \n    // Enhanced tool Lambda invocation logging\n    const toolInvocationStartTime = Date.now();\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log('\uD83D\uDD27 TOOL LAMBDA INVOCATION');\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\uD83C\uDFAF Intent Type: ${intent.type}`);\n    console.log(`\uD83D\uDCE6 Function Name: ${functionName}`);\n    console.log(`\uD83D\uDCE4 Payload: ${JSON.stringify(payload, null, 2)}`);\n    console.log(`\u23F0 Invocation Time: ${new Date(toolInvocationStartTime).toISOString()}`);\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    \n    const result = await invokeLambdaWithRetry(functionName, payload);\n    const toolInvocationDuration = Date.now() - toolInvocationStartTime;\n    \n    // Enhanced tool Lambda response logging\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log('\u2705 TOOL LAMBDA RESPONSE');\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    console.log(`\uD83D\uDCCB Request ID: ${requestId}`);\n    console.log(`\uD83C\uDFAF Intent Type: ${intent.type}`);\n    console.log(`\uD83D\uDCE6 Function Name: ${functionName}`);\n    console.log(`\u2714\uFE0F  Success: ${result.success}`);\n    console.log(`\uD83D\uDCCA Artifact Count: ${result.data?.visualizations ? Object.keys(result.data.visualizations).length : 0}`);\n    console.log(`\uD83D\uDCDD Message: ${result.data?.message || 'No message'}`);\n    console.log(`\u23F1\uFE0F  Execution Duration: ${toolInvocationDuration}ms`);\n    console.log(`\uD83D\uDCE5 Full Response: ${JSON.stringify(result, null, 2)}`);\n    console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n    \n    // Update NREL thought steps with actual data from response\n    const windDataIntents = ['wake_simulation', 'wind_rose', 'wind_rose_analysis', 'terrain_analysis'];\n    if (windDataIntents.includes(intent.type)) {\n      const nrelFetchStepIndex = thoughtSteps.findIndex(step => \n        step.action.includes('Fetching wind data from NREL Wind Toolkit API')\n      );\n      \n      if (nrelFetchStepIndex !== -1 && result.success) {\n        // Update NREL fetch step with completion\n        const dataSource = result.data?.data_source || 'NREL Wind Toolkit';\n        const dataYear = result.data?.data_year || result.data?.wind_data?.data_year || 2023;\n        const totalHours = result.data?.wind_data?.total_hours || result.data?.total_hours || 8760;\n        const meanWindSpeed = result.data?.wind_data?.mean_wind_speed || result.data?.mean_wind_speed;\n        \n        thoughtSteps[nrelFetchStepIndex] = {\n          ...thoughtSteps[nrelFetchStepIndex],\n          status: 'complete',\n          duration: Math.floor(toolInvocationDuration * 0.3), // Estimate ~30% of time for API fetch\n          result: `Retrieved wind data from ${dataSource} (${dataYear}), ${totalHours} data points`\n        };\n        \n        // Add data processing thought step\n        thoughtSteps.push({\n          step: thoughtSteps.length + 1,\n          action: 'Processing wind data with Weibull distribution fitting',\n          reasoning: 'Analyzing wind patterns and calculating statistical parameters for accurate site assessment',\n          status: 'complete',\n          timestamp: new Date(toolInvocationStartTime + toolInvocationDuration * 0.3).toISOString(),\n          duration: Math.floor(toolInvocationDuration * 0.4), // Estimate ~40% of time for processing\n          result: meanWindSpeed \n            ? `Processed ${totalHours} hours of data, mean wind speed: ${meanWindSpeed.toFixed(2)} m/s, Weibull parameters calculated`\n            : `Wind data processed with Weibull fitting for ${totalHours} hours`\n        });\n        \n        // Add sub-agent decision reasoning for parameter validation\n        thoughtSteps.push({\n          step: thoughtSteps.length + 1,\n          action: 'Sub-agent: Parameter validation',\n          reasoning: `Validated coordinates (${intent.params.latitude?.toFixed(6)}, ${intent.params.longitude?.toFixed(6)}) are within NREL Wind Toolkit coverage area (Continental US)`,\n          status: 'complete',\n          timestamp: new Date(toolInvocationStartTime).toISOString(),\n          duration: 50,\n          result: 'Coordinates validated, within NREL coverage'\n        });\n        \n        // Add tool selection reasoning\n        thoughtSteps.push({\n          step: thoughtSteps.length + 1,\n          action: 'Sub-agent: Data source selection',\n          reasoning: `Selected NREL Wind Toolkit API as primary data source. Real meteorological data preferred over synthetic data per system requirements.`,\n          status: 'complete',\n          timestamp: new Date(toolInvocationStartTime + 50).toISOString(),\n          duration: 30,\n          result: 'NREL Wind Toolkit API selected (real data)'\n        });\n        \n        // Add data quality assessment reasoning\n        if (result.data?.reliability || result.data?.wind_data?.reliability) {\n          const reliability = result.data?.reliability || result.data?.wind_data?.reliability;\n          thoughtSteps.push({\n            step: thoughtSteps.length + 1,\n            action: 'Sub-agent: Data quality assessment',\n            reasoning: `Assessed data quality and completeness for ${totalHours} hours of measurements`,\n            status: 'complete',\n            timestamp: new Date(toolInvocationStartTime + 80).toISOString(),\n            duration: 40,\n            result: `Data quality: ${reliability}, suitable for analysis`\n          });\n        }\n      } else if (nrelFetchStepIndex !== -1 && !result.success) {\n        // Update with error\n        thoughtSteps[nrelFetchStepIndex] = {\n          ...thoughtSteps[nrelFetchStepIndex],\n          status: 'error',\n          duration: toolInvocationDuration,\n          error: {\n            message: result.error || 'Failed to fetch NREL data',\n            suggestion: 'Check NREL_API_KEY environment variable and verify coordinates are within Continental US'\n          }\n        };\n      }\n    }\n    \n    results.push(result);\n    \n  } catch (error) {\n    console.error('\u274C Error calling tool Lambda:', error);\n    console.error('Error details:', {\n      name: error instanceof Error ? error.name : 'Unknown',\n      message: error instanceof Error ? error.message : 'Unknown error',\n      stack: error instanceof Error ? error.stack : 'No stack trace',\n      functionName,\n      intentType: intent.type,\n      params: intent.params\n    });\n    \n    // Use renewable-specific error templates\n    const errorMessage = error instanceof Error ? error.message : 'Unknown error';\n    const errorType = RenewableErrorFormatter.detectErrorType(error, intent.type);\n    \n    // NEVER return mock data - throw the real error\n    // Check if it's a function not found error\n    if (errorMessage.includes('ResourceNotFoundException') || errorMessage.includes('Function not found')) {\n      const deploymentError = RENEWABLE_ERROR_MESSAGES.DEPLOYMENT_ISSUE(intent.type);\n      throw new Error(`Lambda function ${functionName} not found. ${deploymentError.message}`);\n    } else if (errorType === 'LAMBDA_TIMEOUT') {\n      const timeoutError = RENEWABLE_ERROR_MESSAGES.LAMBDA_TIMEOUT;\n      throw new Error(`Lambda timeout for ${intent.type}: ${timeoutError.message}`);\n    } else if (errorType === 'S3_RETRIEVAL_FAILED') {\n      const s3Error = RENEWABLE_ERROR_MESSAGES.S3_RETRIEVAL_FAILED;\n      throw new Error(`S3 retrieval failed for ${intent.type}: ${s3Error.message}`);\n    } else {\n      // Generic Lambda invocation error - throw it\n      throw new Error(`Lambda execution failed for ${intent.type}: ${errorMessage}`);\n    }\n  }\n  \n  return results;\n}\n\n// REMOVED: generateMockToolResult function\n// We NEVER return mock data. All errors must surface as real errors.\n\n/**\n * Invoke Lambda with retry logic\n */\nasync function invokeLambdaWithRetry(\n  functionName: string,\n  payload: any,\n  maxRetries: number = 3\n): Promise<ToolResult> {\n  let lastError: Error | undefined;\n  \n  for (let attempt = 0; attempt < maxRetries; attempt++) {\n    try {\n      const command = new InvokeCommand({\n        FunctionName: functionName,\n        Payload: JSON.stringify(payload)\n      });\n      \n      const response = await lambdaClient.send(command);\n      \n      if (!response.Payload) {\n        throw new Error('No payload in Lambda response');\n      }\n      \n      const result = JSON.parse(new TextDecoder().decode(response.Payload));\n      \n      // Parse the body if it's a Lambda proxy response\n      if (result.body) {\n        const body = JSON.parse(result.body);\n        \n        // If body has type and data fields, use them directly\n        if (body.type && body.data) {\n          return {\n            success: body.success,\n            type: body.type,\n            data: body.data,\n            error: body.error\n          };\n        }\n        \n        // Otherwise, treat the entire body as data and infer type from content\n        let inferredType = 'unknown';\n        if (body.wind_rose_data) {\n          inferredType = 'wind_rose';\n        } else if (body.wake_loss_percent !== undefined) {\n          inferredType = 'wake_simulation';\n        } else if (body.turbine_count && body.layout) {\n          inferredType = 'layout_optimization';\n        } else if (body.feature_count) {\n          inferredType = 'terrain_analysis';\n        }\n        \n        return {\n          success: body.success,\n          type: inferredType,\n          data: body,\n          error: body.error\n        };\n      }\n      \n      return result;\n      \n    } catch (error) {\n      lastError = error as Error;\n      const errorMessage = lastError?.message || String(error);\n      \n      console.error(`\u274C Lambda invocation attempt ${attempt + 1}/${maxRetries} failed`);\n      console.error(`   Function: ${functionName}`);\n      console.error(`   Error: ${errorMessage.substring(0, 500)}`); // Limit error message length\n      \n      // Check if this is a timeout error\n      const isTimeout = errorMessage.toLowerCase().includes('timeout') || \n                       errorMessage.toLowerCase().includes('timed out');\n      \n      if (isTimeout) {\n        console.warn('\u26A0\uFE0F Lambda timeout detected - function exceeded time limit');\n      }\n      \n      // Check for function error (error in the Lambda code itself)\n      if (errorMessage.includes('FunctionError')) {\n        console.error('\u26A0\uFE0F Function error detected - Lambda code threw an exception');\n      }\n      \n      if (attempt < maxRetries - 1) {\n        const backoffMs = Math.pow(2, attempt) * 1000;\n        console.log(`   Retrying in ${backoffMs}ms...`);\n        await new Promise(resolve => setTimeout(resolve, backoffMs));\n      }\n    }\n  }\n  \n  // Log final failure with clear error message\n  console.error('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n  console.error('\u274C LAMBDA INVOCATION FAILED AFTER ALL RETRIES');\n  console.error('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n  console.error(`Function: ${functionName}`);\n  console.error(`Attempts: ${maxRetries}`);\n  console.error(`Final Error: ${lastError?.message?.substring(0, 1000) || 'Unknown error'}`);\n  console.error('\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550\u2550');\n  \n  // Return a clear, non-repetitive error message\n  const rootCause = lastError?.message?.split(':')[0] || 'Unknown error';\n  throw new Error(`Layout optimization failed: ${rootCause}. Check CloudWatch logs for details.`);\n}\n\n/**\n * Get default title for artifact type\n */\nfunction getDefaultTitle(artifactType: string, projectId?: string): string {\n  const titles: Record<string, string> = {\n    'wind_farm_terrain_analysis': 'Terrain Analysis Results',\n    'terrain_analysis': 'Terrain Analysis Results',\n    'wind_farm_layout': 'Wind Farm Layout Optimization',\n    'layout_optimization': 'Wind Farm Layout Optimization',\n    'wake_simulation': 'Wake Simulation Analysis',\n    'wake_analysis': 'Wake Simulation Analysis',\n    'wind_rose_analysis': 'Wind Rose Analysis',\n    'wind_rose': 'Wind Rose Analysis',\n    'wind_farm_report': 'Comprehensive Wind Farm Report',\n    'report_generation': 'Comprehensive Wind Farm Report',\n    'project_dashboard': 'Project Dashboard'\n  };\n  \n  const baseTitle = titles[artifactType] || 'Analysis Results';\n  return projectId ? `${baseTitle} - ${projectId}` : baseTitle;\n}\n\n/**\n * Get default subtitle for artifact type with coordinates if available\n */\nfunction getDefaultSubtitle(artifactType: string, data: any): string {\n  // Extract coordinates from various possible locations\n  const coordinates = data.coordinates || data.location;\n  let coordString = '';\n  \n  if (coordinates) {\n    if (typeof coordinates === 'object') {\n      const lat = coordinates.latitude || coordinates.lat;\n      const lon = coordinates.longitude || coordinates.lon || coordinates.lng;\n      if (lat !== undefined && lon !== undefined) {\n        coordString = `Site: ${Number(lat).toFixed(4)}\u00B0, ${Number(lon).toFixed(4)}\u00B0`;\n      }\n    }\n  }\n  \n  // Type-specific subtitles\n  switch (artifactType) {\n    case 'wind_farm_terrain_analysis':\n    case 'terrain_analysis':\n      if (data.metrics) {\n        const featureCount = data.metrics.totalFeatures || data.metrics.featureCount;\n        if (featureCount) {\n          return coordString ? `${coordString} \u2022 ${featureCount} features analyzed` : `${featureCount} features analyzed`;\n        }\n      }\n      return coordString || 'Site terrain and constraints analysis';\n      \n    case 'wind_farm_layout':\n    case 'layout_optimization':\n      if (data.turbineCount && data.totalCapacity) {\n        const layoutInfo = `${data.turbineCount} turbines, ${data.totalCapacity} MW capacity`;\n        return coordString ? `${coordString} \u2022 ${layoutInfo}` : layoutInfo;\n      }\n      return coordString || 'Optimized turbine placement';\n      \n    case 'wake_simulation':\n    case 'wake_analysis':\n      if (data.performanceMetrics?.netAEP) {\n        const aepInfo = `${data.performanceMetrics.netAEP.toFixed(2)} GWh/year`;\n        return coordString ? `${coordString} \u2022 ${aepInfo}` : aepInfo;\n      }\n      if (data.turbineMetrics?.count) {\n        const turbineInfo = `${data.turbineMetrics.count} turbines analyzed`;\n        return coordString ? `${coordString} \u2022 ${turbineInfo}` : turbineInfo;\n      }\n      return coordString || 'Wake effects and energy production';\n      \n    case 'wind_rose_analysis':\n    case 'wind_rose':\n      if (data.windStatistics) {\n        const avgSpeed = data.windStatistics.averageSpeed || data.windStatistics.mean_speed;\n        if (avgSpeed) {\n          const windInfo = `Average wind speed: ${avgSpeed.toFixed(1)} m/s`;\n          return coordString ? `${coordString} \u2022 ${windInfo}` : windInfo;\n        }\n      }\n      return coordString || 'Wind direction and speed distribution';\n      \n    case 'wind_farm_report':\n    case 'report_generation':\n      return coordString || 'Executive summary and recommendations';\n      \n    case 'project_dashboard':\n      return 'All renewable energy projects';\n      \n    default:\n      return coordString || 'Analysis complete';\n  }\n}\n\n/**\n * Format tool results as EDI artifacts with validation and action buttons\n */\nfunction formatArtifacts(results: ToolResult[], intentType?: string, projectName?: string, projectStatus?: any): Artifact[] {\n  const artifacts: Artifact[] = [];\n  \n  for (const result of results) {\n    if (!result.success) {\n      continue;\n    }\n    \n    let artifact: Artifact | null = null;\n    \n    // Generate action buttons for this artifact based on its type\n    // Use result.type (artifact type) instead of intentType for more accurate button generation\n    const artifactType = result.type;\n    const actions = projectName && artifactType\n      ? generateActionButtons(artifactType, projectName, projectStatus)\n      : undefined;\n    \n    // Log action button generation\n    if (actions && actions.length > 0) {\n      console.log(`\uD83D\uDD18 Generated ${actions.length} action button(s) for ${artifactType}:`, \n        actions.map(a => a.label).join(', '));\n    } else {\n      console.log(`\u26A0\uFE0F  No action buttons generated for ${artifactType} (projectName: ${projectName}, artifactType: ${artifactType})`);\n    }\n    \n    switch (result.type) {\n      case 'terrain_analysis':\n        console.log('\uD83D\uDD0D TERRAIN DEBUG - result.data keys:', Object.keys(result.data));\n        console.log('\uD83D\uDD0D TERRAIN DEBUG - has geojson:', !!result.data.geojson);\n        console.log('\uD83D\uDD0D TERRAIN DEBUG - has mapHtml:', !!result.data.mapHtml);\n        console.log('\uD83D\uDD0D TERRAIN DEBUG - geojson type:', typeof result.data.geojson);\n        if (result.data.geojson) {\n          console.log('\uD83D\uDD0D TERRAIN DEBUG - geojson features:', result.data.geojson.features?.length);\n        }\n        \n        artifact = {\n          type: 'wind_farm_terrain_analysis',\n          data: {\n            messageContentType: 'wind_farm_terrain_analysis',\n            title: result.data.title || getDefaultTitle('terrain_analysis', result.data.projectId),\n            subtitle: result.data.subtitle || getDefaultSubtitle('terrain_analysis', result.data),\n            coordinates: result.data.coordinates,\n            projectId: result.data.projectId,\n            exclusionZones: result.data.exclusionZones,\n            metrics: result.data.metrics,\n            geojson: result.data.geojson,\n            // CRITICAL FIX: Don't include mapHtml/mapUrl - let frontend build map with Leaflet\n            // mapHtml: result.data.mapHtml,\n            // mapUrl: result.data.mapUrl,\n            visualizations: result.data.visualizations,\n            message: result.data.message\n          },\n          actions\n        };\n        \n        console.log('\uD83D\uDD0D TERRAIN DEBUG - artifact.data has geojson:', !!artifact.data.geojson);\n        break;\n        \n      case 'layout_optimization':\n        artifact = {\n          type: 'wind_farm_layout',\n          data: {\n            messageContentType: 'wind_farm_layout',\n            title: result.data.title || getDefaultTitle('layout_optimization', result.data.projectId),\n            subtitle: result.data.subtitle || getDefaultSubtitle('layout_optimization', result.data),\n            projectId: result.data.projectId,\n            layoutType: result.data.layoutType,\n            turbineCount: result.data.turbineCount,\n            totalCapacity: result.data.totalCapacity,\n            turbinePositions: result.data.turbinePositions,\n            geojson: result.data.geojson,\n            mapHtml: result.data.mapHtml,\n            mapUrl: result.data.mapUrl,\n            spacing: result.data.spacing,\n            visualizations: result.data.visualizations,\n            message: result.data.message,\n            metadata: result.data.metadata\n          },\n          actions\n        };\n        break;\n        \n      case 'wind_rose':\n      case 'wind_rose_analysis':\n        // Debug logging for wind rose data flow\n        console.log('\uD83C\uDF39 Orchestrator wind_rose_analysis mapping:', {\n          hasPlotlyWindRose: !!result.data.plotlyWindRose,\n          hasVisualizations: !!result.data.visualizations,\n          hasWindRoseUrl: !!result.data.windRoseUrl,\n          plotlyDataKeys: result.data.plotlyWindRose ? Object.keys(result.data.plotlyWindRose) : []\n        });\n        \n        artifact = {\n          type: 'wind_rose_analysis',\n          data: {\n            messageContentType: 'wind_rose_analysis',\n            title: result.data.title || getDefaultTitle('wind_rose_analysis', result.data.projectId),\n            subtitle: result.data.subtitle || getDefaultSubtitle('wind_rose_analysis', result.data),\n            projectId: result.data.projectId,\n            coordinates: result.data.coordinates || result.data.location,\n            location: result.data.location,\n            windRoseData: result.data.windRoseData,\n            windStatistics: result.data.windStatistics,\n            plotlyWindRose: result.data.plotlyWindRose,  // Pass through Plotly interactive data\n            visualizationUrl: result.data.visualizations?.wind_rose || result.data.windRoseUrl || result.data.mapUrl,  // PNG fallback\n            s3_data: result.data.s3_data,\n            message: result.data.message\n          },\n          actions\n        };\n        break;\n        \n      case 'wake_simulation':\n      case 'wake_analysis':\n        console.log('\uD83C\uDF0A Orchestrator wake_simulation mapping:', {\n          hasPerformanceMetrics: !!result.data.performanceMetrics,\n          hasVisualizations: !!result.data.visualizations,\n          hasMonthlyProduction: !!result.data.monthlyProduction\n        });\n        \n        artifact = {\n          type: 'wake_simulation',\n          data: {\n            messageContentType: 'wake_simulation',\n            title: result.data.title || getDefaultTitle('wake_simulation', result.data.projectId),\n            subtitle: result.data.subtitle || getDefaultSubtitle('wake_simulation', result.data),\n            projectId: result.data.projectId,\n            performanceMetrics: result.data.performanceMetrics,\n            turbineMetrics: result.data.turbineMetrics,\n            monthlyProduction: result.data.monthlyProduction,\n            visualizations: result.data.visualizations,\n            windResourceData: result.data.windResourceData,\n            chartImages: result.data.chartImages,\n            message: result.data.message\n          },\n          actions\n        };\n        break;\n        \n      case 'report_generation':\n        console.log('\uD83D\uDCC4 Orchestrator report_generation mapping:', {\n          hasExecutiveSummary: !!result.data.executiveSummary,\n          hasRecommendations: !!result.data.recommendations,\n          hasReportHtml: !!result.data.reportHtml\n        });\n        \n        artifact = {\n          type: 'wind_farm_report',\n          data: {\n            messageContentType: 'wind_farm_report',\n            title: result.data.title || getDefaultTitle('report_generation', result.data.projectId),\n            subtitle: result.data.subtitle || getDefaultSubtitle('report_generation', result.data),\n            projectId: result.data.projectId,\n            executiveSummary: result.data.executiveSummary,\n            recommendations: result.data.recommendations,\n            reportHtml: result.data.reportHtml,\n            reportUrl: result.data.reportUrl,\n            visualizations: result.data.visualizations,\n            message: result.data.message\n          },\n          actions\n        };\n        break;\n    }\n    \n    // Validate artifact before adding\n    if (artifact) {\n      try {\n        // Test JSON serializability\n        const serialized = JSON.stringify(artifact);\n        JSON.parse(serialized);\n        \n        // Artifact is valid, add it\n        artifacts.push(artifact);\n        \n        console.log('\u2705 Artifact validated and added:', {\n          type: artifact.type,\n          hasData: !!artifact.data,\n          dataKeys: artifact.data ? Object.keys(artifact.data) : [],\n        });\n      } catch (error: any) {\n        console.error('\u274C Artifact failed JSON serialization:', {\n          type: artifact.type,\n          error: error.message,\n          timestamp: new Date().toISOString(),\n        });\n        \n        // Try to sanitize the artifact\n        try {\n          const sanitized = JSON.parse(JSON.stringify(artifact, (key, value) => {\n            // Remove functions and undefined values\n            if (typeof value === 'function' || value === undefined) {\n              return null;\n            }\n            return value;\n          }));\n          \n          artifacts.push(sanitized);\n          console.log('\u26A0\uFE0F Artifact sanitized and added:', {\n            type: sanitized.type,\n          });\n        } catch (sanitizeError: any) {\n          console.error('\u274C Failed to sanitize artifact:', {\n            type: artifact.type,\n            error: sanitizeError.message,\n          });\n        }\n      }\n    }\n  }\n  \n  return artifacts;\n}\n\n/**\n * Generate response message with project status\n */\nfunction generateResponseMessage(intent: RenewableIntent, results: ToolResult[], projectName?: string, projectData?: any): string {\n  const successfulResults = results.filter(r => r.success);\n  \n  if (successfulResults.length === 0) {\n    // Check if it's a deployment issue\n    const deploymentIssue = results.find(r => r.data?.deploymentRequired);\n    if (deploymentIssue) {\n      return deploymentIssue.data.message || 'Renewable energy tools are not yet deployed.';\n    }\n    \n    return 'Tool execution failed. Please check the parameters and try again.';\n  }\n  \n  const result = successfulResults[0];\n  let baseMessage = '';\n  \n  switch (intent.type) {\n    case 'terrain_analysis':\n      baseMessage = result.data.message || 'Terrain analysis completed successfully.';\n      break;\n      \n    case 'layout_optimization':\n      baseMessage = result.data.message || `Layout optimization completed with ${result.data.turbineCount} turbines.`;\n      break;\n      \n    case 'wake_simulation':\n      baseMessage = result.data.message || 'Wake simulation completed successfully.';\n      break;\n      \n    case 'wind_rose':\n    case 'wind_rose_analysis':\n      baseMessage = result.data.message || 'Wind rose analysis completed successfully.';\n      break;\n      \n    case 'report_generation':\n      baseMessage = result.data.message || 'Report generated successfully.';\n      break;\n      \n    default:\n      baseMessage = 'Analysis completed successfully.';\n  }\n  \n  // Add project status if project name is provided\n  if (projectName && projectData) {\n    const projectStatus = {\n      terrain: !!projectData.terrain_results,\n      layout: !!projectData.layout_results,\n      simulation: !!projectData.simulation_results,\n      report: !!projectData.report_results\n    };\n    \n    const statusChecklist = formatProjectStatusChecklist(projectStatus);\n    const nextStep = generateNextStepSuggestion(projectStatus);\n    \n    baseMessage += `\\n\\n**Project: ${projectName}**\\n\\n${statusChecklist}`;\n    \n    if (nextStep) {\n      baseMessage += `\\n\\n**Next:** ${nextStep}`;\n    }\n  }\n  \n  return baseMessage;\n}\n\n/**\n * Get project completion status\n */\nfunction getProjectStatus(projectData: any, currentStep: string): { summary: string; nextStep: string } {\n  const steps = {\n    terrain: !!projectData.terrain_results,\n    layout: !!projectData.layout_results,\n    simulation: !!projectData.simulation_results,\n    report: !!projectData.report_results\n  };\n  \n  const statusIcons = {\n    terrain: steps.terrain ? '\u2713' : '\u25CB',\n    layout: steps.layout ? '\u2713' : '\u25CB',\n    simulation: steps.simulation ? '\u2713' : '\u25CB',\n    report: steps.report ? '\u2713' : '\u25CB'\n  };\n  \n  const summary = `Status:\\n${statusIcons.terrain} Terrain Analysis\\n${statusIcons.layout} Layout Optimization\\n${statusIcons.simulation} Wake Simulation\\n${statusIcons.report} Report Generation`;\n  \n  // Determine next step\n  let nextStep = '';\n  if (!steps.terrain) {\n    nextStep = 'Next: Run terrain analysis with coordinates';\n  } else if (!steps.layout) {\n    nextStep = 'Next: Optimize turbine layout';\n  } else if (!steps.simulation) {\n    nextStep = 'Next: Run wake simulation';\n  } else if (!steps.report) {\n    nextStep = 'Next: Generate comprehensive report';\n  } else {\n    nextStep = 'All steps complete! You can start a new project or refine this one.';\n  }\n  \n  return { summary, nextStep };\n}\n\n\n/**\n * Handle project lifecycle management intents\n */\nasync function handleLifecycleIntent(\n  intent: RenewableIntent,\n  query: string,\n  lifecycleManager: any,\n  sessionContextManager: any,\n  sessionId: string\n): Promise<{\n  success: boolean;\n  message: string;\n  artifacts?: any[];\n  metadata?: Record<string, any>;\n}> {\n  console.log('\uD83D\uDD04 Handling lifecycle intent:', intent.type);\n  console.log('   Query:', query);\n  console.log('   Params:', intent.params);\n  \n  try {\n    switch (intent.type) {\n      case 'delete_project': {\n        // Extract project name from query or params\n        const projectName = intent.params.project_name || extractProjectNameFromQuery(query);\n        \n        if (!projectName) {\n          return {\n            success: false,\n            message: 'Please specify which project to delete. Example: \"delete project texas-wind-farm\"'\n          };\n        }\n        \n        // Check if this is a bulk delete from dashboard (contains project list)\n        if (/bulk delete projects:/i.test(query)) {\n          // Extract project names from the query\n          const match = query.match(/bulk delete projects:\\s*(.+)/i);\n          if (match) {\n            const projectList = match[1];\n            // Parse quoted project names\n            const projectNames = projectList.match(/\"([^\"]+)\"/g)?.map(name => name.replace(/\"/g, '')) || [];\n            \n            if (projectNames.length > 0) {\n              // Delete each project silently with confirmation skipped\n              const results = await Promise.all(\n                projectNames.map(name => lifecycleManager.deleteProject(name, true, sessionId))\n              );\n              \n              const successCount = results.filter(r => r.success).length;\n              const failedProjects = results.filter(r => !r.success).map((r, i) => ({\n                name: projectNames[i],\n                error: r.error || 'Unknown error'\n              }));\n              \n              return {\n                success: successCount > 0,\n                message: `Successfully deleted ${successCount} of ${projectNames.length} projects.`,\n                metadata: {\n                  deletedCount: successCount,\n                  deletedProjects: results.filter(r => r.success).map(r => r.projectName),\n                  failedProjects\n                }\n              };\n            }\n          }\n        }\n        \n        // Check if this is a bulk delete (contains \"all\" or \"matching\")\n        if (/delete.*all.*projects/i.test(query) || /delete.*projects.*matching/i.test(query)) {\n          const pattern = extractPatternFromQuery(query);\n          const result = await lifecycleManager.bulkDelete(pattern, false);\n          \n          return {\n            success: result.success,\n            message: result.message,\n            metadata: {\n              deletedCount: result.deletedCount,\n              deletedProjects: result.deletedProjects,\n              failedProjects: result.failedProjects\n            }\n          };\n        }\n        \n        // Single project delete\n        // Check if confirmation is skipped (from dashboard or explicit confirmation)\n        const skipConfirmation = /confirmed/i.test(query) || /dashboard-action/i.test(query);\n        const result = await lifecycleManager.deleteProject(projectName, skipConfirmation, sessionId);\n        \n        return {\n          success: result.success,\n          message: result.message,\n          metadata: {\n            projectName: result.projectName\n          }\n        };\n      }\n      \n      case 'rename_project': {\n        // Extract old and new names from query\n        const { oldName, newName } = extractRenameParams(query);\n        \n        if (!oldName || !newName) {\n          return {\n            success: false,\n            message: 'Please specify both old and new project names. Example: \"rename project old-name to new-name\"'\n          };\n        }\n        \n        const result = await lifecycleManager.renameProject(oldName, newName);\n        \n        return {\n          success: result.success,\n          message: result.message,\n          metadata: {\n            oldName: result.oldName,\n            newName: result.newName\n          }\n        };\n      }\n      \n      case 'merge_projects': {\n        // Extract project names from query\n        const { project1, project2, keepName } = extractMergeParams(query);\n        \n        if (!project1 || !project2) {\n          return {\n            success: false,\n            message: 'Please specify two projects to merge. Example: \"merge projects project1 and project2\"'\n          };\n        }\n        \n        const result = await lifecycleManager.mergeProjects(project1, project2, keepName);\n        \n        return {\n          success: result.success,\n          message: result.message,\n          metadata: {\n            mergedProject: result.mergedProject\n          }\n        };\n      }\n      \n      case 'archive_project': {\n        // Check if this is archive or unarchive\n        const isUnarchive = /unarchive/i.test(query);\n        const projectName = intent.params.project_name || extractProjectNameFromQuery(query);\n        \n        if (!projectName) {\n          // Check if this is a list archived projects query\n          if (/list.*archived/i.test(query) || /show.*archived/i.test(query)) {\n            const result = await lifecycleManager.listArchivedProjects();\n            \n            return {\n              success: true,\n              message: result.length > 0 \n                ? `Found ${result.length} archived project(s):\\n${result.map((p: any) => `- ${p.project_name}`).join('\\n')}`\n                : 'No archived projects found.',\n              metadata: {\n                archivedProjects: result\n              }\n            };\n          }\n          \n          return {\n            success: false,\n            message: `Please specify which project to ${isUnarchive ? 'unarchive' : 'archive'}. Example: \"${isUnarchive ? 'unarchive' : 'archive'} project texas-wind-farm\"`\n          };\n        }\n        \n        if (isUnarchive) {\n          const result = await lifecycleManager.unarchiveProject(projectName);\n          return {\n            success: result.success,\n            message: result.message,\n            metadata: { projectName }\n          };\n        } else {\n          const result = await lifecycleManager.archiveProject(projectName);\n          return {\n            success: result.success,\n            message: result.message,\n            metadata: { projectName }\n          };\n        }\n      }\n      \n      case 'export_project': {\n        // Check if this is export or import\n        const isImport = /import/i.test(query);\n        \n        if (isImport) {\n          return {\n            success: false,\n            message: 'Project import is not yet implemented. Please use the export feature to save project data.'\n          };\n        }\n        \n        const projectName = intent.params.project_name || extractProjectNameFromQuery(query);\n        \n        if (!projectName) {\n          return {\n            success: false,\n            message: 'Please specify which project to export. Example: \"export project texas-wind-farm\"'\n          };\n        }\n        \n        const result = await lifecycleManager.exportProject(projectName);\n        \n        return {\n          success: result.success,\n          message: result.message,\n          metadata: {\n            projectName,\n            exportData: result.exportData\n          }\n        };\n      }\n      \n      case 'search_projects': {\n        // Check if this is a find duplicates query\n        if (/show.*duplicates/i.test(query) || /find.*duplicates/i.test(query)) {\n          const result = await lifecycleManager.findDuplicates();\n          \n          return {\n            success: true,\n            message: result.length > 0\n              ? `Found ${result.length} group(s) of duplicate projects:\\n${result.map((g: any) => `- ${g.projects.map((p: any) => p.project_name).join(', ')} (${g.count} projects)`).join('\\n')}`\n              : 'No duplicate projects found.',\n            metadata: {\n              duplicateGroups: result\n            }\n          };\n        }\n        \n        // Build search criteria from query\n        const criteria: any = {};\n        \n        // Extract location filter\n        const locationMatch = query.match(/projects.*in\\s+([a-zA-Z\\s]+)/i);\n        if (locationMatch) {\n          criteria.location = locationMatch[1].trim();\n        }\n        \n        // Extract date filter\n        if (/created.*today/i.test(query)) {\n          criteria.dateFrom = new Date().toISOString().split('T')[0];\n        } else if (/created.*this.*week/i.test(query)) {\n          const weekAgo = new Date();\n          weekAgo.setDate(weekAgo.getDate() - 7);\n          criteria.dateFrom = weekAgo.toISOString().split('T')[0];\n        }\n        \n        // Extract incomplete filter\n        if (/incomplete/i.test(query)) {\n          criteria.incomplete = true;\n        }\n        \n        // Extract archived filter\n        if (/archived/i.test(query)) {\n          criteria.archived = true;\n        }\n        \n        // Extract coordinate proximity filter\n        const coordMatch = query.match(/projects.*at\\s+(-?\\d+\\.\\d+),?\\s*(-?\\d+\\.\\d+)/i);\n        if (coordMatch) {\n          criteria.coordinates = {\n            latitude: parseFloat(coordMatch[1]),\n            longitude: parseFloat(coordMatch[2])\n          };\n          criteria.radiusKm = 5; // Default 5km radius\n        }\n        \n        const result = await lifecycleManager.searchProjects(criteria);\n        \n        return {\n          success: true,\n          message: result.length > 0\n            ? `Found ${result.length} project(s):\\n${result.map((p: any) => `- ${p.project_name}`).join('\\n')}`\n            : 'No projects found matching your criteria.',\n          metadata: {\n            searchCriteria: criteria,\n            projects: result\n          }\n        };\n      }\n      \n      case 'project_dashboard': {\n        console.log('\uD83D\uDCCA Generating project dashboard');\n        \n        // Get session context\n        const sessionContext = await sessionContextManager.getContext(sessionId);\n        \n        // Generate dashboard data\n        const dashboardData = await lifecycleManager.generateDashboard(sessionContext);\n        \n        // Create artifact\n        const artifact = {\n          type: 'project_dashboard',\n          messageContentType: 'project_dashboard',\n          data: dashboardData,\n          metadata: {\n            generated_at: new Date().toISOString(),\n            total_projects: dashboardData.totalProjects,\n            active_project: dashboardData.activeProject,\n            duplicate_count: dashboardData.duplicateGroups.length\n          }\n        };\n        \n        return {\n          success: true,\n          message: `Project Dashboard\\n\\nTotal Projects: ${dashboardData.totalProjects}\\nActive Project: ${dashboardData.activeProject || 'None'}\\nDuplicate Groups: ${dashboardData.duplicateGroups.length}`,\n          artifacts: [artifact],\n          metadata: {\n            dashboard: dashboardData\n          }\n        };\n      }\n      \n      default:\n        return {\n          success: false,\n          message: `Unknown lifecycle intent: ${intent.type}`\n        };\n    }\n  } catch (error) {\n    console.error('\u274C Error in handleLifecycleIntent:', error);\n    throw error;\n  }\n}\n\n/**\n * Extract project name from query\n */\nfunction extractProjectNameFromQuery(query: string): string | null {\n  // Try various patterns to extract project name\n  const patterns = [\n    /project\\s+([a-zA-Z0-9_-]+)/i,\n    /delete\\s+([a-zA-Z0-9_-]+)/i,\n    /archive\\s+([a-zA-Z0-9_-]+)/i,\n    /export\\s+([a-zA-Z0-9_-]+)/i,\n    /unarchive\\s+([a-zA-Z0-9_-]+)/i\n  ];\n  \n  for (const pattern of patterns) {\n    const match = query.match(pattern);\n    if (match) {\n      return match[1];\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Extract pattern from bulk delete query\n */\nfunction extractPatternFromQuery(query: string): string {\n  const match = query.match(/matching\\s+([a-zA-Z0-9_-]+)/i);\n  if (match) {\n    return match[1];\n  }\n  \n  // Default to wildcard\n  return '*';\n}\n\n/**\n * Extract rename parameters from query\n */\nfunction extractRenameParams(query: string): { oldName: string | null; newName: string | null } {\n  const match = query.match(/rename\\s+(?:project\\s+)?([a-zA-Z0-9_-]+)\\s+to\\s+([a-zA-Z0-9_-]+)/i);\n  \n  if (match) {\n    return {\n      oldName: match[1],\n      newName: match[2]\n    };\n  }\n  \n  return { oldName: null, newName: null };\n}\n\n/**\n * Extract merge parameters from query\n */\nfunction extractMergeParams(query: string): { project1: string | null; project2: string | null; keepName: string | null } {\n  const match = query.match(/merge\\s+(?:projects?\\s+)?([a-zA-Z0-9_-]+)\\s+(?:and|with)\\s+([a-zA-Z0-9_-]+)/i);\n  \n  if (match) {\n    const project1 = match[1];\n    const project2 = match[2];\n    \n    // Check if user specified which name to keep\n    const keepMatch = query.match(/keep\\s+(?:name\\s+)?([a-zA-Z0-9_-]+)/i);\n    const keepName = keepMatch ? keepMatch[1] : project1; // Default to first project name\n    \n    return { project1, project2, keepName };\n  }\n  \n  return { project1: null, project2: null, keepName: null };\n}\n\n/**\n * Write results to ChatMessage table for async invocations\n * This allows results to appear in the chat even when invoked with InvocationType='Event'\n */\nasync function writeResultsToChatMessage(\n  sessionId: string,\n  userId: string,\n  response: OrchestratorResponse\n): Promise<void> {\n  const startTime = Date.now();\n  \n  try {\n    console.log('\uD83D\uDCDD Writing results to DynamoDB ChatMessage table...');\n    console.log(`   Session ID: ${sessionId}`);\n    console.log(`   User ID: ${userId}`);\n    console.log(`   Artifacts: ${response.artifacts?.length || 0}`);\n    console.log(`   Thought Steps: ${response.thoughtSteps?.length || 0}`);\n    \n    // Use DynamoDB SDK with proper serialization for AWSJSON types\n    const { DynamoDBClient } = require('@aws-sdk/client-dynamodb');\n    const { DynamoDBDocumentClient, PutCommand } = require('@aws-sdk/lib-dynamodb');\n    \n    const dynamoClient = new DynamoDBClient({});\n    const docClient = DynamoDBDocumentClient.from(dynamoClient, {\n      marshallOptions: {\n        removeUndefinedValues: true,\n        convertEmptyValues: false,\n        convertClassInstanceToMap: false\n      }\n    });\n    \n    const tableName = process.env.AMPLIFY_DATA_CHATMESSAGE_TABLE_NAME || 'ChatMessage';\n    console.log(`   Table Name: ${tableName}`);\n    \n    // Validate required fields\n    if (!sessionId || !userId) {\n      throw new Error('Missing required fields: sessionId and userId are required');\n    }\n    \n    if (!response.message) {\n      console.warn('\u26A0\uFE0F  Response message is empty, using default message');\n    }\n    \n    // CRITICAL: Serialize artifacts and thoughtSteps as JSON strings\n    // Amplify's AWSJSON type expects strings, not objects\n    const serializedArtifacts = response.artifacts?.map(artifact => \n      typeof artifact === 'string' ? artifact : JSON.stringify(artifact)\n    ) || [];\n    \n    const serializedThoughtSteps = response.thoughtSteps?.map(step => \n      typeof step === 'string' ? step : JSON.stringify(step)\n    ) || [];\n    \n    console.log(`   Serialized ${serializedArtifacts.length} artifacts and ${serializedThoughtSteps.length} thought steps`);\n    \n    const chatMessage = {\n      id: `msg-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n      chatSessionId: sessionId,\n      owner: userId,\n      role: 'ai',\n      content: {\n        text: response.message || 'Analysis complete'\n      },\n      responseComplete: true,\n      artifacts: serializedArtifacts,\n      thoughtSteps: serializedThoughtSteps,\n      createdAt: new Date().toISOString(),\n      updatedAt: new Date().toISOString()\n    };\n    \n    console.log(`   Message ID: ${chatMessage.id}`);\n    \n    await docClient.send(new PutCommand({\n      TableName: tableName,\n      Item: chatMessage\n    }));\n    \n    const duration = Date.now() - startTime;\n    console.log('\u2705 Results written to ChatMessage table', {\n      messageId: chatMessage.id,\n      chatSessionId: sessionId,\n      artifactCount: serializedArtifacts.length,\n      thoughtStepCount: serializedThoughtSteps.length,\n      duration: `${duration}ms`\n    });\n    \n  } catch (error) {\n    const duration = Date.now() - startTime;\n    console.error('\u274C Failed to write results to ChatMessage:', error);\n    console.error('   Error details:', {\n      name: error instanceof Error ? error.name : 'Unknown',\n      message: error instanceof Error ? error.message : 'Unknown error',\n      duration: `${duration}ms`\n    });\n    \n    // Log specific error types for debugging\n    if (error instanceof Error) {\n      if (error.message.includes('ResourceNotFoundException')) {\n        console.error('   \u26A0\uFE0F  Table not found - ensure ChatMessage table exists');\n      } else if (error.message.includes('AccessDenied')) {\n        console.error('   \u26A0\uFE0F  Permission denied - check IAM permissions for DynamoDB');\n      } else if (error.message.includes('ValidationException')) {\n        console.error('   \u26A0\uFE0F  Invalid data format - check message structure');\n      }\n    }\n    \n    // Don't throw - this is a best-effort operation\n    // The orchestrator should still return successfully even if DynamoDB write fails\n  }\n}\n", "/**\n * Renewable Intent Classifier\n * \n * Implements proper pattern matching for renewable analysis types to prevent\n * all queries routing to terrain analysis. Includes confidence scoring and\n * fallback suggestions for ambiguous queries.\n * \n * Requirements: 13.1, 13.2, 13.3, 13.4, 13.5\n */\n\nexport interface RenewableAnalysisType {\n  TERRAIN_ANALYSIS: 'terrain_analysis';\n  WIND_ROSE_ANALYSIS: 'wind_rose_analysis';\n  WAKE_ANALYSIS: 'wake_analysis';\n  LAYOUT_OPTIMIZATION: 'layout_optimization';\n  SITE_SUITABILITY: 'site_suitability';\n  COMPREHENSIVE_ASSESSMENT: 'comprehensive_assessment';\n  REPORT_GENERATION: 'report_generation';\n  // Project lifecycle management intents\n  DELETE_PROJECT: 'delete_project';\n  RENAME_PROJECT: 'rename_project';\n  MERGE_PROJECTS: 'merge_projects';\n  ARCHIVE_PROJECT: 'archive_project';\n  EXPORT_PROJECT: 'export_project';\n  SEARCH_PROJECTS: 'search_projects';\n  PROJECT_DASHBOARD: 'project_dashboard';\n}\n\nexport const RenewableAnalysisType: RenewableAnalysisType = {\n  TERRAIN_ANALYSIS: 'terrain_analysis',\n  WIND_ROSE_ANALYSIS: 'wind_rose_analysis',\n  WAKE_ANALYSIS: 'wake_analysis',\n  LAYOUT_OPTIMIZATION: 'layout_optimization',\n  SITE_SUITABILITY: 'site_suitability',\n  COMPREHENSIVE_ASSESSMENT: 'comprehensive_assessment',\n  REPORT_GENERATION: 'report_generation',\n  // Project lifecycle management intents\n  DELETE_PROJECT: 'delete_project',\n  RENAME_PROJECT: 'rename_project',\n  MERGE_PROJECTS: 'merge_projects',\n  ARCHIVE_PROJECT: 'archive_project',\n  EXPORT_PROJECT: 'export_project',\n  SEARCH_PROJECTS: 'search_projects',\n  PROJECT_DASHBOARD: 'project_dashboard'\n};\n\nexport interface IntentClassificationResult {\n  intent: string;\n  confidence: number;\n  alternatives: Array<{\n    intent: string;\n    confidence: number;\n  }>;\n  params: Record<string, any>;\n  requiresConfirmation: boolean;\n}\n\nexport interface PatternDefinition {\n  patterns: RegExp[];\n  exclusions: RegExp[];\n  weight: number;\n  keywords: string[];\n}\n\nexport class RenewableIntentClassifier {\n  private readonly intentPatterns: Record<string, PatternDefinition> = {\n    // CRITICAL: Financial analysis patterns MUST come BEFORE terrain patterns\n    // to prevent \"financial analysis\" queries from being misclassified as terrain_analysis\n    report_generation: {\n      patterns: [\n        /financial\\s+analysis/i,\n        /roi\\s+calculation/i,\n        /return\\s+on\\s+investment/i,\n        /economic\\s+analysis/i,\n        /cost\\s+benefit/i,\n        /project\\s+economics/i,\n        /financial\\s+report/i,\n        /generate.*report/i,\n        /create.*report/i,\n        /report.*generation/i,\n        /executive.*summary/i,\n        /project.*report/i,\n        /summary.*report/i,\n        /final.*report/i,\n        /analysis.*report/i,\n        /report.*for/i,\n        /lcoe/i,\n        /levelized.*cost/i,\n        /financial.*metrics/i,\n        /investment.*analysis/i,\n        /payback.*period/i,\n        /net.*present.*value/i,\n        /npv/i,\n        /irr/i,\n        /internal.*rate.*return/i\n      ],\n      exclusions: [\n        /terrain(?!.*financial)/i,  // Allow \"terrain\" only if not followed by \"financial\"\n        /wind.*rose(?!.*financial)/i,\n        /wake(?!.*financial)/i,\n        /layout(?!.*financial)/i\n      ],\n      weight: 1.6,  // High weight to prioritize financial analysis\n      keywords: ['financial', 'roi', 'economic', 'cost', 'report', 'lcoe', 'investment', 'payback', 'npv', 'irr', 'analysis', 'summary', 'executive']\n    },\n\n    terrain_analysis: {\n      patterns: [\n        /terrain.*analysis/i,\n        /analyz.*terrain/i,  // CRITICAL: Match \"analyze terrain\" word order\n        /site.*terrain/i,\n        /topography/i,\n        /elevation.*profile/i,\n        /osm.*features/i,\n        /buildings.*roads.*water/i,\n        /terrain.*assessment/i,\n        /geographic.*analysis/i,\n        /land.*use.*analysis/i,\n        /terrain.*constraints/i,\n        /site.*constraints/i,\n        /environmental.*constraints/i\n      ],\n      exclusions: [\n        /financial/i,  // CRITICAL: Exclude financial keywords\n        /roi/i,\n        /economic/i,\n        /cost.*benefit/i,\n        /investment/i,\n        /lcoe/i,\n        /payback/i,\n        /wind.*rose/i,\n        /wind.*direction/i,\n        /wind.*pattern/i,\n        /wake.*effect/i,\n        /wake.*analysis/i,\n        /layout.*optimization/i,\n        /turbine.*placement/i,\n        /site.*suitability.*score/i,\n        /overall.*assessment/i,\n        /report/i,\n        /generate.*report/i\n      ],\n      weight: 0.9,\n      keywords: ['terrain', 'topography', 'elevation', 'osm', 'buildings', 'roads', 'water', 'constraints']\n    },\n\n    wind_rose_analysis: {\n      patterns: [\n        /wind.*rose/i,\n        /wind.*direction/i,\n        /wind.*speed.*distribution/i,\n        /prevailing.*wind/i,\n        /seasonal.*wind/i,\n        /wind.*pattern/i,\n        /wind.*resource.*analysis/i,\n        /directional.*wind/i,\n        /wind.*frequency/i,\n        /wind.*statistics/i,\n        /show.*wind/i,\n        /wind.*analysis/i\n      ],\n      exclusions: [\n        /terrain/i,\n        /wake.*effect/i,\n        /layout/i,\n        /site.*suitability/i,\n        /turbine.*placement/i,\n        /osm/i,\n        /buildings/i,\n        /roads/i\n      ],\n      weight: 1.5,\n      keywords: ['wind rose', 'wind direction', 'wind speed', 'prevailing', 'seasonal', 'wind pattern', 'wind analysis']\n    },\n\n    wake_analysis: {\n      patterns: [\n        /wake.*effect/i,\n        /turbine.*interaction/i,\n        /wake.*modeling/i,\n        /downstream.*impact/i,\n        /wake.*loss/i,\n        /wake.*deficit/i,\n        /turbine.*wake/i,\n        /wake.*simulation/i,\n        /aerodynamic.*interaction/i,\n        /wake.*interference/i,\n        /analyze.*wake/i,\n        /wake.*analysis.*for.*project/i,\n        /wake.*study/i\n      ],\n      exclusions: [\n        /terrain.*analysis/i,\n        /wind.*rose/i,\n        /layout.*optimization/i,\n        /site.*suitability/i,\n        /overall.*assessment/i,\n        /create.*layout/i,\n        /generate.*layout/i,\n        /design.*layout/i,\n        /new.*layout/i,\n        /build.*layout/i,\n        /make.*layout/i,\n        /create.*wind.*farm/i,\n        /generate.*wind.*farm/i,\n        /design.*wind.*farm/i\n      ],\n      weight: 1.3,\n      keywords: ['wake', 'turbine interaction', 'downstream', 'wake loss', 'wake modeling', 'wake analysis']\n    },\n\n    layout_optimization: {\n      patterns: [\n        /layout.*optimization/i,\n        /turbine.*placement/i,\n        /spacing.*optimization/i,\n        /array.*design/i,\n        /optimal.*layout/i,\n        /turbine.*positioning/i,\n        /farm.*layout/i,\n        /placement.*optimization/i,\n        /turbine.*spacing/i,\n        /layout.*design/i,\n        /create.*layout/i,\n        /generate.*layout/i,\n        /design.*layout/i,\n        /new.*layout/i,\n        /build.*layout/i,\n        /make.*layout/i,\n        /create.*wind.*farm.*layout/i,\n        /generate.*wind.*farm.*layout/i,\n        /design.*wind.*farm/i,\n        /create.*turbine.*layout/i,\n        /plan.*turbine.*placement/i,\n        /design.*turbine.*array/i,\n        /optimize.*wind.*farm/i,  // CRITICAL: Match \"optimize wind farm\"\n        /optimize.*layout/i,\n        /optimize.*turbine/i,\n        /wind.*farm.*optimization/i\n      ],\n      exclusions: [\n        /terrain.*analysis/i,\n        /wind.*rose/i,\n        /wake.*effect.*only/i,\n        /wake.*analysis.*only/i,\n        /analyze.*wake/i,\n        /site.*suitability.*score/i,\n        /overall.*assessment/i\n      ],\n      weight: 1.4,\n      keywords: ['layout', 'placement', 'spacing', 'optimization', 'positioning', 'array design', 'create', 'generate', 'design', 'build']\n    },\n\n    site_suitability: {\n      patterns: [\n        /site.*suitability/i,\n        /feasibility.*analysis/i,\n        /site.*assessment/i,\n        /development.*potential/i,\n        /overall.*scoring/i,\n        /suitability.*score/i,\n        /site.*evaluation/i,\n        /comprehensive.*assessment/i,\n        /site.*ranking/i,\n        /viability.*analysis/i\n      ],\n      exclusions: [\n        /terrain.*analysis.*only/i,\n        /wind.*rose.*only/i,\n        /wake.*analysis.*only/i,\n        /layout.*optimization.*only/i\n      ],\n      weight: 1.0,\n      keywords: ['suitability', 'feasibility', 'assessment', 'potential', 'scoring', 'evaluation']\n    },\n\n    comprehensive_assessment: {\n      patterns: [\n        /comprehensive.*analysis/i,\n        /full.*assessment/i,\n        /complete.*evaluation/i,\n        /end.*to.*end/i,\n        /all.*analysis/i,\n        /complete.*workflow/i,\n        /full.*suite/i,\n        /comprehensive.*study/i\n      ],\n      exclusions: [],\n      weight: 0.8,\n      keywords: ['comprehensive', 'complete', 'full', 'all analysis', 'end-to-end']\n    },\n\n    // Project Lifecycle Management Intents\n    delete_project: {\n      patterns: [\n        /delete.*project/i,\n        /remove.*project/i,\n        /get.*rid.*of.*project/i,\n        /trash.*project/i,\n        /delete.*all.*projects/i,\n        /remove.*all.*projects/i,\n        /delete.*projects.*matching/i,\n        /delete.*projects.*except/i,\n        /clean.*up.*projects/i,\n        /purge.*projects/i\n      ],\n      exclusions: [\n        /rename/i,\n        /merge/i,\n        /archive/i,\n        /export/i,\n        /list/i,\n        /show/i,\n        /search/i\n      ],\n      weight: 1.6,\n      keywords: ['delete', 'remove', 'trash', 'get rid of', 'clean up', 'purge']\n    },\n\n    rename_project: {\n      patterns: [\n        /rename.*project/i,\n        /change.*name.*project/i,\n        /call.*it/i,\n        /rename.*to/i,\n        /change.*project.*name/i,\n        /update.*project.*name/i,\n        /project.*name.*to/i\n      ],\n      exclusions: [\n        /delete/i,\n        /remove/i,\n        /merge/i,\n        /archive/i,\n        /export/i\n      ],\n      weight: 1.6,\n      keywords: ['rename', 'change name', 'call it', 'update name']\n    },\n\n    merge_projects: {\n      patterns: [\n        /merge.*projects/i,\n        /combine.*projects/i,\n        /merge.*project.*with/i,\n        /combine.*project.*with/i,\n        /consolidate.*projects/i,\n        /join.*projects/i,\n        /merge.*into/i\n      ],\n      exclusions: [\n        /delete/i,\n        /remove/i,\n        /rename/i,\n        /archive/i,\n        /export/i,\n        /list/i,\n        /show/i\n      ],\n      weight: 1.6,\n      keywords: ['merge', 'combine', 'consolidate', 'join']\n    },\n\n    archive_project: {\n      patterns: [\n        /archive.*project/i,\n        /unarchive.*project/i,\n        /restore.*project/i,\n        /archived.*projects/i,\n        /list.*archived/i,\n        /show.*archived/i,\n        /move.*to.*archive/i\n      ],\n      exclusions: [\n        /delete/i,\n        /remove/i,\n        /rename/i,\n        /merge/i,\n        /export/i\n      ],\n      weight: 1.5,\n      keywords: ['archive', 'unarchive', 'restore', 'archived']\n    },\n\n    export_project: {\n      patterns: [\n        /export.*project/i,\n        /import.*project/i,\n        /download.*project/i,\n        /save.*project/i,\n        /backup.*project/i,\n        /export.*data/i,\n        /import.*from/i\n      ],\n      exclusions: [\n        /delete/i,\n        /remove/i,\n        /rename/i,\n        /merge/i,\n        /archive/i\n      ],\n      weight: 1.5,\n      keywords: ['export', 'import', 'download', 'save', 'backup']\n    },\n\n    search_projects: {\n      patterns: [\n        /search.*projects/i,\n        /find.*projects/i,\n        /filter.*projects/i,\n        /projects.*in/i,\n        /projects.*at/i,\n        /projects.*created/i,\n        /incomplete.*projects/i,\n        /show.*duplicates/i,\n        /find.*duplicates/i,\n        /duplicate.*projects/i,\n        /projects.*near/i,\n        /projects.*within/i\n      ],\n      exclusions: [\n        /delete/i,\n        /remove/i,\n        /rename/i,\n        /merge/i,\n        /archive/i,\n        /export/i\n      ],\n      weight: 1.4,\n      keywords: ['search', 'find', 'filter', 'duplicates', 'incomplete', 'near', 'within']\n    },\n\n    project_dashboard: {\n      patterns: [\n        /show.*project.*dashboard/i,\n        /project.*dashboard/i,\n        /dashboard/i,\n        /show.*all.*projects/i,\n        /list.*all.*projects/i,\n        /project.*overview/i,\n        /project.*summary/i,\n        /show.*projects/i,\n        /view.*projects/i,\n        /my.*projects/i,\n        /all.*projects/i\n      ],\n      exclusions: [\n        /delete/i,\n        /remove/i,\n        /rename/i,\n        /merge/i,\n        /archive/i,\n        /export/i,\n        /search/i,\n        /find/i,\n        /filter/i\n      ],\n      weight: 1.6,\n      keywords: ['dashboard', 'overview', 'summary', 'all', 'show', 'list', 'view']\n    }\n  };\n\n  /**\n   * Classify the intent of a renewable energy query\n   */\n  classifyIntent(query: string): IntentClassificationResult {\n    console.log('\uD83D\uDD0D RenewableIntentClassifier: Analyzing query:', query);\n    \n    const lowerQuery = query.toLowerCase();\n    const scores: Record<string, number> = {};\n    \n    // Calculate scores for each intent type\n    for (const [intentType, definition] of Object.entries(this.intentPatterns)) {\n      scores[intentType] = this.calculateIntentScore(lowerQuery, definition);\n    }\n    \n    console.log('\uD83D\uDD0D Intent scores:', scores);\n    \n    // Sort by confidence score\n    const sortedIntents = Object.entries(scores)\n      .sort(([, a], [, b]) => b - a)\n      .map(([intent, score]) => ({ intent, confidence: Math.round(score * 100) }));\n    \n    const topIntent = sortedIntents[0];\n    const alternatives = sortedIntents.slice(1, 4); // Top 3 alternatives\n    \n    // Determine if confirmation is required\n    const requiresConfirmation = this.shouldRequireConfirmation(topIntent.confidence, alternatives);\n    \n    const result: IntentClassificationResult = {\n      intent: topIntent.intent,\n      confidence: topIntent.confidence,\n      alternatives,\n      params: this.extractParameters(query, topIntent.intent),\n      requiresConfirmation\n    };\n    \n    console.log('\uD83C\uDFAF Classification result:', result);\n    return result;\n  }\n\n  /**\n   * Get confidence score for a specific intent\n   */\n  getConfidenceScore(query: string, intent: string): number {\n    const definition = this.intentPatterns[intent];\n    if (!definition) return 0;\n    \n    return Math.round(this.calculateIntentScore(query.toLowerCase(), definition) * 100);\n  }\n\n  /**\n   * Suggest alternative intents for ambiguous queries\n   */\n  suggestAlternatives(query: string): string[] {\n    const result = this.classifyIntent(query);\n    return result.alternatives.map(alt => alt.intent);\n  }\n\n  /**\n   * Calculate intent score based on pattern matching\n   */\n  private calculateIntentScore(query: string, definition: PatternDefinition): number {\n    let score = 0;\n    \n    // Check positive patterns - give higher base score for matches\n    const patternMatches = definition.patterns.filter(pattern => pattern.test(query)).length;\n    if (patternMatches > 0) {\n      // Base score of 0.6 for any pattern match, plus bonus for multiple matches\n      score = 0.6 + (patternMatches * 0.1);\n      score *= definition.weight;\n    }\n    \n    // Apply exclusion penalties\n    const exclusionMatches = definition.exclusions.filter(exclusion => exclusion.test(query)).length;\n    if (exclusionMatches > 0) {\n      score -= (exclusionMatches * 0.4); // Stronger penalty for exclusion matches\n    }\n    \n    // Keyword bonus - more generous scoring\n    const keywordMatches = definition.keywords.filter(keyword => \n      query.includes(keyword.toLowerCase())\n    ).length;\n    if (keywordMatches > 0) {\n      score += (keywordMatches * 0.15); // Higher keyword bonus\n    }\n    \n    // Special boost for exact keyword matches\n    const exactKeywordMatches = definition.keywords.filter(keyword => {\n      const keywordRegex = new RegExp(`\\\\b${keyword.replace(/\\s+/g, '\\\\s+')}\\\\b`, 'i');\n      return keywordRegex.test(query);\n    }).length;\n    if (exactKeywordMatches > 0) {\n      score += (exactKeywordMatches * 0.2); // Bonus for exact matches\n    }\n    \n    // Ensure score is between 0 and 1\n    return Math.max(0, Math.min(1, score));\n  }\n\n  /**\n   * Determine if user confirmation is required\n   */\n  private shouldRequireConfirmation(topConfidence: number, alternatives: Array<{intent: string, confidence: number}>): boolean {\n    // Require confirmation if:\n    // 1. Top confidence is below 70%\n    // 2. There's a close second option (within 20 points)\n    if (topConfidence < 70) return true;\n    \n    if (alternatives.length > 0 && (topConfidence - alternatives[0].confidence) < 20) {\n      return true;\n    }\n    \n    return false;\n  }\n\n  /**\n   * Extract parameters from query based on intent type\n   */\n  private extractParameters(query: string, intent: string): Record<string, any> {\n    const params: Record<string, any> = {};\n    \n    // Extract coordinates if present - look for decimal coordinates\n    const coordMatch = query.match(/(-?\\d+\\.\\d+),?\\s*(-?\\d+\\.\\d+)/);\n    if (coordMatch) {\n      params.latitude = parseFloat(coordMatch[1]);\n      params.longitude = parseFloat(coordMatch[2]);\n    }\n    \n    // Extract capacity if present\n    const capacityMatch = query.match(/(\\d+)\\s*mw/i);\n    if (capacityMatch) {\n      params.capacity = parseInt(capacityMatch[1]);\n    }\n    \n    // Extract area/radius if present\n    const areaMatch = query.match(/(\\d+)\\s*(km|mile|meter)/i);\n    if (areaMatch) {\n      params.radius = parseInt(areaMatch[1]);\n      params.unit = areaMatch[2].toLowerCase();\n    }\n    \n    // Extract project ID if present\n    // Matches: \"project: ID\", \"project ID\", \"project-ID\", \"project_ID\"\n    const projectIdMatch = query.match(/project[:\\s_-]+([a-zA-Z0-9_-]+)/i);\n    if (projectIdMatch) {\n      params.project_id = projectIdMatch[1];\n    }\n    \n    // Intent-specific parameter extraction\n    switch (intent) {\n      case 'terrain_analysis':\n        params.includeBuildings = /building/i.test(query);\n        params.includeRoads = /road/i.test(query);\n        params.includeWater = /water/i.test(query);\n        break;\n        \n      case 'wind_rose_analysis':\n        params.includeSeasonal = /seasonal/i.test(query);\n        params.includeHourly = /hourly/i.test(query);\n        break;\n        \n      case 'wake_analysis':\n        params.includeOptimization = /optimization/i.test(query);\n        break;\n        \n      case 'layout_optimization':\n        params.optimizeForWake = /wake/i.test(query);\n        params.optimizeForTerrain = /terrain/i.test(query);\n        break;\n    }\n    \n    return params;\n  }\n\n  /**\n   * Validate that terrain analysis is not called for non-terrain queries\n   */\n  validateNonTerrainRouting(query: string): boolean {\n    const result = this.classifyIntent(query);\n    \n    // Check if query contains non-terrain renewable keywords\n    const nonTerrainKeywords = [\n      'wind rose', 'wake effect', 'layout optimization', \n      'site suitability', 'turbine placement', 'wake analysis'\n    ];\n    \n    const hasNonTerrainKeywords = nonTerrainKeywords.some(keyword => \n      query.toLowerCase().includes(keyword)\n    );\n    \n    // If query has non-terrain keywords but was classified as terrain, it's a validation failure\n    if (hasNonTerrainKeywords && result.intent === 'terrain_analysis') {\n      console.warn('\u26A0\uFE0F Validation failed: Non-terrain query routed to terrain analysis', {\n        query,\n        classification: result.intent,\n        confidence: result.confidence\n      });\n      return false;\n    }\n    \n    return true;\n  }\n}", "/**\n * Intent Router\n * \n * Creates routing mechanism that directs queries to appropriate analysis services.\n * Includes fallback handling for low-confidence or ambiguous intent detection\n * and user confirmation for uncertain intent classifications.\n * \n * Requirements: 13.6, 13.7\n */\n\nimport { RenewableIntentClassifier, IntentClassificationResult } from './RenewableIntentClassifier';\nimport { RenewableIntent } from './types';\n\nexport interface RoutingResult {\n  intent: RenewableIntent;\n  requiresConfirmation: boolean;\n  confirmationMessage?: string;\n  fallbackOptions?: Array<{\n    intent: string;\n    description: string;\n    confidence: number;\n  }>;\n}\n\nexport interface AnalysisService {\n  type: string;\n  functionName: string;\n  description: string;\n  capabilities: string[];\n}\n\nexport class IntentRouter {\n  private classifier: RenewableIntentClassifier;\n  private services: Record<string, AnalysisService>;\n\n  constructor() {\n    this.classifier = new RenewableIntentClassifier();\n    this.services = this.initializeServices();\n  }\n\n  /**\n   * Route query to appropriate analysis service\n   */\n  async routeQuery(query: string, context?: any): Promise<RoutingResult> {\n    console.log('\uD83D\uDEA6 IntentRouter: Routing query:', query);\n    \n    // Step 1: Classify intent\n    const classification = this.classifier.classifyIntent(query);\n    \n    // Step 2: Validate service availability\n    const serviceAvailable = this.validateServiceAvailability(classification.intent);\n    if (!serviceAvailable) {\n      return this.handleServiceUnavailable(classification, query);\n    }\n    \n    // Step 3: Handle low confidence or ambiguous queries\n    if (classification.requiresConfirmation) {\n      return this.handleAmbiguousIntent(classification, query);\n    }\n    \n    // Step 4: Create routing result\n    const intent = this.createRenewableIntent(classification, query);\n    \n    console.log('\u2705 IntentRouter: Successfully routed to', intent.type);\n    return {\n      intent,\n      requiresConfirmation: false\n    };\n  }\n\n  /**\n   * Handle fallback for low-confidence intent detection\n   */\n  handleLowConfidenceIntent(classification: IntentClassificationResult, query: string): RoutingResult {\n    console.log('\u26A0\uFE0F IntentRouter: Low confidence detection, providing fallback options');\n    \n    const fallbackOptions = classification.alternatives.map(alt => ({\n      intent: alt.intent,\n      description: this.getIntentDescription(alt.intent),\n      confidence: alt.confidence\n    }));\n    \n    // Default to most likely intent but require confirmation\n    const intent = this.createRenewableIntent(classification, query);\n    \n    return {\n      intent,\n      requiresConfirmation: true,\n      confirmationMessage: this.generateConfirmationMessage(classification, query),\n      fallbackOptions\n    };\n  }\n\n  /**\n   * Handle ambiguous intent detection\n   */\n  private handleAmbiguousIntent(classification: IntentClassificationResult, query: string): RoutingResult {\n    console.log('\uD83E\uDD14 IntentRouter: Ambiguous intent detected, requiring user confirmation');\n    \n    const fallbackOptions = classification.alternatives\n      .filter(alt => alt.confidence > 30) // Only show reasonable alternatives\n      .map(alt => ({\n        intent: alt.intent,\n        description: this.getIntentDescription(alt.intent),\n        confidence: alt.confidence\n      }));\n    \n    const intent = this.createRenewableIntent(classification, query);\n    \n    return {\n      intent,\n      requiresConfirmation: true,\n      confirmationMessage: this.generateConfirmationMessage(classification, query),\n      fallbackOptions\n    };\n  }\n\n  /**\n   * Handle service unavailable scenario\n   */\n  private handleServiceUnavailable(classification: IntentClassificationResult, query: string): RoutingResult {\n    console.log('\u274C IntentRouter: Service unavailable for', classification.intent);\n    \n    // Find available alternative services\n    const availableAlternatives = classification.alternatives\n      .filter(alt => this.validateServiceAvailability(alt.intent))\n      .map(alt => ({\n        intent: alt.intent,\n        description: this.getIntentDescription(alt.intent),\n        confidence: alt.confidence\n      }));\n    \n    if (availableAlternatives.length > 0) {\n      // Route to best available alternative\n      const bestAlternative = availableAlternatives[0];\n      const intent: RenewableIntent = {\n        type: bestAlternative.intent as any,\n        params: classification.params,\n        confidence: bestAlternative.confidence\n      };\n      \n      return {\n        intent: {\n          ...intent,\n          params: {\n            ...intent.params,\n            originalIntent: classification.intent // Preserve original intent\n          }\n        },\n        requiresConfirmation: true,\n        confirmationMessage: `The requested ${this.getIntentDescription(classification.intent)} service is not available. Would you like to use ${bestAlternative.description} instead?`,\n        fallbackOptions: availableAlternatives\n      };\n    }\n    \n    // No alternatives available - fallback to terrain analysis\n    const fallbackIntent: RenewableIntent = {\n      type: 'terrain_analysis',\n      params: {\n        ...classification.params,\n        originalIntent: classification.intent, // Preserve original intent\n        query: classification.params.query || ''\n      },\n      confidence: 50\n    };\n    \n    return {\n      intent: fallbackIntent,\n      requiresConfirmation: true,\n      confirmationMessage: `The requested service is not available. Would you like to perform terrain analysis instead?`,\n      fallbackOptions: []\n    };\n  }\n\n  /**\n   * Validate that the required service is available\n   */\n  private validateServiceAvailability(intent: string): boolean {\n    const service = this.services[intent];\n    if (!service) return false;\n    \n    // Check if environment variable is set for the service\n    const envVarName = this.getEnvironmentVariableName(intent);\n    const functionName = process.env[envVarName];\n    \n    if (!functionName) {\n      console.warn(`\u26A0\uFE0F Service ${intent} not configured: ${envVarName} not set`);\n      return false;\n    }\n    \n    return true;\n  }\n\n  /**\n   * Create RenewableIntent from classification result\n   */\n  private createRenewableIntent(classification: IntentClassificationResult, query: string): RenewableIntent {\n    // Map new intent types to existing types for backward compatibility\n    const intentTypeMapping: Record<string, string> = {\n      'terrain_analysis': 'terrain_analysis',\n      'wind_rose_analysis': 'wind_rose', // Maps to simulation tool which handles wind rose\n      'wake_analysis': 'wake_simulation',\n      'layout_optimization': 'layout_optimization',\n      'site_suitability': 'report_generation', // Maps to report tool for comprehensive assessment\n      'comprehensive_assessment': 'report_generation', // Maps to report tool\n      'report_generation': 'report_generation', // Direct mapping\n      // Project lifecycle management intents - keep original names\n      'delete_project': 'delete_project',\n      'rename_project': 'rename_project',\n      'merge_projects': 'merge_projects',\n      'archive_project': 'archive_project',\n      'export_project': 'export_project',\n      'search_projects': 'search_projects'\n    };\n    \n    const mappedType = intentTypeMapping[classification.intent] || 'terrain_analysis';\n    \n    return {\n      type: mappedType as any,\n      params: {\n        ...classification.params,\n        originalIntent: classification.intent, // Preserve original intent for future use\n        query: query\n      },\n      confidence: classification.confidence\n    };\n  }\n\n  /**\n   * Generate confirmation message for ambiguous intents\n   */\n  private generateConfirmationMessage(classification: IntentClassificationResult, query: string): string {\n    const intentDescription = this.getIntentDescription(classification.intent);\n    const confidence = classification.confidence;\n    \n    if (confidence < 50) {\n      return `I'm not sure what type of renewable energy analysis you're looking for. Did you mean ${intentDescription}?`;\n    } else if (confidence < 70) {\n      return `I think you're looking for ${intentDescription} (${confidence}% confidence). Is that correct?`;\n    } else {\n      // High confidence but close alternatives\n      const topAlternative = classification.alternatives[0];\n      if (topAlternative && (confidence - topAlternative.confidence) < 20) {\n        return `Did you mean ${intentDescription} or ${this.getIntentDescription(topAlternative.intent)}?`;\n      }\n    }\n    \n    return `I'll proceed with ${intentDescription}. Let me know if you meant something else.`;\n  }\n\n  /**\n   * Get human-readable description for intent type\n   */\n  private getIntentDescription(intent: string): string {\n    const descriptions: Record<string, string> = {\n      'terrain_analysis': 'terrain and site constraint analysis',\n      'wind_rose_analysis': 'wind rose and directional analysis',\n      'wake_analysis': 'wake effect modeling and analysis',\n      'layout_optimization': 'turbine layout optimization',\n      'site_suitability': 'comprehensive site suitability assessment',\n      'comprehensive_assessment': 'comprehensive renewable energy assessment'\n    };\n    \n    return descriptions[intent] || 'renewable energy analysis';\n  }\n\n  /**\n   * Get environment variable name for service\n   */\n  private getEnvironmentVariableName(intent: string): string {\n    const envVarMapping: Record<string, string> = {\n      'terrain_analysis': 'RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME',\n      'wind_rose_analysis': 'RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME', // Wind rose uses simulation tool\n      'wake_analysis': 'RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME',\n      'layout_optimization': 'RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME',\n      'site_suitability': 'RENEWABLE_REPORT_TOOL_FUNCTION_NAME',\n      'comprehensive_assessment': 'RENEWABLE_REPORT_TOOL_FUNCTION_NAME',\n      'report_generation': 'RENEWABLE_REPORT_TOOL_FUNCTION_NAME'\n    };\n    \n    return envVarMapping[intent] || 'RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME';\n  }\n\n  /**\n   * Initialize available analysis services\n   */\n  private initializeServices(): Record<string, AnalysisService> {\n    return {\n      'terrain_analysis': {\n        type: 'terrain_analysis',\n        functionName: process.env.RENEWABLE_TERRAIN_TOOL_FUNCTION_NAME || '',\n        description: 'Terrain and site constraint analysis',\n        capabilities: ['OSM data integration', 'terrain feature analysis', 'constraint mapping']\n      },\n      'wind_rose_analysis': {\n        type: 'wind_rose_analysis',\n        functionName: process.env.RENEWABLE_WIND_TOOL_FUNCTION_NAME || '',\n        description: 'Wind rose and directional analysis',\n        capabilities: ['wind direction analysis', 'seasonal patterns', 'wind speed distributions']\n      },\n      'wake_analysis': {\n        type: 'wake_analysis',\n        functionName: process.env.RENEWABLE_SIMULATION_TOOL_FUNCTION_NAME || '',\n        description: 'Wake effect modeling and analysis',\n        capabilities: ['turbine interaction modeling', 'wake loss calculations', 'downstream impact analysis']\n      },\n      'layout_optimization': {\n        type: 'layout_optimization',\n        functionName: process.env.RENEWABLE_LAYOUT_TOOL_FUNCTION_NAME || '',\n        description: 'Turbine layout optimization',\n        capabilities: ['optimal turbine placement', 'spacing optimization', 'energy yield maximization']\n      },\n      'site_suitability': {\n        type: 'site_suitability',\n        functionName: process.env.RENEWABLE_SUITABILITY_TOOL_FUNCTION_NAME || '',\n        description: 'Comprehensive site suitability assessment',\n        capabilities: ['multi-criteria assessment', 'risk analysis', 'development recommendations']\n      },\n      'comprehensive_assessment': {\n        type: 'comprehensive_assessment',\n        functionName: process.env.RENEWABLE_COMPREHENSIVE_TOOL_FUNCTION_NAME || '',\n        description: 'Comprehensive renewable energy assessment',\n        capabilities: ['end-to-end analysis', 'integrated reporting', 'stakeholder presentations']\n      },\n      'report_generation': {\n        type: 'report_generation',\n        functionName: process.env.RENEWABLE_REPORT_TOOL_FUNCTION_NAME || '',\n        description: 'Financial analysis and report generation',\n        capabilities: ['ROI calculation', 'financial metrics', 'economic analysis', 'executive reports']\n      }\n    };\n  }\n\n  /**\n   * Get available analysis services\n   */\n  getAvailableServices(): AnalysisService[] {\n    return Object.values(this.services).filter(service => \n      this.validateServiceAvailability(service.type)\n    );\n  }\n\n  /**\n   * Validate routing for non-terrain queries (for testing)\n   */\n  validateNonTerrainRouting(query: string): boolean {\n    return this.classifier.validateNonTerrainRouting(query);\n  }\n}", "/**\n * Parameter Validation Module\n * \n * Validates required parameters before tool invocation to ensure\n * clear error messages and prevent tool failures.\n */\n\nimport type { RenewableIntent } from './types';\n\n/**\n * Project context interface for parameter validation\n */\nexport interface ProjectContext {\n  projectName?: string;\n  coordinates?: {\n    latitude: number;\n    longitude: number;\n  };\n  terrain_results?: any;\n  layout_results?: any;\n  simulation_results?: any;\n  report_results?: any;\n}\n\nexport interface ParameterValidationResult {\n  isValid: boolean;\n  errors: string[];\n  warnings: string[];\n  missingRequired: string[];\n  invalidValues: string[];\n  satisfiedByContext: string[]; // Parameters satisfied by project context\n  contextUsed: boolean; // Whether context was used in validation\n}\n\n/**\n * Required parameters for each tool type\n */\nconst REQUIRED_PARAMETERS: Record<string, string[]> = {\n  terrain_analysis: ['latitude', 'longitude'],\n  layout_optimization: ['latitude', 'longitude'], // capacity is optional, will default to 30MW\n  wake_simulation: ['project_id'],\n  wind_rose_analysis: ['latitude', 'longitude'], // Wind rose needs coordinates\n  report_generation: ['project_id']\n};\n\n/**\n * Optional parameters with defaults\n */\nconst OPTIONAL_PARAMETERS: Record<string, Record<string, any>> = {\n  terrain_analysis: {\n    radius_km: 5,\n    setback_m: 200,\n    project_id: null // Will be generated if not provided\n  },\n  layout_optimization: {\n    capacity: 30, // Default to 30MW if not provided\n    num_turbines: null, // Will be calculated from capacity if not provided\n    layout_type: 'grid',\n    project_id: null // Will be generated if not provided\n  },\n  wake_simulation: {\n    wind_speed: 8.5\n  },\n  wind_rose_analysis: {\n    project_id: null // Will be generated if not provided\n  },\n  report_generation: {}\n};\n\n/**\n * Parameters that can be satisfied by project context\n * Maps intent types to context sources and the parameters they can satisfy\n */\nconst CONTEXT_SATISFIABLE_PARAMS: Record<string, Record<string, string[]>> = {\n  layout_optimization: {\n    coordinates: ['latitude', 'longitude'],\n    terrain: ['terrain_results']\n  },\n  wake_simulation: {\n    layout: ['layout_results'],\n    coordinates: ['latitude', 'longitude']\n  },\n  report_generation: {\n    all_results: ['terrain_results', 'layout_results']\n  }\n};\n\n/**\n * Parameter value constraints\n */\nconst PARAMETER_CONSTRAINTS: Record<string, (value: any) => { valid: boolean; error?: string }> = {\n  latitude: (value: any) => {\n    const lat = parseFloat(value);\n    if (isNaN(lat)) {\n      return { valid: false, error: 'Latitude must be a valid number' };\n    }\n    if (lat < -90 || lat > 90) {\n      return { valid: false, error: 'Latitude must be between -90 and 90' };\n    }\n    return { valid: true };\n  },\n  \n  longitude: (value: any) => {\n    const lon = parseFloat(value);\n    if (isNaN(lon)) {\n      return { valid: false, error: 'Longitude must be a valid number' };\n    }\n    if (lon < -180 || lon > 180) {\n      return { valid: false, error: 'Longitude must be between -180 and 180' };\n    }\n    return { valid: true };\n  },\n  \n  capacity: (value: any) => {\n    const cap = parseFloat(value);\n    if (isNaN(cap)) {\n      return { valid: false, error: 'Capacity must be a valid number' };\n    }\n    if (cap <= 0) {\n      return { valid: false, error: 'Capacity must be greater than 0' };\n    }\n    if (cap > 1000) {\n      return { valid: false, error: 'Capacity must be 1000 MW or less' };\n    }\n    return { valid: true };\n  },\n  \n  radius_km: (value: any) => {\n    const radius = parseFloat(value);\n    if (isNaN(radius)) {\n      return { valid: false, error: 'Radius must be a valid number' };\n    }\n    if (radius <= 0) {\n      return { valid: false, error: 'Radius must be greater than 0' };\n    }\n    if (radius > 50) {\n      return { valid: false, error: 'Radius must be 50 km or less' };\n    }\n    return { valid: true };\n  },\n  \n  setback_m: (value: any) => {\n    const setback = parseFloat(value);\n    if (isNaN(setback)) {\n      return { valid: false, error: 'Setback must be a valid number' };\n    }\n    if (setback < 0) {\n      return { valid: false, error: 'Setback must be 0 or greater' };\n    }\n    if (setback > 1000) {\n      return { valid: false, error: 'Setback must be 1000 m or less' };\n    }\n    return { valid: true };\n  },\n  \n  num_turbines: (value: any) => {\n    const num = parseInt(value);\n    if (isNaN(num)) {\n      return { valid: false, error: 'Number of turbines must be a valid integer' };\n    }\n    if (num <= 0) {\n      return { valid: false, error: 'Number of turbines must be greater than 0' };\n    }\n    if (num > 200) {\n      return { valid: false, error: 'Number of turbines must be 200 or less' };\n    }\n    return { valid: true };\n  },\n  \n  project_id: (value: any) => {\n    if (typeof value !== 'string') {\n      return { valid: false, error: 'Project ID must be a string' };\n    }\n    if (value.length === 0) {\n      return { valid: false, error: 'Project ID cannot be empty' };\n    }\n    if (value.length > 100) {\n      return { valid: false, error: 'Project ID must be 100 characters or less' };\n    }\n    // Check for valid characters (alphanumeric, hyphens, underscores)\n    if (!/^[a-zA-Z0-9_-]+$/.test(value)) {\n      return { valid: false, error: 'Project ID can only contain letters, numbers, hyphens, and underscores' };\n    }\n    return { valid: true };\n  }\n};\n\n/**\n * Check if a parameter can be satisfied from project context\n */\nexport function canSatisfyFromContext(\n  param: string,\n  intentType: string,\n  projectContext?: ProjectContext\n): boolean {\n  if (!projectContext) {\n    return false;\n  }\n  \n  const satisfiable = CONTEXT_SATISFIABLE_PARAMS[intentType];\n  if (!satisfiable) {\n    return false;\n  }\n  \n  // Check if this parameter can be satisfied by context\n  for (const [contextKey, params] of Object.entries(satisfiable)) {\n    if (params.includes(param)) {\n      // Check if context has the required data\n      if (contextKey === 'coordinates' && projectContext.coordinates) {\n        return true;\n      }\n      if (contextKey === 'terrain' && projectContext.terrain_results) {\n        return true;\n      }\n      if (contextKey === 'layout' && projectContext.layout_results) {\n        return true;\n      }\n      if (contextKey === 'all_results' && \n          projectContext.terrain_results && \n          projectContext.layout_results) {\n        return true;\n      }\n    }\n  }\n  \n  return false;\n}\n\n/**\n * Validate parameters for a given intent\n */\nexport function validateParameters(\n  intent: RenewableIntent,\n  projectContext?: ProjectContext\n): ParameterValidationResult {\n  const errors: string[] = [];\n  const warnings: string[] = [];\n  const missingRequired: string[] = [];\n  const invalidValues: string[] = [];\n  const satisfiedByContext: string[] = [];\n  let contextUsed = false;\n  \n  const requiredParams = REQUIRED_PARAMETERS[intent.type] || [];\n  const optionalParams = OPTIONAL_PARAMETERS[intent.type] || {};\n  \n  console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n  console.log('\uD83D\uDD0D PARAMETER VALIDATION');\n  console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n  console.log(`\uD83C\uDFAF Intent Type: ${intent.type}`);\n  console.log(`\uD83D\uDCCB Required Parameters: ${requiredParams.join(', ')}`);\n  console.log(`\uD83D\uDCE6 Provided Parameters: ${JSON.stringify(intent.params, null, 2)}`);\n  \n  if (projectContext) {\n    console.log(`\uD83D\uDDC2\uFE0F  Project Context Available:`);\n    console.log(`   - Project Name: ${projectContext.projectName || 'N/A'}`);\n    console.log(`   - Has Coordinates: ${!!projectContext.coordinates}`);\n    console.log(`   - Has Terrain Results: ${!!projectContext.terrain_results}`);\n    console.log(`   - Has Layout Results: ${!!projectContext.layout_results}`);\n    console.log(`   - Has Simulation Results: ${!!projectContext.simulation_results}`);\n  }\n  \n  // Check for required parameters\n  for (const param of requiredParams) {\n    const hasParam = (param in intent.params) && \n                     intent.params[param] !== undefined && \n                     intent.params[param] !== null;\n    \n    if (!hasParam) {\n      // Check if parameter can be satisfied from context\n      if (canSatisfyFromContext(param, intent.type, projectContext)) {\n        satisfiedByContext.push(param);\n        contextUsed = true;\n        warnings.push(`Using ${param} from active project context`);\n        console.log(`\u2705 Parameter '${param}' satisfied by project context`);\n      } else {\n        missingRequired.push(param);\n        errors.push(`Missing required parameter: ${param}`);\n      }\n    }\n  }\n  \n  // Validate parameter values\n  for (const [param, value] of Object.entries(intent.params)) {\n    if (value === undefined || value === null) {\n      continue; // Skip undefined/null values (already caught by required check)\n    }\n    \n    const validator = PARAMETER_CONSTRAINTS[param];\n    if (validator) {\n      const result = validator(value);\n      if (!result.valid) {\n        invalidValues.push(param);\n        errors.push(`Invalid ${param}: ${result.error}`);\n      }\n    }\n  }\n  \n  // Add warnings for missing optional parameters\n  for (const [param, defaultValue] of Object.entries(optionalParams)) {\n    if (!(param in intent.params) && defaultValue !== null) {\n      warnings.push(`Optional parameter ${param} not provided, will use default: ${defaultValue}`);\n    }\n  }\n  \n  const isValid = errors.length === 0;\n  \n  console.log(`\u2705 Validation Result: ${isValid ? 'VALID' : 'INVALID'}`);\n  if (errors.length > 0) {\n    console.log(`\u274C Errors: ${errors.join(', ')}`);\n  }\n  if (warnings.length > 0) {\n    console.log(`\u26A0\uFE0F  Warnings: ${warnings.join(', ')}`);\n  }\n  if (satisfiedByContext.length > 0) {\n    console.log(`\uD83D\uDDC2\uFE0F  Satisfied by Context: ${satisfiedByContext.join(', ')}`);\n  }\n  console.log('\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500');\n  \n  return {\n    isValid,\n    errors,\n    warnings,\n    missingRequired,\n    invalidValues,\n    satisfiedByContext,\n    contextUsed\n  };\n}\n\n/**\n * Apply default values for optional parameters\n */\nexport function applyDefaultParameters(intent: RenewableIntent): RenewableIntent {\n  const optionalParams = OPTIONAL_PARAMETERS[intent.type] || {};\n  \n  for (const [param, defaultValue] of Object.entries(optionalParams)) {\n    if (!(param in intent.params) && defaultValue !== null) {\n      intent.params[param] = defaultValue;\n    }\n  }\n  \n  // Generate project_id if not provided\n  if (!intent.params.project_id) {\n    intent.params.project_id = `project-${Date.now()}`;\n  }\n  \n  // Calculate num_turbines from capacity if not provided (for layout optimization)\n  if (intent.type === 'layout_optimization' && !intent.params.num_turbines && intent.params.capacity) {\n    // Assume 2.5 MW per turbine as default\n    intent.params.num_turbines = Math.ceil(intent.params.capacity / 2.5);\n  }\n  \n  return intent;\n}\n\n/**\n * Format validation errors into user-friendly message with context awareness\n */\nexport function formatValidationError(\n  validation: ParameterValidationResult, \n  intentType: string,\n  projectContext?: ProjectContext\n): string {\n  if (validation.isValid) {\n    return '';\n  }\n  \n  const parts: string[] = [];\n  \n  // Check if missing parameters could have been satisfied by context\n  const couldUsedContext = validation.missingRequired.some(param => \n    canSatisfyFromContext(param, intentType, projectContext)\n  );\n  \n  if (validation.missingRequired.length > 0) {\n    // Use context-aware error messages if context could have helped\n    if (couldUsedContext || projectContext) {\n      const contextMessage = formatMissingContextError(\n        intentType,\n        validation.missingRequired,\n        projectContext?.projectName\n      );\n      parts.push(contextMessage);\n    } else {\n      parts.push(`Missing required parameters: ${validation.missingRequired.join(', ')}`);\n    }\n  }\n  \n  if (validation.invalidValues.length > 0) {\n    parts.push(`Invalid parameter values: ${validation.invalidValues.join(', ')}`);\n  }\n  \n  // Add specific guidance based on intent type (fallback for non-context errors)\n  if (!couldUsedContext && !projectContext && validation.missingRequired.length > 0) {\n    const guidance = getParameterGuidance(intentType);\n    if (guidance) {\n      parts.push(`\\n\\n${guidance}`);\n    }\n  }\n  \n  return parts.join('\\n\\n');\n}\n\n/**\n * Format missing context error with intent-specific guidance\n * Used when validation fails due to missing project context\n */\nfunction formatMissingContextError(\n  intentType: string,\n  missingParams: string[],\n  activeProject?: string\n): string {\n  const suggestions: Record<string, string> = {\n    layout_optimization: \n      \"To optimize layout, either:\\n\" +\n      \"\u2022 Provide coordinates: 'optimize layout at 35.067482, -101.395466'\\n\" +\n      \"\u2022 Run terrain analysis first: 'analyze terrain at 35.067482, -101.395466'\",\n    \n    wake_simulation:\n      \"To run wake simulation, first:\\n\" +\n      \"\u2022 Create a layout: 'optimize layout'\\n\" +\n      \"\u2022 Or specify a project: 'run wake simulation for project-name'\",\n    \n    report_generation:\n      \"To generate a report, first:\\n\" +\n      \"\u2022 Complete terrain analysis and layout optimization\\n\" +\n      \"\u2022 Or specify a project: 'generate report for project-name'\"\n  };\n  \n  let message = `Missing required information: ${missingParams.join(', ')}.\\n\\n`;\n  message += suggestions[intentType] || 'Please provide the required parameters.';\n  \n  if (activeProject) {\n    message += `\\n\\nActive project: ${activeProject}`;\n  }\n  \n  return message;\n}\n\n/**\n * Get parameter guidance for specific intent types\n */\nfunction getParameterGuidance(intentType: string): string {\n  const guidance: Record<string, string> = {\n    terrain_analysis: 'For terrain analysis, please provide coordinates in the format: \"latitude, longitude\" (e.g., \"35.067482, -101.395466\")',\n    layout_optimization: 'For layout optimization, please provide coordinates (e.g., \"Create a wind farm layout at 35.067482, -101.395466\"). Optionally specify capacity (e.g., \"Create a 30MW wind farm...\")',\n    wake_simulation: 'For wake simulation, please provide a project ID from a previous layout analysis',\n    report_generation: 'For report generation, please provide a project ID from a previous analysis'\n  };\n  \n  return guidance[intentType] || '';\n}\n\n/**\n * Log validation failure to CloudWatch with structured format\n */\nexport function logValidationFailure(\n  validation: ParameterValidationResult,\n  intent: RenewableIntent,\n  requestId: string,\n  projectContext?: ProjectContext\n): void {\n  console.error(JSON.stringify({\n    level: 'ERROR',\n    category: 'PARAMETER_VALIDATION',\n    requestId,\n    intentType: intent.type,\n    validation: {\n      isValid: validation.isValid,\n      missingRequired: validation.missingRequired,\n      invalidValues: validation.invalidValues,\n      errors: validation.errors,\n      satisfiedByContext: validation.satisfiedByContext,\n      contextUsed: validation.contextUsed\n    },\n    projectContext: {\n      hasActiveProject: !!projectContext?.projectName,\n      projectName: projectContext?.projectName,\n      hasCoordinates: !!projectContext?.coordinates,\n      hasTerrainResults: !!projectContext?.terrain_results,\n      hasLayoutResults: !!projectContext?.layout_results,\n      hasSimulationResults: !!projectContext?.simulation_results\n    },\n    providedParameters: intent.params,\n    timestamp: new Date().toISOString()\n  }, null, 2));\n}\n\n/**\n * Log validation success to CloudWatch with structured format\n * Useful for monitoring context usage and debugging parameter auto-fill\n */\nexport function logValidationSuccess(\n  validation: ParameterValidationResult,\n  intent: RenewableIntent,\n  requestId: string,\n  projectContext?: ProjectContext\n): void {\n  console.log(JSON.stringify({\n    level: 'INFO',\n    category: 'PARAMETER_VALIDATION',\n    requestId,\n    intentType: intent.type,\n    validation: {\n      isValid: validation.isValid,\n      warnings: validation.warnings,\n      satisfiedByContext: validation.satisfiedByContext,\n      contextUsed: validation.contextUsed\n    },\n    projectContext: {\n      hasActiveProject: !!projectContext?.projectName,\n      projectName: projectContext?.projectName,\n      hasCoordinates: !!projectContext?.coordinates,\n      hasTerrainResults: !!projectContext?.terrain_results,\n      hasLayoutResults: !!projectContext?.layout_results,\n      hasSimulationResults: !!projectContext?.simulation_results\n    },\n    providedParameters: intent.params,\n    timestamp: new Date().toISOString()\n  }, null, 2));\n}\n", "/**\n * ProjectStore - S3-based persistence for renewable energy project data\n * \n * Manages project data storage, retrieval, and caching with:\n * - S3 storage at renewable/projects/{project-name}/project.json\n * - In-memory caching with 5-minute TTL\n * - Merge logic for updates (no overwrites)\n * - Fuzzy matching for partial name searches\n * - Error handling with fallback to cache\n */\n\nimport { S3Client, GetObjectCommand, PutObjectCommand, ListObjectsV2Command, DeleteObjectCommand, NoSuchKey } from '@aws-sdk/client-s3';\nimport { Readable } from 'stream';\n\n/**\n * Retry configuration\n */\ninterface RetryConfig {\n  maxRetries: number;\n  initialDelayMs: number;\n  maxDelayMs: number;\n  backoffMultiplier: number;\n}\n\n/**\n * Default retry configuration with exponential backoff\n */\nconst DEFAULT_RETRY_CONFIG: RetryConfig = {\n  maxRetries: 3,\n  initialDelayMs: 100,\n  maxDelayMs: 5000,\n  backoffMultiplier: 2,\n};\n\n/**\n * Project status enum\n */\nexport type ProjectStatus = 'not_started' | 'in_progress' | 'completed' | 'failed';\n\n/**\n * Project data structure\n */\nexport interface ProjectData {\n  project_id: string;           // Unique ID (UUID)\n  project_name: string;          // Human-friendly name (kebab-case)\n  created_at: string;            // ISO timestamp\n  updated_at: string;            // ISO timestamp\n  status?: ProjectStatus;        // Current project status\n  coordinates?: {\n    latitude: number;\n    longitude: number;\n  };\n  terrain_results?: any;         // From terrain analysis\n  layout_results?: any;          // From layout optimization\n  simulation_results?: any;      // From wake simulation\n  report_results?: any;          // From report generation\n  metadata?: {\n    turbine_count?: number;\n    total_capacity_mw?: number;\n    annual_energy_gwh?: number;\n    archived?: boolean;\n    archived_at?: string;\n    imported_at?: string;\n    [key: string]: any; // Allow additional metadata fields\n  };\n}\n\n/**\n * Cache entry with TTL\n */\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n}\n\n/**\n * ProjectStore class for S3-based project persistence\n */\nexport class ProjectStore {\n  private s3Client: S3Client;\n  private bucketName: string;\n  private projectPrefix: string = 'renewable/projects';\n  private cache: Map<string, CacheEntry<ProjectData>> = new Map();\n  private listCache: CacheEntry<ProjectData[]> | null = null;\n  private cacheTTL: number = 10 * 1000; // 10 seconds in milliseconds (reduced from 5 minutes for faster dashboard updates)\n  private retryConfig: RetryConfig;\n\n  constructor(bucketName?: string, retryConfig?: Partial<RetryConfig>) {\n    this.s3Client = new S3Client({});\n    this.bucketName = bucketName || process.env.RENEWABLE_S3_BUCKET || '';\n    this.retryConfig = { ...DEFAULT_RETRY_CONFIG, ...retryConfig };\n    \n    if (!this.bucketName) {\n      console.warn('[ProjectStore] No S3 bucket configured. Using in-memory cache only.');\n    }\n  }\n\n  /**\n   * Save or update project data with merge logic\n   * @param projectName - Human-friendly project name (kebab-case)\n   * @param data - Partial project data to save/merge\n   */\n  async save(projectName: string, data: Partial<ProjectData>): Promise<void> {\n    try {\n      // Load existing data if it exists\n      const existing = await this.load(projectName);\n      \n      // Merge with existing data\n      const merged: ProjectData = existing \n        ? {\n            ...existing,\n            ...data,\n            updated_at: new Date().toISOString(),\n            // Deep merge for nested objects\n            coordinates: data.coordinates || existing.coordinates,\n            metadata: { ...existing.metadata, ...data.metadata },\n            // Preserve status if not explicitly updated\n            status: data.status !== undefined ? data.status : existing.status,\n          }\n        : {\n            project_id: data.project_id || this.generateProjectId(),\n            project_name: projectName,\n            created_at: new Date().toISOString(),\n            updated_at: new Date().toISOString(),\n            status: data.status || 'not_started',\n            ...data,\n          };\n\n      // Save to S3 with retry logic\n      if (this.bucketName) {\n        const key = this.getProjectKey(projectName);\n        await this.executeWithRetry(\n          async () => {\n            await this.s3Client.send(new PutObjectCommand({\n              Bucket: this.bucketName,\n              Key: key,\n              Body: JSON.stringify(merged, null, 2),\n              ContentType: 'application/json',\n            }));\n          },\n          `Save project ${projectName}`\n        );\n        \n        console.log(`[ProjectStore] Saved project: ${projectName} to S3`);\n      }\n\n      // Update cache\n      this.cache.set(projectName, {\n        data: merged,\n        timestamp: Date.now(),\n      });\n\n      // Invalidate list cache\n      this.listCache = null;\n\n    } catch (error) {\n      this.handleS3Error(error, 'Save', projectName);\n      \n      // On error, still update cache so we have something\n      if (data.project_id && data.project_name) {\n        console.warn(`[ProjectStore] Falling back to cache-only storage for ${projectName}`);\n        this.cache.set(projectName, {\n          data: data as ProjectData,\n          timestamp: Date.now(),\n        });\n      }\n      \n      throw new Error(`Failed to save project ${projectName}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Load project data by name\n   * @param projectName - Human-friendly project name\n   * @returns Project data or null if not found\n   */\n  async load(projectName: string): Promise<ProjectData | null> {\n    try {\n      // Check cache first\n      const cached = this.cache.get(projectName);\n      if (cached && (Date.now() - cached.timestamp) < this.cacheTTL) {\n        console.log(`[ProjectStore] Cache hit for project: ${projectName}`);\n        return cached.data;\n      }\n\n      // Load from S3\n      if (!this.bucketName) {\n        console.warn(`[ProjectStore] No S3 bucket configured, returning null for ${projectName}`);\n        return null;\n      }\n\n      const key = this.getProjectKey(projectName);\n      \n      // Load from S3 with retry logic\n      const projectData = await this.executeWithRetry(\n        async () => {\n          const response = await this.s3Client.send(new GetObjectCommand({\n            Bucket: this.bucketName,\n            Key: key,\n          }));\n\n          if (!response.Body) {\n            throw new Error('Empty response body from S3');\n          }\n\n          // Read stream to string\n          const bodyString = await this.streamToString(response.Body as Readable);\n          return JSON.parse(bodyString) as ProjectData;\n        },\n        `Load project ${projectName}`\n      );\n\n      // Update cache\n      this.cache.set(projectName, {\n        data: projectData,\n        timestamp: Date.now(),\n      });\n\n      console.log(`[ProjectStore] Loaded project from S3: ${projectName}`);\n      return projectData;\n\n    } catch (error) {\n      // NoSuchKey is expected for non-existent projects\n      if (error instanceof Error && error.name === 'NoSuchKey') {\n        return null;\n      }\n\n      this.handleS3Error(error, 'Load', projectName);\n      \n      // Fallback to cache even if expired on S3 errors\n      const cached = this.cache.get(projectName);\n      if (cached) {\n        console.warn(`[ProjectStore] Using ${Date.now() - cached.timestamp > this.cacheTTL ? 'expired' : 'valid'} cache for ${projectName} due to S3 error`);\n        return cached.data;\n      }\n\n      console.warn(`[ProjectStore] No cache available for ${projectName}, returning null`);\n      return null;\n    }\n  }\n\n  /**\n   * List all projects (including archived)\n   * @param includeArchived - Whether to include archived projects (default: true)\n   * @returns Array of project data\n   */\n  async list(includeArchived: boolean = true): Promise<ProjectData[]> {\n    try {\n      // Check list cache\n      if (this.listCache && (Date.now() - this.listCache.timestamp) < this.cacheTTL) {\n        console.log('[ProjectStore] List cache hit');\n        const projects = this.listCache.data;\n        \n        // Filter archived projects if requested\n        if (!includeArchived) {\n          return projects.filter((p) => p.metadata?.archived !== true);\n        }\n        \n        return projects;\n      }\n\n      if (!this.bucketName) {\n        console.warn('[ProjectStore] No S3 bucket configured, returning empty list');\n        return [];\n      }\n\n      const projects: ProjectData[] = [];\n      let continuationToken: string | undefined;\n\n      // List all project.json files\n      do {\n        const response = await this.s3Client.send(new ListObjectsV2Command({\n          Bucket: this.bucketName,\n          Prefix: `${this.projectPrefix}/`,\n          ContinuationToken: continuationToken,\n        }));\n\n        if (response.Contents) {\n          for (const object of response.Contents) {\n            if (object.Key?.endsWith('/project.json')) {\n              // Extract project name from key\n              const projectName = this.extractProjectNameFromKey(object.Key);\n              if (projectName) {\n                const projectData = await this.load(projectName);\n                if (projectData) {\n                  projects.push(projectData);\n                }\n              }\n            }\n          }\n        }\n\n        continuationToken = response.NextContinuationToken;\n      } while (continuationToken);\n\n      // Update list cache\n      this.listCache = {\n        data: projects,\n        timestamp: Date.now(),\n      };\n\n      console.log(`[ProjectStore] Listed ${projects.length} projects`);\n      \n      // Filter archived projects if requested\n      if (!includeArchived) {\n        const activeProjects = projects.filter((p) => p.metadata?.archived !== true);\n        console.log(`[ProjectStore] Filtered to ${activeProjects.length} active projects`);\n        return activeProjects;\n      }\n      \n      return projects;\n\n    } catch (error) {\n      this.handleS3Error(error, 'List');\n      \n      // Fallback to cached list if available\n      if (this.listCache) {\n        const age = Date.now() - this.listCache.timestamp;\n        console.warn(`[ProjectStore] Using ${age > this.cacheTTL ? 'expired' : 'valid'} list cache due to S3 error (age: ${Math.round(age / 1000)}s)`);\n        \n        const projects = this.listCache.data;\n        \n        // Filter archived projects if requested\n        if (!includeArchived) {\n          return projects.filter((p) => p.metadata?.archived !== true);\n        }\n        \n        return projects;\n      }\n\n      console.warn('[ProjectStore] No list cache available, returning empty array');\n      return [];\n    }\n  }\n\n  /**\n   * Find projects by partial name match using fuzzy matching\n   * @param partialName - Partial project name\n   * @returns Array of matching projects\n   */\n  async findByPartialName(partialName: string): Promise<ProjectData[]> {\n    try {\n      const allProjects = await this.list();\n      const normalizedSearch = partialName.toLowerCase().trim();\n\n      // Score each project by match quality\n      const scored = allProjects.map(project => ({\n        project,\n        score: this.calculateMatchScore(project.project_name, normalizedSearch),\n      }));\n\n      // Filter and sort by score\n      const matches = scored\n        .filter(item => item.score > 0)\n        .sort((a, b) => b.score - a.score)\n        .map(item => item.project);\n\n      console.log(`[ProjectStore] Found ${matches.length} matches for \"${partialName}\"`);\n      return matches;\n\n    } catch (error) {\n      console.error(`[ProjectStore] Error finding projects by partial name \"${partialName}\":`, error);\n      return [];\n    }\n  }\n\n  /**\n   * Delete project\n   * @param projectName - Human-friendly project name\n   */\n  async delete(projectName: string): Promise<void> {\n    try {\n      if (!this.bucketName) {\n        console.warn(`[ProjectStore] No S3 bucket configured, cannot delete ${projectName}`);\n        return;\n      }\n\n      const key = this.getProjectKey(projectName);\n      \n      // Delete from S3 with retry logic\n      await this.executeWithRetry(\n        async () => {\n          await this.s3Client.send(new DeleteObjectCommand({\n            Bucket: this.bucketName,\n            Key: key,\n          }));\n        },\n        `Delete project ${projectName}`\n      );\n\n      // Remove from cache\n      this.cache.delete(projectName);\n      this.listCache = null;\n\n      console.log(`[ProjectStore] Deleted project: ${projectName}`);\n\n    } catch (error) {\n      this.handleS3Error(error, 'Delete', projectName);\n      throw new Error(`Failed to delete project ${projectName}: ${error instanceof Error ? error.message : 'Unknown error'}`);\n    }\n  }\n\n  /**\n   * Calculate match score for fuzzy matching\n   * Higher score = better match\n   */\n  private calculateMatchScore(projectName: string, search: string): number {\n    const name = projectName.toLowerCase();\n    \n    // Exact match\n    if (name === search) {\n      return 100;\n    }\n\n    // Starts with search\n    if (name.startsWith(search)) {\n      return 90;\n    }\n\n    // Contains search as whole word\n    if (name.includes(` ${search} `) || name.includes(`-${search}-`)) {\n      return 80;\n    }\n\n    // Contains search\n    if (name.includes(search)) {\n      return 70;\n    }\n\n    // Check for word matches\n    const nameWords = name.split(/[-\\s]+/);\n    const searchWords = search.split(/[-\\s]+/);\n    \n    let wordMatches = 0;\n    for (const searchWord of searchWords) {\n      for (const nameWord of nameWords) {\n        if (nameWord.startsWith(searchWord)) {\n          wordMatches++;\n          break;\n        }\n      }\n    }\n\n    if (wordMatches > 0) {\n      return 50 + (wordMatches / searchWords.length) * 20;\n    }\n\n    // Levenshtein distance for fuzzy matching\n    const distance = this.levenshteinDistance(name, search);\n    const maxLength = Math.max(name.length, search.length);\n    const similarity = 1 - (distance / maxLength);\n\n    if (similarity > 0.6) {\n      return similarity * 50;\n    }\n\n    return 0;\n  }\n\n  /**\n   * Calculate Levenshtein distance between two strings\n   */\n  private levenshteinDistance(str1: string, str2: string): number {\n    const matrix: number[][] = [];\n\n    for (let i = 0; i <= str2.length; i++) {\n      matrix[i] = [i];\n    }\n\n    for (let j = 0; j <= str1.length; j++) {\n      matrix[0][j] = j;\n    }\n\n    for (let i = 1; i <= str2.length; i++) {\n      for (let j = 1; j <= str1.length; j++) {\n        if (str2.charAt(i - 1) === str1.charAt(j - 1)) {\n          matrix[i][j] = matrix[i - 1][j - 1];\n        } else {\n          matrix[i][j] = Math.min(\n            matrix[i - 1][j - 1] + 1, // substitution\n            matrix[i][j - 1] + 1,     // insertion\n            matrix[i - 1][j] + 1      // deletion\n          );\n        }\n      }\n    }\n\n    return matrix[str2.length][str1.length];\n  }\n\n  /**\n   * Get S3 key for project\n   */\n  private getProjectKey(projectName: string): string {\n    return `${this.projectPrefix}/${projectName}/project.json`;\n  }\n\n  /**\n   * Extract project name from S3 key\n   */\n  private extractProjectNameFromKey(key: string): string | null {\n    const match = key.match(/renewable\\/projects\\/([^/]+)\\/project\\.json/);\n    return match ? match[1] : null;\n  }\n\n  /**\n   * Generate unique project ID\n   */\n  private generateProjectId(): string {\n    return `proj-${Date.now()}-${Math.random().toString(36).substring(2, 9)}`;\n  }\n\n  /**\n   * Convert stream to string\n   */\n  private async streamToString(stream: Readable): Promise<string> {\n    return new Promise((resolve, reject) => {\n      const chunks: Buffer[] = [];\n      stream.on('data', (chunk) => chunks.push(Buffer.from(chunk)));\n      stream.on('error', reject);\n      stream.on('end', () => resolve(Buffer.concat(chunks).toString('utf-8')));\n    });\n  }\n\n  /**\n   * Clear all caches (useful for testing)\n   */\n  clearCache(): void {\n    this.cache.clear();\n    this.listCache = null;\n    console.log('[ProjectStore] Cache cleared');\n  }\n\n  /**\n   * Execute S3 operation with retry logic and exponential backoff\n   */\n  private async executeWithRetry<T>(\n    operation: () => Promise<T>,\n    operationName: string\n  ): Promise<T> {\n    let lastError: Error | undefined;\n    let delay = this.retryConfig.initialDelayMs;\n\n    for (let attempt = 0; attempt <= this.retryConfig.maxRetries; attempt++) {\n      try {\n        return await operation();\n      } catch (error) {\n        lastError = error instanceof Error ? error : new Error(String(error));\n        \n        // Don't retry on NoSuchKey errors\n        if (error instanceof Error && error.name === 'NoSuchKey') {\n          throw error;\n        }\n\n        // Don't retry on validation errors\n        if (error instanceof Error && error.message.includes('validation')) {\n          throw error;\n        }\n\n        if (attempt < this.retryConfig.maxRetries) {\n          console.warn(\n            `[ProjectStore] ${operationName} failed (attempt ${attempt + 1}/${this.retryConfig.maxRetries + 1}): ${lastError.message}. Retrying in ${delay}ms...`\n          );\n          \n          await this.sleep(delay);\n          delay = Math.min(delay * this.retryConfig.backoffMultiplier, this.retryConfig.maxDelayMs);\n        }\n      }\n    }\n\n    console.error(\n      `[ProjectStore] ${operationName} failed after ${this.retryConfig.maxRetries + 1} attempts: ${lastError?.message}`\n    );\n    throw lastError;\n  }\n\n  /**\n   * Sleep for specified milliseconds\n   */\n  private sleep(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n  }\n\n  /**\n   * Check if error is retryable\n   */\n  private isRetryableError(error: any): boolean {\n    if (!error) return false;\n\n    // Network errors are retryable\n    if (error.code === 'ECONNRESET' || error.code === 'ETIMEDOUT' || error.code === 'ENOTFOUND') {\n      return true;\n    }\n\n    // AWS SDK throttling errors are retryable\n    if (error.name === 'ThrottlingException' || error.name === 'TooManyRequestsException') {\n      return true;\n    }\n\n    // AWS SDK service errors are retryable\n    if (error.name === 'ServiceUnavailable' || error.name === 'InternalError') {\n      return true;\n    }\n\n    // Timeout errors are retryable\n    if (error.name === 'TimeoutError' || error.message?.includes('timeout')) {\n      return true;\n    }\n\n    return false;\n  }\n\n  /**\n   * Handle S3 error with appropriate logging and fallback\n   */\n  private handleS3Error(error: any, operation: string, projectName?: string): void {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorName = error instanceof Error ? error.name : 'Unknown';\n\n    if (errorName === 'NoSuchKey') {\n      console.log(`[ProjectStore] ${operation}: Project not found${projectName ? `: ${projectName}` : ''}`);\n    } else if (errorName === 'NoSuchBucket') {\n      console.error(`[ProjectStore] ${operation}: S3 bucket does not exist: ${this.bucketName}`);\n    } else if (errorName === 'AccessDenied') {\n      console.error(`[ProjectStore] ${operation}: Access denied to S3 bucket: ${this.bucketName}`);\n    } else if (this.isRetryableError(error)) {\n      console.warn(`[ProjectStore] ${operation}: Retryable error: ${errorMessage}`);\n    } else {\n      console.error(`[ProjectStore] ${operation}: Unexpected error: ${errorName} - ${errorMessage}`);\n    }\n  }\n\n  /**\n   * Get cache statistics (useful for monitoring)\n   */\n  getCacheStats(): {\n    projectCacheSize: number;\n    listCacheExists: boolean;\n    cacheTTL: number;\n  } {\n    return {\n      projectCacheSize: this.cache.size,\n      listCacheExists: this.listCache !== null,\n      cacheTTL: this.cacheTTL,\n    };\n  }\n\n  /**\n   * Archive a project\n   * @param projectName - Project name to archive\n   */\n  async archive(projectName: string): Promise<void> {\n    const project = await this.load(projectName);\n    if (!project) {\n      throw new Error(`Project '${projectName}' not found`);\n    }\n\n    await this.save(projectName, {\n      metadata: {\n        ...project.metadata,\n        archived: true,\n        archived_at: new Date().toISOString(),\n      },\n    });\n\n    console.log(`[ProjectStore] Archived project: ${projectName}`);\n  }\n\n  /**\n   * Unarchive a project\n   * @param projectName - Project name to unarchive\n   */\n  async unarchive(projectName: string): Promise<void> {\n    const project = await this.load(projectName);\n    if (!project) {\n      throw new Error(`Project '${projectName}' not found`);\n    }\n\n    await this.save(projectName, {\n      metadata: {\n        ...project.metadata,\n        archived: false,\n        archived_at: undefined,\n      },\n    });\n\n    console.log(`[ProjectStore] Unarchived project: ${projectName}`);\n  }\n\n  /**\n   * Update project status\n   * @param projectName - Project name\n   * @param status - New status\n   */\n  async updateStatus(projectName: string, status: ProjectStatus): Promise<void> {\n    const project = await this.load(projectName);\n    if (!project) {\n      throw new Error(`Project '${projectName}' not found`);\n    }\n\n    await this.save(projectName, {\n      status,\n    });\n\n    console.log(`[ProjectStore] Updated project ${projectName} status to: ${status}`);\n  }\n\n  /**\n   * Check if project is archived\n   * @param projectName - Project name\n   * @returns True if archived, false otherwise\n   */\n  async isArchived(projectName: string): Promise<boolean> {\n    const project = await this.load(projectName);\n    return project?.metadata?.archived === true;\n  }\n\n  /**\n   * Check if project is in progress\n   * @param projectName - Project name\n   * @returns True if in progress, false otherwise\n   */\n  async isInProgress(projectName: string): Promise<boolean> {\n    const project = await this.load(projectName);\n    return project?.status === 'in_progress';\n  }\n\n  /**\n   * List archived projects\n   * @returns Array of archived projects\n   */\n  async listArchived(): Promise<ProjectData[]> {\n    const allProjects = await this.list(true);\n    return allProjects.filter(p => p.metadata?.archived === true);\n  }\n\n  /**\n   * List active (non-archived) projects\n   * @returns Array of active projects\n   */\n  async listActive(): Promise<ProjectData[]> {\n    return this.list(false);\n  }\n\n  /**\n   * Mark project as imported\n   * @param projectName - Project name\n   */\n  async markAsImported(projectName: string): Promise<void> {\n    const project = await this.load(projectName);\n    if (!project) {\n      throw new Error(`Project '${projectName}' not found`);\n    }\n\n    await this.save(projectName, {\n      metadata: {\n        ...project.metadata,\n        imported_at: new Date().toISOString(),\n      },\n    });\n\n    console.log(`[ProjectStore] Marked project as imported: ${projectName}`);\n  }\n}\n", "/**\n * ProjectNameGenerator\n * \n * Generates human-friendly project names from location context.\n * Supports:\n * - Location extraction from natural language queries\n * - Reverse geocoding using AWS Location Service\n * - Name normalization to kebab-case\n * - Uniqueness checking against existing projects\n */\n\nimport { LocationClient, SearchPlaceIndexForPositionCommand } from '@aws-sdk/client-location';\nimport { ProjectStore } from './projectStore';\n\nexport interface Coordinates {\n  lat: number;\n  lon: number;\n}\n\nexport class ProjectNameGenerator {\n  private locationClient: LocationClient;\n  private projectStore: ProjectStore;\n  private placeIndexName: string;\n  private geocodingCache: Map<string, { name: string; timestamp: number }>;\n  private readonly CACHE_TTL_MS = 24 * 60 * 60 * 1000; // 24 hours\n\n  constructor(projectStore: ProjectStore, placeIndexName?: string) {\n    this.locationClient = new LocationClient({});\n    this.projectStore = projectStore;\n    this.placeIndexName = placeIndexName || process.env.AWS_LOCATION_PLACE_INDEX || 'RenewableProjectPlaceIndex';\n    this.geocodingCache = new Map();\n  }\n\n  /**\n   * Generate project name from query and optional coordinates\n   * \n   * Extraction patterns:\n   * - \"analyze terrain in West Texas\" \u2192 \"west-texas-wind-farm\"\n   * - \"wind farm at Amarillo\" \u2192 \"amarillo-wind-farm\"\n   * - \"create project Panhandle Wind\" \u2192 \"panhandle-wind\"\n   * \n   * @param query - User query text\n   * @param coordinates - Optional coordinates for reverse geocoding\n   * @returns Human-friendly project name (kebab-case)\n   */\n  async generateFromQuery(query: string, coordinates?: Coordinates): Promise<string> {\n    // Try to extract location from query\n    const extractedLocation = this.extractLocationFromQuery(query);\n    \n    if (extractedLocation) {\n      const normalized = this.normalize(extractedLocation);\n      return await this.ensureUnique(normalized);\n    }\n\n    // If coordinates provided but no location in query, use reverse geocoding\n    if (coordinates) {\n      return await this.generateFromCoordinates(coordinates.lat, coordinates.lon);\n    }\n\n    // Fallback: generate generic name with timestamp\n    const timestamp = Date.now().toString(36);\n    return await this.ensureUnique(`wind-farm-${timestamp}`);\n  }\n\n  /**\n   * Extract location name from query using regex patterns\n   * \n   * Patterns:\n   * - \"in {location}\" \u2192 extract location\n   * - \"at {location}\" \u2192 extract location  \n   * - \"{location} wind farm\" \u2192 extract location\n   * - \"for {location}\" \u2192 extract location\n   * - \"near {location}\" \u2192 extract location\n   * \n   * @param query - User query text\n   * @returns Extracted location or null\n   */\n  private extractLocationFromQuery(query: string): string | null {\n    // Pattern 1: \"in {location}\" or \"at {location}\"\n    const inAtPattern = /(?:in|at)\\s+([A-Z][a-zA-Z\\s]+?)(?:\\s+wind\\s+farm|\\s+area|\\s*$|,|\\s+for|\\s+with)/i;\n    let match = query.match(inAtPattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n\n    // Pattern 2: \"{location} wind farm\"\n    const windFarmPattern = /([A-Z][a-zA-Z\\s]+?)\\s+wind\\s+farm/i;\n    match = query.match(windFarmPattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n\n    // Pattern 3: \"for {location}\" or \"near {location}\"\n    const forNearPattern = /(?:for|near)\\s+([A-Z][a-zA-Z\\s]+?)(?:\\s+wind\\s+farm|\\s+area|\\s*$|,|\\s+project)/i;\n    match = query.match(forNearPattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n\n    // Pattern 4: \"create project {name}\"\n    const projectPattern = /(?:create|new)\\s+project\\s+([A-Z][a-zA-Z\\s]+?)(?:\\s*$|,|\\s+at|\\s+in)/i;\n    match = query.match(projectPattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n\n    // Pattern 5: Multi-word location at start of query\n    const startPattern = /^([A-Z][a-zA-Z]+(?:\\s+[A-Z][a-zA-Z]+)*)\\s+(?:terrain|wind|analysis|site)/i;\n    match = query.match(startPattern);\n    if (match && match[1]) {\n      return match[1].trim();\n    }\n\n    return null;\n  }\n\n  /**\n   * Generate project name from coordinates using reverse geocoding\n   * \n   * Uses AWS Location Service to convert coordinates to city/state.\n   * Falls back to coordinate-based name if geocoding fails.\n   * \n   * @param latitude - Latitude\n   * @param longitude - Longitude\n   * @returns Location-based project name (e.g., \"amarillo-tx-wind-farm\")\n   */\n  async generateFromCoordinates(latitude: number, longitude: number): Promise<string> {\n    // Check cache first\n    const cacheKey = `${latitude.toFixed(4)},${longitude.toFixed(4)}`;\n    const cached = this.geocodingCache.get(cacheKey);\n    \n    if (cached && (Date.now() - cached.timestamp) < this.CACHE_TTL_MS) {\n      return await this.ensureUnique(cached.name);\n    }\n\n    try {\n      // Call AWS Location Service for reverse geocoding\n      const command = new SearchPlaceIndexForPositionCommand({\n        IndexName: this.placeIndexName,\n        Position: [longitude, latitude], // AWS Location uses [lon, lat] order\n        MaxResults: 1,\n      });\n\n      const response = await this.locationClient.send(command);\n\n      if (response.Results && response.Results.length > 0) {\n        const place = response.Results[0].Place;\n        \n        // Build location name from place components\n        const locationParts: string[] = [];\n        \n        if (place?.Municipality) {\n          locationParts.push(place.Municipality);\n        } else if (place?.Neighborhood) {\n          locationParts.push(place.Neighborhood);\n        }\n        \n        if (place?.Region) {\n          // Use state abbreviation if available, otherwise full name\n          const region = place.Region.length <= 2 ? place.Region : place.Region;\n          locationParts.push(region);\n        }\n\n        if (locationParts.length > 0) {\n          const locationName = this.normalize(locationParts.join(' '));\n          \n          // Cache the result\n          this.geocodingCache.set(cacheKey, {\n            name: locationName,\n            timestamp: Date.now(),\n          });\n          \n          return await this.ensureUnique(locationName);\n        }\n      }\n    } catch (error) {\n      console.warn('Reverse geocoding failed, using coordinate-based name:', error);\n    }\n\n    // Fallback: coordinate-based name\n    const latStr = latitude.toFixed(2).replace('.', '-').replace('-', latitude >= 0 ? 'n' : 's');\n    const lonStr = Math.abs(longitude).toFixed(2).replace('.', '-') + (longitude >= 0 ? 'e' : 'w');\n    const fallbackName = `site-${latStr}-${lonStr}`;\n    \n    return await this.ensureUnique(fallbackName);\n  }\n\n  /**\n   * Normalize project name to kebab-case\n   * \n   * Rules:\n   * - Convert to lowercase\n   * - Replace spaces with hyphens\n   * - Remove special characters except hyphens\n   * - Remove multiple consecutive hyphens\n   * - Trim leading/trailing hyphens\n   * - Append \"-wind-farm\" if not already present\n   * \n   * @param name - Raw project name\n   * @returns Normalized kebab-case name\n   */\n  normalize(name: string): string {\n    let normalized = name\n      .toLowerCase()\n      .trim()\n      // Replace spaces and underscores with hyphens\n      .replace(/[\\s_]+/g, '-')\n      // Remove special characters except hyphens and alphanumeric\n      .replace(/[^a-z0-9-]/g, '')\n      // Remove multiple consecutive hyphens\n      .replace(/-+/g, '-')\n      // Trim leading/trailing hyphens\n      .replace(/^-+|-+$/g, '');\n\n    // Append \"-wind-farm\" if not already present\n    if (!normalized.includes('wind-farm') && !normalized.includes('wind') && !normalized.includes('farm')) {\n      normalized = `${normalized}-wind-farm`;\n    }\n\n    return normalized;\n  }\n\n  /**\n   * Ensure project name is unique by checking existing projects\n   * \n   * If name exists, appends number: \"west-texas-wind-farm-2\"\n   * Increments until unique name found.\n   * \n   * @param baseName - Base project name\n   * @returns Unique name\n   */\n  async ensureUnique(baseName: string): Promise<string> {\n    try {\n      // Get all existing projects\n      const existingProjects = await this.projectStore.list();\n      const existingNames = new Set(existingProjects.map(p => p.project_name));\n\n      // If base name is unique, return it\n      if (!existingNames.has(baseName)) {\n        return baseName;\n      }\n\n      // Find unique name by appending number\n      let counter = 2;\n      let uniqueName = `${baseName}-${counter}`;\n      \n      while (existingNames.has(uniqueName)) {\n        counter++;\n        uniqueName = `${baseName}-${counter}`;\n        \n        // Safety check to prevent infinite loop\n        if (counter > 1000) {\n          // Append timestamp as last resort\n          const timestamp = Date.now().toString(36);\n          return `${baseName}-${timestamp}`;\n        }\n      }\n\n      return uniqueName;\n    } catch (error) {\n      console.error('Error checking project uniqueness:', error);\n      // If we can't check uniqueness, append timestamp\n      const timestamp = Date.now().toString(36);\n      return `${baseName}-${timestamp}`;\n    }\n  }\n\n  /**\n   * Clear the geocoding cache (useful for testing)\n   */\n  clearCache(): void {\n    this.geocodingCache.clear();\n  }\n}\n", "/**\n * SessionContextManager - DynamoDB-based session context tracking\n * \n * Manages session state for renewable energy projects with:\n * - Active project tracking per session\n * - Project history (recently accessed projects)\n * - DynamoDB persistence with 7-day TTL\n * - In-memory caching with 5-minute TTL\n * - Graceful fallback to session-only context\n */\n\nimport { DynamoDBClient } from '@aws-sdk/client-dynamodb';\nimport { \n  DynamoDBDocumentClient, \n  GetCommand, \n  PutCommand, \n  UpdateCommand,\n  GetCommandInput,\n  PutCommandInput,\n  UpdateCommandInput\n} from '@aws-sdk/lib-dynamodb';\n\n/**\n * Session context structure\n */\nexport interface SessionContext {\n  session_id: string;\n  user_id: string;\n  active_project?: string;      // Current project name\n  project_history: string[];    // Recently accessed projects (max 10)\n  last_updated: string;         // ISO timestamp\n  ttl?: number;                 // Unix timestamp for DynamoDB TTL\n}\n\n/**\n * Cache entry with TTL\n */\ninterface CacheEntry<T> {\n  data: T;\n  timestamp: number;\n}\n\n/**\n * SessionContextManager class for DynamoDB-based session tracking\n */\nexport class SessionContextManager {\n  private dynamoClient: DynamoDBDocumentClient;\n  private tableName: string;\n  private cache: Map<string, CacheEntry<SessionContext>> = new Map();\n  private cacheTTL: number = 5 * 60 * 1000; // 5 minutes in milliseconds\n  private sessionTTL: number = 7 * 24 * 60 * 60; // 7 days in seconds\n  private maxHistorySize: number = 10;\n\n  constructor(tableName?: string) {\n    const client = new DynamoDBClient({});\n    this.dynamoClient = DynamoDBDocumentClient.from(client);\n    this.tableName = tableName || process.env.SESSION_CONTEXT_TABLE || 'RenewableSessionContext';\n    \n    if (!this.tableName) {\n      console.warn('[SessionContextManager] No DynamoDB table configured. Using in-memory cache only.');\n    }\n  }\n\n  /**\n   * Get session context\n   * @param sessionId - Chat session ID\n   * @returns Session context\n   */\n  async getContext(sessionId: string): Promise<SessionContext> {\n    try {\n      // Check cache first\n      const cached = this.cache.get(sessionId);\n      if (cached && (Date.now() - cached.timestamp) < this.cacheTTL) {\n        console.log(`[SessionContextManager] Cache hit for session: ${sessionId}`);\n        return cached.data;\n      }\n\n      // Query DynamoDB\n      if (!this.tableName) {\n        console.warn(`[SessionContextManager] No table configured, creating new context for ${sessionId}`);\n        return this.createNewContext(sessionId);\n      }\n\n      const params: GetCommandInput = {\n        TableName: this.tableName,\n        Key: {\n          session_id: sessionId,\n        },\n      };\n\n      const result = await this.dynamoClient.send(new GetCommand(params));\n\n      if (result.Item) {\n        const context = result.Item as SessionContext;\n        \n        // Update cache\n        this.cache.set(sessionId, {\n          data: context,\n          timestamp: Date.now(),\n        });\n\n        console.log(`[SessionContextManager] Loaded context from DynamoDB for session: ${sessionId}`);\n        return context;\n      }\n\n      // Create new context if not found\n      const newContext = this.createNewContext(sessionId);\n      await this.saveContext(newContext);\n      return newContext;\n\n    } catch (error) {\n      this.handleDynamoDBError(error, 'GetContext', sessionId);\n      \n      // Fallback to cache even if expired\n      const cached = this.cache.get(sessionId);\n      if (cached) {\n        console.warn(`[SessionContextManager] Using ${Date.now() - cached.timestamp > this.cacheTTL ? 'expired' : 'valid'} cache for ${sessionId} due to DynamoDB error`);\n        return cached.data;\n      }\n\n      // Last resort: create new session-only context\n      console.warn(`[SessionContextManager] Creating session-only context for ${sessionId} due to DynamoDB error`);\n      return this.createNewContext(sessionId);\n    }\n  }\n\n  /**\n   * Set active project for session\n   * @param sessionId - Chat session ID\n   * @param projectName - Project name to set as active\n   */\n  async setActiveProject(sessionId: string, projectName: string): Promise<void> {\n    const now = new Date().toISOString();\n    \n    try {\n      const ttl = Math.floor(Date.now() / 1000) + this.sessionTTL;\n\n      if (!this.tableName) {\n        console.warn(`[SessionContextManager] No table configured, updating cache only for ${sessionId}`);\n        const cached = this.cache.get(sessionId);\n        if (cached) {\n          cached.data.active_project = projectName;\n          cached.data.last_updated = now;\n          cached.timestamp = Date.now();\n        }\n        return;\n      }\n\n      // Update DynamoDB\n      const params: UpdateCommandInput = {\n        TableName: this.tableName,\n        Key: {\n          session_id: sessionId,\n        },\n        UpdateExpression: 'SET active_project = :project, last_updated = :updated, #ttl = :ttl',\n        ExpressionAttributeNames: {\n          '#ttl': 'ttl',\n        },\n        ExpressionAttributeValues: {\n          ':project': projectName,\n          ':updated': now,\n          ':ttl': ttl,\n        },\n        ReturnValues: 'ALL_NEW',\n      };\n\n      const result = await this.dynamoClient.send(new UpdateCommand(params));\n\n      if (result.Attributes) {\n        const context = result.Attributes as SessionContext;\n        \n        // Update cache\n        this.cache.set(sessionId, {\n          data: context,\n          timestamp: Date.now(),\n        });\n\n        console.log(`[SessionContextManager] Set active project for ${sessionId}: ${projectName}`);\n      }\n\n    } catch (error) {\n      this.handleDynamoDBError(error, 'SetActiveProject', sessionId);\n      \n      // Fallback: update cache only\n      console.warn(`[SessionContextManager] Falling back to cache-only update for ${sessionId}`);\n      const cached = this.cache.get(sessionId);\n      if (cached) {\n        cached.data.active_project = projectName;\n        cached.data.last_updated = now;\n        cached.timestamp = Date.now();\n      } else {\n        // Create new cache entry\n        const newContext = this.createNewContext(sessionId);\n        newContext.active_project = projectName;\n        this.cache.set(sessionId, {\n          data: newContext,\n          timestamp: Date.now(),\n        });\n      }\n    }\n  }\n\n  /**\n   * Get active project for session\n   * @param sessionId - Chat session ID\n   * @returns Active project name or null\n   */\n  async getActiveProject(sessionId: string): Promise<string | null> {\n    try {\n      const context = await this.getContext(sessionId);\n      return context.active_project || null;\n    } catch (error) {\n      console.error(`[SessionContextManager] Error getting active project for ${sessionId}:`, error);\n      return null;\n    }\n  }\n\n  /**\n   * Add project to history\n   * @param sessionId - Chat session ID\n   * @param projectName - Project name to add\n   */\n  async addToHistory(sessionId: string, projectName: string): Promise<void> {\n    const now = new Date().toISOString();\n    \n    try {\n      const context = await this.getContext(sessionId);\n      \n      // Remove project if already in history\n      const history = context.project_history.filter(p => p !== projectName);\n      \n      // Add to front of history\n      history.unshift(projectName);\n      \n      // Limit history size\n      const trimmedHistory = history.slice(0, this.maxHistorySize);\n      \n      const ttl = Math.floor(Date.now() / 1000) + this.sessionTTL;\n\n      if (!this.tableName) {\n        console.warn(`[SessionContextManager] No table configured, updating cache only for ${sessionId}`);\n        const cached = this.cache.get(sessionId);\n        if (cached) {\n          cached.data.project_history = trimmedHistory;\n          cached.data.last_updated = now;\n          cached.timestamp = Date.now();\n        }\n        return;\n      }\n\n      // Update DynamoDB\n      const params: UpdateCommandInput = {\n        TableName: this.tableName,\n        Key: {\n          session_id: sessionId,\n        },\n        UpdateExpression: 'SET project_history = :history, last_updated = :updated, #ttl = :ttl',\n        ExpressionAttributeNames: {\n          '#ttl': 'ttl',\n        },\n        ExpressionAttributeValues: {\n          ':history': trimmedHistory,\n          ':updated': now,\n          ':ttl': ttl,\n        },\n        ReturnValues: 'ALL_NEW',\n      };\n\n      const result = await this.dynamoClient.send(new UpdateCommand(params));\n\n      if (result.Attributes) {\n        const updatedContext = result.Attributes as SessionContext;\n        \n        // Update cache\n        this.cache.set(sessionId, {\n          data: updatedContext,\n          timestamp: Date.now(),\n        });\n\n        console.log(`[SessionContextManager] Added ${projectName} to history for ${sessionId}`);\n      }\n\n    } catch (error) {\n      this.handleDynamoDBError(error, 'AddToHistory', sessionId);\n      \n      // Fallback: update cache only\n      console.warn(`[SessionContextManager] Falling back to cache-only update for ${sessionId}`);\n      const cached = this.cache.get(sessionId);\n      if (cached) {\n        const history = cached.data.project_history.filter(p => p !== projectName);\n        history.unshift(projectName);\n        cached.data.project_history = history.slice(0, this.maxHistorySize);\n        cached.data.last_updated = now; // now is defined at function start\n        cached.timestamp = Date.now();\n      }\n    }\n  }\n\n  /**\n   * Create new session context\n   */\n  private createNewContext(sessionId: string, userId: string = 'default'): SessionContext {\n    const now = new Date().toISOString();\n    const ttl = Math.floor(Date.now() / 1000) + this.sessionTTL;\n\n    return {\n      session_id: sessionId,\n      user_id: userId,\n      project_history: [],\n      last_updated: now,\n      ttl,\n    };\n  }\n\n  /**\n   * Save context to DynamoDB\n   */\n  private async saveContext(context: SessionContext): Promise<void> {\n    try {\n      if (!this.tableName) {\n        console.warn(`[SessionContextManager] No table configured, saving to cache only`);\n        this.cache.set(context.session_id, {\n          data: context,\n          timestamp: Date.now(),\n        });\n        return;\n      }\n\n      const params: PutCommandInput = {\n        TableName: this.tableName,\n        Item: context,\n      };\n\n      await this.dynamoClient.send(new PutCommand(params));\n\n      // Update cache\n      this.cache.set(context.session_id, {\n        data: context,\n        timestamp: Date.now(),\n      });\n\n      console.log(`[SessionContextManager] Saved new context for session: ${context.session_id}`);\n\n    } catch (error) {\n      this.handleDynamoDBError(error, 'SaveContext', context.session_id);\n      \n      // Fallback: save to cache only\n      console.warn(`[SessionContextManager] Falling back to cache-only storage for ${context.session_id}`);\n      this.cache.set(context.session_id, {\n        data: context,\n        timestamp: Date.now(),\n      });\n    }\n  }\n\n  /**\n   * Handle DynamoDB error with appropriate logging\n   */\n  private handleDynamoDBError(error: any, operation: string, sessionId?: string): void {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorName = error instanceof Error ? error.name : 'Unknown';\n\n    if (errorName === 'ResourceNotFoundException') {\n      console.error(`[SessionContextManager] ${operation}: DynamoDB table does not exist: ${this.tableName}`);\n    } else if (errorName === 'AccessDeniedException') {\n      console.error(`[SessionContextManager] ${operation}: Access denied to DynamoDB table: ${this.tableName}`);\n    } else if (errorName === 'ProvisionedThroughputExceededException') {\n      console.warn(`[SessionContextManager] ${operation}: Throughput exceeded for table: ${this.tableName}`);\n    } else {\n      console.error(`[SessionContextManager] ${operation}: Unexpected error: ${errorName} - ${errorMessage}${sessionId ? ` (session: ${sessionId})` : ''}`);\n    }\n  }\n\n  /**\n   * Invalidate cache for session\n   * @param sessionId - Chat session ID\n   */\n  invalidateCache(sessionId: string): void {\n    this.cache.delete(sessionId);\n    console.log(`[SessionContextManager] Cache invalidated for session: ${sessionId}`);\n  }\n\n  /**\n   * Clear all caches (useful for testing)\n   */\n  clearCache(): void {\n    this.cache.clear();\n    console.log('[SessionContextManager] All caches cleared');\n  }\n\n  /**\n   * Get cache statistics (useful for monitoring)\n   */\n  getCacheStats(): {\n    cacheSize: number;\n    cacheTTL: number;\n    sessionTTL: number;\n  } {\n    return {\n      cacheSize: this.cache.size,\n      cacheTTL: this.cacheTTL,\n      sessionTTL: this.sessionTTL,\n    };\n  }\n}\n", "/**\n * ProjectResolver - Resolve project references from natural language queries\n * \n * Handles:\n * - Explicit project references (\"for project west-texas\", \"project panhandle-wind\")\n * - Implicit references (\"that project\", \"the project\", \"continue\")\n * - Partial name matching with fuzzy search\n * - Ambiguity detection and resolution\n */\n\nimport { ProjectStore } from './projectStore';\nimport { SessionContext } from './sessionContextManager';\n\ninterface ProjectData {\n  project_id: string;\n  project_name: string;\n  created_at: string;\n  updated_at: string;\n  coordinates?: {\n    latitude: number;\n    longitude: number;\n  };\n  terrain_results?: any;\n  layout_results?: any;\n  simulation_results?: any;\n  report_results?: any;\n  metadata?: {\n    turbine_count?: number;\n    total_capacity_mw?: number;\n    annual_energy_gwh?: number;\n  };\n}\n\ninterface ResolveResult {\n  projectName: string | null;\n  isAmbiguous: boolean;\n  matches?: string[];\n  confidence: 'explicit' | 'implicit' | 'partial' | 'active' | 'none';\n}\n\nexport class ProjectResolver {\n  private projectStore: ProjectStore;\n  private projectListCache: { projects: ProjectData[]; timestamp: number } | null = null;\n  private readonly CACHE_TTL_MS = 5 * 60 * 1000; // 5 minutes\n\n  constructor(projectStore: ProjectStore) {\n    this.projectStore = projectStore;\n  }\n\n  /**\n   * Resolve project name from query and session context\n   * @param query - User query text\n   * @param sessionContext - Current session context\n   * @returns Resolved project name or null\n   */\n  async resolve(query: string, sessionContext: SessionContext): Promise<ResolveResult> {\n    console.log('[ProjectResolver] Resolving project from query:', query);\n    console.log('[ProjectResolver] Session context:', {\n      active_project: sessionContext.active_project,\n      history: sessionContext.project_history\n    });\n\n    // 1. Check for explicit project reference\n    const explicitRef = this.extractExplicitReference(query);\n    if (explicitRef) {\n      console.log('[ProjectResolver] Found explicit reference:', explicitRef);\n      \n      // Verify project exists\n      const matches = await this.findMatchingProjects(explicitRef);\n      if (matches.length === 1) {\n        return {\n          projectName: matches[0],\n          isAmbiguous: false,\n          confidence: 'explicit'\n        };\n      } else if (matches.length > 1) {\n        return {\n          projectName: null,\n          isAmbiguous: true,\n          matches,\n          confidence: 'explicit'\n        };\n      }\n      // If no exact match, continue to partial matching\n    }\n\n    // 2. Check for implicit references\n    const implicitRef = this.extractImplicitReference(query, sessionContext);\n    if (implicitRef) {\n      console.log('[ProjectResolver] Found implicit reference:', implicitRef);\n      return {\n        projectName: implicitRef,\n        isAmbiguous: false,\n        confidence: 'implicit'\n      };\n    }\n\n    // 3. Check for partial name match in query\n    const partialMatch = await this.matchPartialName(query);\n    if (partialMatch) {\n      console.log('[ProjectResolver] Found partial match:', partialMatch);\n      \n      if (typeof partialMatch === 'string') {\n        return {\n          projectName: partialMatch,\n          isAmbiguous: false,\n          confidence: 'partial'\n        };\n      } else {\n        // Multiple matches\n        return {\n          projectName: null,\n          isAmbiguous: true,\n          matches: partialMatch as string[],\n          confidence: 'partial'\n        };\n      }\n    }\n\n    // 4. Fall back to active project from session\n    if (sessionContext.active_project) {\n      console.log('[ProjectResolver] Using active project:', sessionContext.active_project);\n      return {\n        projectName: sessionContext.active_project,\n        isAmbiguous: false,\n        confidence: 'active'\n      };\n    }\n\n    // 5. No match found\n    console.log('[ProjectResolver] No project reference found');\n    return {\n      projectName: null,\n      isAmbiguous: false,\n      confidence: 'none'\n    };\n  }\n\n  /**\n   * Extract explicit project reference from query\n   * Patterns:\n   * - \"for project {name}\"\n   * - \"for {name} project\"\n   * - \"project {name}\"\n   * \n   * @param query - User query\n   * @returns Extracted project name or null\n   */\n  extractExplicitReference(query: string): string | null {\n    const normalizedQuery = query.toLowerCase().trim();\n\n    // Pattern 1: \"for project {name}\"\n    const forProjectPattern = /for\\s+project\\s+([a-z0-9\\-\\s]+?)(?:\\s|$|\\.|\\,)/i;\n    let match = normalizedQuery.match(forProjectPattern);\n    if (match) {\n      return this.normalizeProjectName(match[1]);\n    }\n\n    // Pattern 2: \"for {name} project\"\n    const forNameProjectPattern = /for\\s+([a-z0-9\\-\\s]+?)\\s+project(?:\\s|$|\\.|\\,)/i;\n    match = normalizedQuery.match(forNameProjectPattern);\n    if (match) {\n      return this.normalizeProjectName(match[1]);\n    }\n\n    // Pattern 3: \"project {name}\" (at start or after punctuation)\n    const projectNamePattern = /(?:^|\\s)project\\s+([a-z0-9\\-\\s]+?)(?:\\s|$|\\.|\\,)/i;\n    match = normalizedQuery.match(projectNamePattern);\n    if (match) {\n      return this.normalizeProjectName(match[1]);\n    }\n\n    return null;\n  }\n\n  /**\n   * Extract implicit project reference from query\n   * Patterns:\n   * - \"that project\" \u2192 last mentioned project\n   * - \"the project\" \u2192 active project\n   * - \"continue\" \u2192 active project\n   * \n   * @param query - User query\n   * @param sessionContext - Current session context\n   * @returns Project name or null\n   */\n  private extractImplicitReference(query: string, sessionContext: SessionContext): string | null {\n    const normalizedQuery = query.toLowerCase().trim();\n\n    // Pattern 1: \"that project\" \u2192 last mentioned (most recent in history)\n    if (normalizedQuery.includes('that project')) {\n      if (sessionContext.project_history && sessionContext.project_history.length > 0) {\n        return sessionContext.project_history[0]; // Most recent\n      }\n    }\n\n    // Pattern 2: \"the project\" \u2192 active project\n    if (normalizedQuery.includes('the project')) {\n      return sessionContext.active_project || null;\n    }\n\n    // Pattern 3: \"continue\" \u2192 active project\n    if (normalizedQuery.match(/\\bcontinue\\b/)) {\n      return sessionContext.active_project || null;\n    }\n\n    return null;\n  }\n\n  /**\n   * Match project by partial name using fuzzy matching\n   * \n   * @param query - User query or partial name\n   * @returns Best matching project name, array of matches if ambiguous, or null\n   */\n  async matchPartialName(query: string): Promise<string | string[] | null> {\n    const projects = await this.getProjectList();\n    if (projects.length === 0) {\n      return null;\n    }\n\n    const normalizedQuery = query.toLowerCase().trim();\n    \n    // Extract potential project name fragments from query\n    const fragments = this.extractProjectNameFragments(normalizedQuery);\n    if (fragments.length === 0) {\n      return null;\n    }\n\n    console.log('[ProjectResolver] Extracted fragments:', fragments);\n\n    // Find matches for each fragment\n    const allMatches: Array<{ projectName: string; score: number; matchType: string }> = [];\n\n    for (const fragment of fragments) {\n      // Exact match\n      const exactMatches = projects.filter(p => \n        p.project_name.toLowerCase() === fragment\n      );\n      exactMatches.forEach(p => {\n        allMatches.push({ projectName: p.project_name, score: 100, matchType: 'exact' });\n      });\n\n      // Contains match\n      const containsMatches = projects.filter(p => \n        p.project_name.toLowerCase().includes(fragment) && \n        !exactMatches.find(em => em.project_name === p.project_name)\n      );\n      containsMatches.forEach(p => {\n        allMatches.push({ projectName: p.project_name, score: 80, matchType: 'contains' });\n      });\n\n      // Fuzzy match (Levenshtein distance)\n      const fuzzyMatches = projects.filter(p => {\n        const distance = this.levenshteinDistance(fragment, p.project_name.toLowerCase());\n        const maxLength = Math.max(fragment.length, p.project_name.length);\n        const similarity = 1 - (distance / maxLength);\n        return similarity > 0.6 && \n               !exactMatches.find(em => em.project_name === p.project_name) &&\n               !containsMatches.find(cm => cm.project_name === p.project_name);\n      });\n      fuzzyMatches.forEach(p => {\n        const distance = this.levenshteinDistance(fragment, p.project_name.toLowerCase());\n        const maxLength = Math.max(fragment.length, p.project_name.length);\n        const similarity = 1 - (distance / maxLength);\n        allMatches.push({ \n          projectName: p.project_name, \n          score: similarity * 60, \n          matchType: 'fuzzy' \n        });\n      });\n    }\n\n    if (allMatches.length === 0) {\n      return null;\n    }\n\n    // Sort by score (highest first)\n    allMatches.sort((a, b) => b.score - a.score);\n\n    console.log('[ProjectResolver] Matches found:', allMatches);\n\n    // If top match is significantly better than others, return it\n    if (allMatches.length === 1 || allMatches[0].score > allMatches[1].score + 20) {\n      return allMatches[0].projectName;\n    }\n\n    // If multiple matches with similar scores, return all for disambiguation\n    const topScore = allMatches[0].score;\n    const ambiguousMatches = allMatches\n      .filter(m => m.score >= topScore - 10)\n      .map(m => m.projectName);\n\n    // Remove duplicates\n    const uniqueMatches = Array.from(new Set(ambiguousMatches));\n\n    if (uniqueMatches.length === 1) {\n      return uniqueMatches[0];\n    }\n\n    return uniqueMatches;\n  }\n\n  /**\n   * Extract potential project name fragments from query\n   * Looks for location names, wind farm references, etc.\n   */\n  private extractProjectNameFragments(query: string): string[] {\n    const fragments: string[] = [];\n\n    // Skip extraction if query contains coordinates (lat/lon pattern)\n    // This prevents \"analyze terrain at 32.7767, -96.797\" from matching existing projects\n    const hasCoordinates = /\\b\\d+\\.\\d+\\s*,\\s*-?\\d+\\.\\d+\\b/.test(query);\n    if (hasCoordinates) {\n      console.log('[ProjectResolver] Query contains coordinates, skipping fragment extraction');\n      return fragments;\n    }\n\n    // Pattern 1: Location names (2-3 words before \"wind farm\")\n    const windFarmPattern = /([a-z\\-]+(?:\\s+[a-z\\-]+){0,2})\\s+wind\\s+farm/gi;\n    let match;\n    while ((match = windFarmPattern.exec(query)) !== null) {\n      fragments.push(this.normalizeProjectName(match[1]));\n    }\n\n    // Pattern 2: Location names after \"in\" or \"at\" (but NOT coordinates)\n    const locationPattern = /(?:in|at)\\s+([a-z\\-]+(?:\\s+[a-z\\-]+){0,2})/gi;\n    while ((match = locationPattern.exec(query)) !== null) {\n      const fragment = match[1];\n      // Skip if it looks like a number\n      if (!/^\\d/.test(fragment)) {\n        fragments.push(this.normalizeProjectName(fragment));\n      }\n    }\n\n    // Pattern 3: Capitalized words (potential location names)\n    const capitalizedPattern = /\\b([A-Z][a-z]+(?:\\s+[A-Z][a-z]+){0,2})\\b/g;\n    while ((match = capitalizedPattern.exec(query)) !== null) {\n      fragments.push(this.normalizeProjectName(match[1]));\n    }\n\n    // Pattern 4: Hyphenated names (already normalized project names)\n    const hyphenatedPattern = /\\b([a-z]+(?:\\-[a-z]+)+)\\b/g;\n    while ((match = hyphenatedPattern.exec(query)) !== null) {\n      fragments.push(match[1]);\n    }\n\n    return Array.from(new Set(fragments)); // Remove duplicates\n  }\n\n  /**\n   * Find projects matching a name (exact or partial)\n   */\n  private async findMatchingProjects(name: string): Promise<string[]> {\n    const projects = await this.getProjectList();\n    const normalizedName = name.toLowerCase();\n\n    return projects\n      .filter(p => p.project_name.toLowerCase() === normalizedName)\n      .map(p => p.project_name);\n  }\n\n  /**\n   * Get cached project list or fetch from S3\n   */\n  private async getProjectList(): Promise<ProjectData[]> {\n    const now = Date.now();\n\n    // Check cache\n    if (this.projectListCache && (now - this.projectListCache.timestamp) < this.CACHE_TTL_MS) {\n      console.log('[ProjectResolver] Using cached project list');\n      return this.projectListCache.projects;\n    }\n\n    // Fetch from S3\n    console.log('[ProjectResolver] Fetching project list from S3');\n    const projects = await this.projectStore.list();\n    \n    // Update cache\n    this.projectListCache = {\n      projects,\n      timestamp: now\n    };\n\n    return projects;\n  }\n\n  /**\n   * Normalize project name to kebab-case\n   */\n  private normalizeProjectName(name: string): string {\n    return name\n      .toLowerCase()\n      .trim()\n      .replace(/[^a-z0-9\\s\\-]/g, '') // Remove special chars except spaces and hyphens\n      .replace(/\\s+/g, '-') // Replace spaces with hyphens\n      .replace(/\\-+/g, '-') // Replace multiple hyphens with single\n      .replace(/^\\-|\\-$/g, ''); // Remove leading/trailing hyphens\n  }\n\n  /**\n   * Calculate Levenshtein distance between two strings\n   * Used for fuzzy matching\n   */\n  private levenshteinDistance(str1: string, str2: string): number {\n    const len1 = str1.length;\n    const len2 = str2.length;\n    const matrix: number[][] = [];\n\n    // Initialize matrix\n    for (let i = 0; i <= len1; i++) {\n      matrix[i] = [i];\n    }\n    for (let j = 0; j <= len2; j++) {\n      matrix[0][j] = j;\n    }\n\n    // Fill matrix\n    for (let i = 1; i <= len1; i++) {\n      for (let j = 1; j <= len2; j++) {\n        const cost = str1[i - 1] === str2[j - 1] ? 0 : 1;\n        matrix[i][j] = Math.min(\n          matrix[i - 1][j] + 1,      // deletion\n          matrix[i][j - 1] + 1,      // insertion\n          matrix[i - 1][j - 1] + cost // substitution\n        );\n      }\n    }\n\n    return matrix[len1][len2];\n  }\n\n  /**\n   * Clear project list cache (useful after creating/deleting projects)\n   */\n  clearCache(): void {\n    this.projectListCache = null;\n  }\n}\n", "/**\n * Error Message Templates for Renewable Energy Workflows\n * \n * Provides user-friendly error messages with context-specific guidance\n * for missing project data and workflow issues.\n */\n\nexport interface ErrorContext {\n  projectId?: string;\n  projectName?: string;\n  missingData: string;\n  requiredOperation: string;\n  hasProjectContext?: boolean;\n}\n\nexport interface ErrorMessage {\n  message: string;\n  suggestion: string;\n  nextSteps: string[];\n  errorCategory: 'MISSING_PROJECT_DATA' | 'PARAMETER_ERROR' | 'AMBIGUOUS_REFERENCE';\n}\n\n/**\n * Error message templates for missing project data\n */\nexport class ErrorMessageTemplates {\n  \n  /**\n   * Generate error message for missing coordinates\n   * Used when layout optimization is attempted without terrain analysis\n   */\n  static missingCoordinates(context: ErrorContext): ErrorMessage {\n    const projectRef = context.projectName || context.projectId || 'this project';\n    \n    return {\n      message: `No coordinates found for ${projectRef}. Coordinates are required to optimize the turbine layout.`,\n      suggestion: `Run terrain analysis first to establish project coordinates, or provide explicit latitude/longitude parameters.`,\n      nextSteps: [\n        `Analyze terrain: \"analyze terrain at [latitude], [longitude]\"`,\n        `Or provide coordinates: \"optimize layout at [latitude], [longitude] with [N] turbines\"`,\n        context.projectName ? `View project status: \"show project ${context.projectName}\"` : ''\n      ].filter(Boolean),\n      errorCategory: 'MISSING_PROJECT_DATA'\n    };\n  }\n\n  /**\n   * Generate error message for missing layout\n   * Used when wake simulation is attempted without layout optimization\n   */\n  static missingLayout(context: ErrorContext): ErrorMessage {\n    const projectRef = context.projectName || context.projectId || 'this project';\n    \n    return {\n      message: `No turbine layout found for ${projectRef}. A layout is required to run wake simulation.`,\n      suggestion: `Run layout optimization first to establish turbine positions, or provide explicit layout data.`,\n      nextSteps: [\n        `Optimize layout: \"optimize layout for ${projectRef}\"`,\n        `Or provide layout: \"run wake simulation with layout [layout_data]\"`,\n        context.projectName ? `View project status: \"show project ${context.projectName}\"` : ''\n      ].filter(Boolean),\n      errorCategory: 'MISSING_PROJECT_DATA'\n    };\n  }\n\n  /**\n   * Generate error message for missing analysis results\n   * Used when report generation is attempted without complete analysis\n   */\n  static missingAnalysisResults(context: ErrorContext): ErrorMessage {\n    const projectRef = context.projectName || context.projectId || 'this project';\n    \n    return {\n      message: `No analysis results found for ${projectRef}. Complete analysis data is required to generate a report.`,\n      suggestion: `Complete the full analysis workflow: terrain analysis \u2192 layout optimization \u2192 wake simulation \u2192 report generation.`,\n      nextSteps: [\n        `Start with terrain: \"analyze terrain at [latitude], [longitude]\"`,\n        `Then optimize layout: \"optimize layout for ${projectRef}\"`,\n        `Run simulation: \"run wake simulation for ${projectRef}\"`,\n        `Finally generate report: \"generate report for ${projectRef}\"`\n      ],\n      errorCategory: 'MISSING_PROJECT_DATA'\n    };\n  }\n\n  /**\n   * Generate error message for missing terrain results\n   * Used when layout optimization needs terrain data\n   */\n  static missingTerrainResults(context: ErrorContext): ErrorMessage {\n    const projectRef = context.projectName || context.projectId || 'this project';\n    \n    return {\n      message: `No terrain analysis found for ${projectRef}. Terrain data helps optimize turbine placement.`,\n      suggestion: `Run terrain analysis first to identify suitable areas and constraints.`,\n      nextSteps: [\n        `Analyze terrain: \"analyze terrain at [latitude], [longitude]\"`,\n        `Then optimize layout: \"optimize layout for ${projectRef}\"`,\n        context.projectName ? `View project status: \"show project ${context.projectName}\"` : ''\n      ].filter(Boolean),\n      errorCategory: 'MISSING_PROJECT_DATA'\n    };\n  }\n\n  /**\n   * Generate error message for missing simulation results\n   * Used when report generation needs performance data\n   */\n  static missingSimulationResults(context: ErrorContext): ErrorMessage {\n    const projectRef = context.projectName || context.projectId || 'this project';\n    \n    return {\n      message: `No wake simulation results found for ${projectRef}. Performance data is required for the report.`,\n      suggestion: `Run wake simulation first to calculate energy production and wake losses.`,\n      nextSteps: [\n        `Run simulation: \"run wake simulation for ${projectRef}\"`,\n        `Then generate report: \"generate report for ${projectRef}\"`,\n        context.projectName ? `View project status: \"show project ${context.projectName}\"` : ''\n      ].filter(Boolean),\n      errorCategory: 'MISSING_PROJECT_DATA'\n    };\n  }\n\n  /**\n   * Generate comprehensive error message based on missing data type\n   */\n  static generateErrorMessage(missingData: string, context: ErrorContext): ErrorMessage {\n    switch (missingData) {\n      case 'coordinates':\n        return this.missingCoordinates(context);\n      \n      case 'layout':\n      case 'layout_results':\n        return this.missingLayout(context);\n      \n      case 'terrain_results':\n        return this.missingTerrainResults(context);\n      \n      case 'simulation_results':\n        return this.missingSimulationResults(context);\n      \n      case 'analysis_results':\n      case 'all':\n        return this.missingAnalysisResults(context);\n      \n      default:\n        // Generic missing data error\n        const projectRef = context.projectName || context.projectId || 'this project';\n        return {\n          message: `Missing required data (${missingData}) for ${projectRef}.`,\n          suggestion: `Complete the previous steps in the workflow before proceeding.`,\n          nextSteps: [\n            `Check project status: \"show project ${projectRef}\"`,\n            `View all projects: \"list my renewable projects\"`\n          ],\n          errorCategory: 'MISSING_PROJECT_DATA'\n        };\n    }\n  }\n\n  /**\n   * Format error message for API response\n   */\n  static formatForResponse(errorMessage: ErrorMessage, context: ErrorContext): any {\n    return {\n      success: false,\n      error: errorMessage.message,\n      errorCategory: errorMessage.errorCategory,\n      details: {\n        projectId: context.projectId,\n        projectName: context.projectName,\n        missingData: context.missingData,\n        requiredOperation: context.requiredOperation,\n        hasProjectContext: context.hasProjectContext,\n        suggestion: errorMessage.suggestion,\n        nextSteps: errorMessage.nextSteps\n      }\n    };\n  }\n\n  /**\n   * Format error message for user display (conversational)\n   */\n  static formatForUser(errorMessage: ErrorMessage, context: ErrorContext): string {\n    const projectRef = context.projectName || context.projectId || 'this project';\n    \n    let message = `${errorMessage.message}\\n\\n`;\n    message += `\uD83D\uDCA1 ${errorMessage.suggestion}\\n\\n`;\n    message += `**Next steps:**\\n`;\n    errorMessage.nextSteps.forEach((step, index) => {\n      message += `${index + 1}. ${step}\\n`;\n    });\n    \n    return message;\n  }\n\n  /**\n   * Generate error message for ambiguous project references\n   * Used when multiple projects match a partial name\n   */\n  static ambiguousProjectReference(matches: string[], query: string): ErrorMessage {\n    const matchList = matches.map((name, index) => `${index + 1}. ${name}`).join('\\n');\n    \n    return {\n      message: `Multiple projects match your query \"${query}\". Please specify which project you mean.`,\n      suggestion: `Use a more specific project name or reference the full project name.`,\n      nextSteps: [\n        `Matching projects:\\n${matchList}`,\n        `Specify project: \"optimize layout for [specific-project-name]\"`,\n        `View all projects: \"list my renewable projects\"`\n      ],\n      errorCategory: 'AMBIGUOUS_REFERENCE'\n    };\n  }\n\n  /**\n   * Format ambiguous reference error for API response\n   */\n  static formatAmbiguousReferenceForResponse(matches: string[], query: string): any {\n    const errorMessage = this.ambiguousProjectReference(matches, query);\n    \n    return {\n      success: false,\n      error: errorMessage.message,\n      errorCategory: errorMessage.errorCategory,\n      details: {\n        query,\n        matches,\n        matchCount: matches.length,\n        suggestion: errorMessage.suggestion,\n        nextSteps: errorMessage.nextSteps\n      }\n    };\n  }\n\n  /**\n   * Format ambiguous reference error for user display\n   */\n  static formatAmbiguousReferenceForUser(matches: string[], query: string): string {\n    let message = `I found ${matches.length} projects that match \"${query}\":\\n\\n`;\n    \n    matches.forEach((name, index) => {\n      message += `${index + 1}. **${name}**\\n`;\n    });\n    \n    message += `\\n\uD83D\uDCA1 Please specify which project you mean by using the full project name.\\n\\n`;\n    message += `**Examples:**\\n`;\n    message += `- \"optimize layout for ${matches[0]}\"\\n`;\n    message += `- \"run wake simulation for ${matches[1] || matches[0]}\"\\n`;\n    message += `- \"show project ${matches[0]}\"\\n`;\n    \n    return message;\n  }\n\n  /**\n   * Format missing context error with intent-specific guidance\n   * Used when validation fails due to missing project context\n   */\n  static formatMissingContextError(\n    intentType: string,\n    missingParams: string[],\n    activeProject?: string\n  ): string {\n    const suggestions: Record<string, string> = {\n      layout_optimization: \n        \"To optimize layout, either:\\n\" +\n        \"\u2022 Provide coordinates: 'optimize layout at 35.067482, -101.395466'\\n\" +\n        \"\u2022 Run terrain analysis first: 'analyze terrain at 35.067482, -101.395466'\",\n      \n      wake_simulation:\n        \"To run wake simulation, first:\\n\" +\n        \"\u2022 Create a layout: 'optimize layout'\\n\" +\n        \"\u2022 Or specify a project: 'run wake simulation for project-name'\",\n      \n      report_generation:\n        \"To generate a report, first:\\n\" +\n        \"\u2022 Complete terrain analysis and layout optimization\\n\" +\n        \"\u2022 Or specify a project: 'generate report for project-name'\"\n    };\n    \n    let message = `Missing required information: ${missingParams.join(', ')}.\\n\\n`;\n    message += suggestions[intentType] || 'Please provide the required parameters.';\n    \n    if (activeProject) {\n      message += `\\n\\nActive project: ${activeProject}`;\n    }\n    \n    return message;\n  }\n\n  /**\n   * Generate workflow status message\n   * Shows what's complete and what's needed\n   */\n  static generateWorkflowStatus(projectName: string, projectData: any): string {\n    const hasTerrain = !!projectData?.terrain_results;\n    const hasLayout = !!projectData?.layout_results;\n    const hasSimulation = !!projectData?.simulation_results;\n    const hasReport = !!projectData?.report_results;\n    \n    let status = `**Project Status: ${projectName}**\\n\\n`;\n    status += `${hasTerrain ? '\u2705' : '\u2B1C'} Terrain Analysis\\n`;\n    status += `${hasLayout ? '\u2705' : '\u2B1C'} Layout Optimization\\n`;\n    status += `${hasSimulation ? '\u2705' : '\u2B1C'} Wake Simulation\\n`;\n    status += `${hasReport ? '\u2705' : '\u2B1C'} Report Generation\\n\\n`;\n    \n    // Determine next step\n    if (!hasTerrain) {\n      status += `**Next:** Analyze terrain to identify suitable areas\\n`;\n      status += `Try: \"analyze terrain at [latitude], [longitude]\"`;\n    } else if (!hasLayout) {\n      status += `**Next:** Optimize turbine layout\\n`;\n      status += `Try: \"optimize layout for ${projectName}\"`;\n    } else if (!hasSimulation) {\n      status += `**Next:** Run wake simulation\\n`;\n      status += `Try: \"run wake simulation for ${projectName}\"`;\n    } else if (!hasReport) {\n      status += `**Next:** Generate comprehensive report\\n`;\n      status += `Try: \"generate report for ${projectName}\"`;\n    } else {\n      status += `**Status:** All analysis complete! \u2728\\n`;\n      status += `View report: \"show report for ${projectName}\"`;\n    }\n    \n    return status;\n  }\n}\n\n/**\n * Renewable-specific error message templates\n * Provides actionable error messages with CTA buttons for workflow issues\n */\nexport interface RenewableErrorTemplate {\n  title: string;\n  message: string;\n  action?: string;\n  nextSteps?: string[];\n}\n\nexport const RENEWABLE_ERROR_MESSAGES = {\n  /**\n   * Layout data not found - wake simulation requires layout\n   */\n  LAYOUT_MISSING: {\n    title: \"Layout Data Not Found\",\n    message: \"Please run layout optimization before wake simulation.\",\n    action: \"Optimize Turbine Layout\",\n    nextSteps: [\n      \"Run layout optimization first\",\n      \"Or provide explicit layout data in your query\"\n    ]\n  },\n  \n  /**\n   * Terrain data not found - layout optimization needs terrain\n   */\n  TERRAIN_MISSING: {\n    title: \"Terrain Data Not Found\",\n    message: \"Please run terrain analysis before layout optimization.\",\n    action: \"Analyze Terrain\",\n    nextSteps: [\n      \"Run terrain analysis first to identify suitable areas\",\n      \"Or provide explicit coordinates in your query\"\n    ]\n  },\n  \n  /**\n   * Lambda timeout - analysis taking too long\n   */\n  LAMBDA_TIMEOUT: {\n    title: \"Analysis Taking Longer Than Expected\",\n    message: \"The analysis is still processing. Please try again in a moment.\",\n    action: \"Retry\",\n    nextSteps: [\n      \"Wait a moment and try your query again\",\n      \"The system may be under heavy load\",\n      \"If this persists, try a smaller analysis area\"\n    ]\n  },\n  \n  /**\n   * S3 retrieval failed - cannot access stored data\n   */\n  S3_RETRIEVAL_FAILED: {\n    title: \"Unable to Retrieve Analysis Data\",\n    message: \"There was an error accessing your analysis results. Please contact support if this persists.\",\n    nextSteps: [\n      \"Try your query again\",\n      \"If the error persists, the data may be corrupted\",\n      \"Contact support with your project name\"\n    ]\n  },\n  \n  /**\n   * Missing required parameters\n   */\n  PARAMETER_MISSING: (params: string[]): RenewableErrorTemplate => ({\n    title: \"Missing Required Parameters\",\n    message: `The following parameters are required: ${params.join(\", \")}`,\n    nextSteps: [\n      `Please provide: ${params.join(\", \")}`,\n      \"Example: 'analyze terrain at 35.067482, -101.395466'\",\n      \"Or reference an existing project by name\"\n    ]\n  }),\n  \n  /**\n   * Analysis results missing - report generation needs complete workflow\n   */\n  ANALYSIS_RESULTS_MISSING: {\n    title: \"Incomplete Analysis Data\",\n    message: \"Complete analysis data is required to generate a report.\",\n    action: \"Complete Workflow\",\n    nextSteps: [\n      \"Complete the full workflow:\",\n      \"1. Terrain analysis\",\n      \"2. Layout optimization\",\n      \"3. Wake simulation\",\n      \"4. Report generation\"\n    ]\n  },\n  \n  /**\n   * Project not found\n   */\n  PROJECT_NOT_FOUND: (projectName: string): RenewableErrorTemplate => ({\n    title: \"Project Not Found\",\n    message: `Could not find project \"${projectName}\".`,\n    action: \"List Projects\",\n    nextSteps: [\n      \"Check the project name spelling\",\n      \"List all projects: 'list my renewable projects'\",\n      \"Or start a new analysis with terrain analysis\"\n    ]\n  }),\n  \n  /**\n   * Lambda invocation failed\n   */\n  LAMBDA_INVOCATION_FAILED: (toolType: string, error: string): RenewableErrorTemplate => ({\n    title: \"Analysis Tool Error\",\n    message: `The ${toolType} tool encountered an error: ${error}`,\n    action: \"Retry\",\n    nextSteps: [\n      \"Try your query again\",\n      \"If the error persists, check your parameters\",\n      \"Contact support if the issue continues\"\n    ]\n  }),\n  \n  /**\n   * Deployment issue - Lambda not configured\n   */\n  DEPLOYMENT_ISSUE: (toolType: string): RenewableErrorTemplate => ({\n    title: \"Tool Not Available\",\n    message: `The ${toolType} tool is not currently deployed.`,\n    nextSteps: [\n      \"The system administrator needs to deploy the tool\",\n      \"Run: npx ampx sandbox\",\n      \"Contact support if you need immediate assistance\"\n    ]\n  })\n};\n\n/**\n * Helper functions for renewable error messages\n */\nexport class RenewableErrorFormatter {\n  /**\n   * Format renewable error for user display\n   */\n  static formatForUser(template: RenewableErrorTemplate, projectName?: string): string {\n    let message = `**${template.title}**\\n\\n`;\n    message += `${template.message}\\n\\n`;\n    \n    if (template.nextSteps && template.nextSteps.length > 0) {\n      message += `**What to do next:**\\n`;\n      template.nextSteps.forEach((step, index) => {\n        message += `${index + 1}. ${step}\\n`;\n      });\n    }\n    \n    if (projectName) {\n      message += `\\n**Current project:** ${projectName}\\n`;\n    }\n    \n    return message;\n  }\n  \n  /**\n   * Format renewable error for API response\n   */\n  static formatForResponse(\n    template: RenewableErrorTemplate,\n    context: {\n      projectName?: string;\n      projectId?: string;\n      intentType?: string;\n      error?: any;\n    }\n  ): any {\n    return {\n      success: false,\n      error: template.message,\n      errorTitle: template.title,\n      errorCategory: 'RENEWABLE_WORKFLOW_ERROR',\n      details: {\n        projectName: context.projectName,\n        projectId: context.projectId,\n        intentType: context.intentType,\n        action: template.action,\n        nextSteps: template.nextSteps,\n        originalError: context.error instanceof Error ? context.error.message : context.error\n      }\n    };\n  }\n  \n  /**\n   * Detect error type from error message or exception\n   */\n  static detectErrorType(error: any, intentType?: string): keyof typeof RENEWABLE_ERROR_MESSAGES | null {\n    const errorMessage = error instanceof Error ? error.message : String(error);\n    const errorLower = errorMessage.toLowerCase();\n    \n    // Check for specific error patterns (order matters - most specific first)\n    if (errorLower.includes('layout') && errorLower.includes('not found')) {\n      return 'LAYOUT_MISSING';\n    }\n    \n    if (errorLower.includes('terrain') && errorLower.includes('not found')) {\n      return 'TERRAIN_MISSING';\n    }\n    \n    if (errorLower.includes('timeout') || errorLower.includes('timed out')) {\n      return 'LAMBDA_TIMEOUT';\n    }\n    \n    if (errorLower.includes('s3') || errorLower.includes('bucket') || errorLower.includes('key')) {\n      return 'S3_RETRIEVAL_FAILED';\n    }\n    \n    if (errorLower.includes('project') && errorLower.includes('not found')) {\n      return 'PROJECT_NOT_FOUND';\n    }\n    \n    // Check deployment issues before generic Lambda errors\n    if (errorLower.includes('not configured') || \n        errorLower.includes('not deployed') ||\n        errorLower.includes('function not found')) {\n      return 'DEPLOYMENT_ISSUE';\n    }\n    \n    // Generic Lambda invocation errors (check last)\n    if (errorLower.includes('lambda') || errorLower.includes('invocation')) {\n      return 'LAMBDA_INVOCATION_FAILED';\n    }\n    \n    return null;\n  }\n  \n  /**\n   * Generate error message with context\n   */\n  static generateErrorMessage(\n    error: any,\n    context: {\n      intentType?: string;\n      projectName?: string;\n      projectId?: string;\n      missingParams?: string[];\n    }\n  ): { template: RenewableErrorTemplate; formatted: string } {\n    // Detect error type\n    const errorType = this.detectErrorType(error, context.intentType);\n    \n    let template: RenewableErrorTemplate;\n    \n    if (errorType && errorType in RENEWABLE_ERROR_MESSAGES) {\n      const templateOrFunction = RENEWABLE_ERROR_MESSAGES[errorType];\n      \n      // Handle function templates\n      if (typeof templateOrFunction === 'function') {\n        if (errorType === 'PARAMETER_MISSING' && context.missingParams) {\n          const missingParams = Array.isArray(context.missingParams) ? context.missingParams : [context.missingParams];\n          template = (templateOrFunction as (params: string[]) => RenewableErrorTemplate)(missingParams);\n        } else if (errorType === 'PROJECT_NOT_FOUND' && context.projectName) {\n          template = (RENEWABLE_ERROR_MESSAGES.PROJECT_NOT_FOUND as any)(context.projectName);\n        } else if (errorType === 'LAMBDA_INVOCATION_FAILED' && context.intentType) {\n          const errorMessage = error instanceof Error ? error.message : String(error);\n          template = (RENEWABLE_ERROR_MESSAGES.LAMBDA_INVOCATION_FAILED as any)(context.intentType, errorMessage);\n        } else if (errorType === 'DEPLOYMENT_ISSUE' && context.intentType) {\n          template = (RENEWABLE_ERROR_MESSAGES.DEPLOYMENT_ISSUE as any)(context.intentType);\n        } else {\n          // Fallback for function templates without proper context\n          template = {\n            title: \"Error\",\n            message: error instanceof Error ? error.message : String(error),\n            nextSteps: [\"Please try again\", \"Contact support if the issue persists\"]\n          };\n        }\n      } else {\n        template = templateOrFunction;\n      }\n    } else {\n      // Generic error template\n      template = {\n        title: \"Unexpected Error\",\n        message: error instanceof Error ? error.message : String(error),\n        nextSteps: [\n          \"Please try your query again\",\n          \"If the error persists, contact support\",\n          \"Include your project name and the query you tried\"\n        ]\n      };\n    }\n    \n    const formatted = this.formatForUser(template, context.projectName);\n    \n    return { template, formatted };\n  }\n}\n", "/**\n * Action Button Types for Contextual Actions\n * \n * Defines the structure for action buttons that guide users to the next logical step\n * in their renewable energy workflow.\n */\n\nexport interface ActionButton {\n  /**\n   * Human-readable label for the button\n   * Examples: \"Optimize Turbine Layout\", \"Run Wake Simulation\"\n   */\n  label: string;\n  \n  /**\n   * Pre-filled query that will be sent when button is clicked\n   * Should include project name placeholder: {project_name}\n   */\n  query: string;\n  \n  /**\n   * Icon name from Cloudscape icon set\n   * Examples: \"layout\", \"simulation\", \"report\", \"dashboard\", \"add\", \"list\", \"info\", \"edit\", \"compare\"\n   */\n  icon: string;\n  \n  /**\n   * Whether this is the primary (recommended) action\n   * Primary actions are styled more prominently\n   */\n  primary?: boolean;\n}\n\n/**\n * Project status for displaying completion checklist\n */\nexport interface ProjectStatus {\n  terrain: boolean;\n  layout: boolean;\n  simulation: boolean;\n  report: boolean;\n}\n\n/**\n * Response message enhancements\n */\nexport interface ResponseEnhancement {\n  /**\n   * Project name to display in response\n   */\n  projectName?: string;\n  \n  /**\n   * Project status checklist\n   */\n  projectStatus?: ProjectStatus;\n  \n  /**\n   * Next step suggestion\n   */\n  nextStep?: string;\n  \n  /**\n   * Contextual action buttons\n   */\n  actions?: ActionButton[];\n}\n\n/**\n * Generate action buttons based on artifact type and project status\n * Enhanced to include dashboard access at every step\n */\nexport function generateActionButtons(\n  artifactType: string,\n  projectName?: string,\n  projectStatus?: ProjectStatus\n): ActionButton[] {\n  const actions: ActionButton[] = [];\n  \n  // Use project name in queries if available, otherwise use generic queries\n  const projectContext = projectName ? ` for ${projectName}` : '';\n  \n  switch (artifactType) {\n    case 'terrain_analysis':\n    case 'wind_farm_terrain_analysis':\n      // Primary next step: Layout optimization\n      actions.push({\n        label: 'Optimize Layout',\n        query: `optimize turbine layout${projectContext}`,\n        icon: 'settings',\n        primary: true\n      });\n      // Always accessible: Dashboard\n      actions.push({\n        label: 'View Dashboard',\n        query: projectName ? `show project dashboard for ${projectName}` : 'show project dashboard',\n        icon: 'status-info',\n        primary: false\n      });\n      break;\n      \n    case 'layout_optimization':\n    case 'wind_farm_layout':\n      // Primary next step: Wake simulation\n      actions.push({\n        label: 'Run Wake Simulation',\n        query: `run wake simulation${projectContext}`,\n        icon: 'refresh',\n        primary: true\n      });\n      // Always accessible: Dashboard\n      actions.push({\n        label: 'View Dashboard',\n        query: projectName ? `show project dashboard for ${projectName}` : 'show project dashboard',\n        icon: 'status-info',\n        primary: false\n      });\n      // Optional: Refine layout\n      actions.push({\n        label: 'Refine Layout',\n        query: `optimize turbine layout with different spacing${projectContext}`,\n        icon: 'settings',\n        primary: false\n      });\n      break;\n      \n    case 'wake_simulation':\n    case 'wind_rose_analysis':\n      // Primary next step: Generate report\n      actions.push({\n        label: 'Generate Report',\n        query: `generate comprehensive executive report${projectContext}`,\n        icon: 'file',\n        primary: true\n      });\n      // Always accessible: Dashboard\n      actions.push({\n        label: 'View Dashboard',\n        query: projectName ? `show project dashboard for ${projectName}` : 'show project dashboard',\n        icon: 'status-info',\n        primary: false\n      });\n      // Additional analysis options\n      actions.push({\n        label: 'Financial Analysis',\n        query: `perform financial analysis and ROI calculation${projectContext}`,\n        icon: 'calculator',\n        primary: false\n      });\n      actions.push({\n        label: 'Optimize Layout',\n        query: `optimize turbine layout to reduce wake losses${projectContext}`,\n        icon: 'settings',\n        primary: false\n      });\n      break;\n      \n    case 'report_generation':\n    case 'financial_analysis':\n      // Always accessible: Dashboard (primary after report)\n      actions.push({\n        label: 'View Dashboard',\n        query: projectName ? `show project dashboard for ${projectName}` : 'show project dashboard',\n        icon: 'status-info',\n        primary: true\n      });\n      actions.push({\n        label: 'Export Report',\n        query: `export project report as PDF${projectContext}`,\n        icon: 'download',\n        primary: false\n      });\n      break;\n      \n    default:\n      // Generic actions with dashboard access\n      actions.push({\n        label: 'View Dashboard',\n        query: projectName ? `show project dashboard for ${projectName}` : 'show project dashboard',\n        icon: 'status-info',\n        primary: true\n      });\n      actions.push({\n        label: 'View All Projects',\n        query: 'list my renewable projects',\n        icon: 'folder',\n        primary: false\n      });\n  }\n  \n  return actions;\n}\n\n/**\n * Generate next step suggestion based on project status\n */\nexport function generateNextStepSuggestion(projectStatus?: ProjectStatus): string | undefined {\n  if (!projectStatus) {\n    return undefined;\n  }\n  \n  if (!projectStatus.terrain) {\n    return 'Run terrain analysis to assess site suitability';\n  }\n  \n  if (!projectStatus.layout) {\n    return 'Optimize turbine layout to maximize energy production';\n  }\n  \n  if (!projectStatus.simulation) {\n    return 'Run wake simulation to analyze energy production and wake effects';\n  }\n  \n  if (!projectStatus.report) {\n    return 'Generate comprehensive report with all analysis results';\n  }\n  \n  return 'All analysis steps complete! Start a new project or compare scenarios.';\n}\n\n/**\n * Format project status as checklist string\n */\nexport function formatProjectStatusChecklist(projectStatus: ProjectStatus): string {\n  const checkmark = '\u2713';\n  const empty = '\u25CB';\n  \n  return `\nProject Status:\n  ${projectStatus.terrain ? checkmark : empty} Terrain Analysis\n  ${projectStatus.layout ? checkmark : empty} Layout Optimization\n  ${projectStatus.simulation ? checkmark : empty} Wake Simulation\n  ${projectStatus.report ? checkmark : empty} Report Generation\n`.trim();\n}\n", "/**\n * Project List Handler\n * \n * Handles queries for listing renewable energy projects and showing project details.\n * Provides formatted responses with project status, metrics, and timestamps.\n * \n * Requirements: 8.1, 8.3, 8.6\n */\n\nimport { ProjectStore, ProjectData } from './projectStore';\nimport { SessionContextManager } from './sessionContextManager';\n\nexport interface ProjectListResponse {\n  success: boolean;\n  message: string;\n  projects?: ProjectSummary[];\n  projectDetails?: ProjectDetails;\n  activeProject?: string;\n}\n\nexport interface ProjectSummary {\n  project_name: string;\n  status: ProjectStatus;\n  created_at: string;\n  updated_at: string;\n  coordinates?: {\n    latitude: number;\n    longitude: number;\n  };\n  metrics?: {\n    turbine_count?: number;\n    total_capacity_mw?: number;\n    annual_energy_gwh?: number;\n  };\n  isActive: boolean;\n}\n\nexport interface ProjectStatus {\n  terrain: boolean;\n  layout: boolean;\n  simulation: boolean;\n  report: boolean;\n  completionPercentage: number;\n}\n\nexport interface ProjectDetails {\n  project_name: string;\n  project_id: string;\n  status: ProjectStatus;\n  created_at: string;\n  updated_at: string;\n  coordinates?: {\n    latitude: number;\n    longitude: number;\n  };\n  terrain_results?: any;\n  layout_results?: any;\n  simulation_results?: any;\n  report_results?: any;\n  metadata?: {\n    turbine_count?: number;\n    total_capacity_mw?: number;\n    annual_energy_gwh?: number;\n  };\n}\n\nexport class ProjectListHandler {\n  private projectStore: ProjectStore;\n  private sessionContextManager: SessionContextManager;\n\n  constructor(bucketName?: string, sessionTableName?: string) {\n    this.projectStore = new ProjectStore(bucketName);\n    this.sessionContextManager = new SessionContextManager(sessionTableName);\n  }\n\n  /**\n   * Handle \"list my renewable projects\" query\n   * Returns all projects with status, timestamps, and active marker\n   */\n  async listProjects(sessionId?: string): Promise<ProjectListResponse> {\n    try {\n      console.log('[ProjectListHandler] Listing all projects');\n      \n      // Get all projects from S3\n      const allProjects = await this.projectStore.list();\n      \n      if (allProjects.length === 0) {\n        return {\n          success: true,\n          message: 'You don\\'t have any renewable energy projects yet. Start by analyzing terrain at a location:\\n\\n\"analyze terrain at 35.067482, -101.395466\"',\n          projects: []\n        };\n      }\n\n      // Get active project from session\n      let activeProjectName: string | undefined;\n      if (sessionId) {\n        try {\n          activeProjectName = await this.sessionContextManager.getActiveProject(sessionId);\n        } catch (error) {\n          console.warn('[ProjectListHandler] Could not get active project:', error);\n        }\n      }\n\n      // Convert to project summaries\n      const projectSummaries = allProjects.map(project => \n        this.createProjectSummary(project, project.project_name === activeProjectName)\n      );\n\n      // Sort by updated_at (most recent first)\n      projectSummaries.sort((a, b) => \n        new Date(b.updated_at).getTime() - new Date(a.updated_at).getTime()\n      );\n\n      // Format response message\n      const message = this.formatProjectListMessage(projectSummaries, activeProjectName);\n\n      console.log(`[ProjectListHandler] Found ${projectSummaries.length} projects`);\n\n      return {\n        success: true,\n        message,\n        projects: projectSummaries,\n        activeProject: activeProjectName\n      };\n\n    } catch (error) {\n      console.error('[ProjectListHandler] Error listing projects:', error);\n      return {\n        success: false,\n        message: 'Failed to list projects. Please try again.',\n        projects: []\n      };\n    }\n  }\n\n  /**\n   * Handle \"show project {name}\" query\n   * Returns complete project data with all analysis results\n   */\n  async showProjectDetails(projectName: string): Promise<ProjectListResponse> {\n    try {\n      console.log(`[ProjectListHandler] Showing details for project: ${projectName}`);\n\n      // Load project data\n      const projectData = await this.projectStore.load(projectName);\n\n      if (!projectData) {\n        return {\n          success: false,\n          message: `Project \"${projectName}\" not found. Use \"list my renewable projects\" to see available projects.`\n        };\n      }\n\n      // Create detailed project info\n      const projectDetails = this.createProjectDetails(projectData);\n\n      // Format response message\n      const message = this.formatProjectDetailsMessage(projectDetails);\n\n      console.log(`[ProjectListHandler] Retrieved details for project: ${projectName}`);\n\n      return {\n        success: true,\n        message,\n        projectDetails\n      };\n\n    } catch (error) {\n      console.error(`[ProjectListHandler] Error showing project details for ${projectName}:`, error);\n      return {\n        success: false,\n        message: `Failed to load project \"${projectName}\". Please try again.`\n      };\n    }\n  }\n\n  /**\n   * Create project summary from project data\n   */\n  private createProjectSummary(project: ProjectData, isActive: boolean): ProjectSummary {\n    const status = this.calculateProjectStatus(project);\n\n    return {\n      project_name: project.project_name,\n      status,\n      created_at: project.created_at,\n      updated_at: project.updated_at,\n      coordinates: project.coordinates,\n      metrics: project.metadata,\n      isActive\n    };\n  }\n\n  /**\n   * Create detailed project info from project data\n   */\n  private createProjectDetails(project: ProjectData): ProjectDetails {\n    const status = this.calculateProjectStatus(project);\n\n    return {\n      project_name: project.project_name,\n      project_id: project.project_id,\n      status,\n      created_at: project.created_at,\n      updated_at: project.updated_at,\n      coordinates: project.coordinates,\n      terrain_results: project.terrain_results,\n      layout_results: project.layout_results,\n      simulation_results: project.simulation_results,\n      report_results: project.report_results,\n      metadata: project.metadata\n    };\n  }\n\n  /**\n   * Calculate project completion status\n   */\n  private calculateProjectStatus(project: ProjectData): ProjectStatus {\n    const terrain = !!project.terrain_results;\n    const layout = !!project.layout_results;\n    const simulation = !!project.simulation_results;\n    const report = !!project.report_results;\n\n    const completed = [terrain, layout, simulation, report].filter(Boolean).length;\n    const completionPercentage = Math.round((completed / 4) * 100);\n\n    return {\n      terrain,\n      layout,\n      simulation,\n      report,\n      completionPercentage\n    };\n  }\n\n  /**\n   * Format project list message for user\n   */\n  private formatProjectListMessage(projects: ProjectSummary[], activeProject?: string): string {\n    const lines: string[] = [];\n\n    lines.push('# Your Renewable Energy Projects\\n');\n\n    for (const project of projects) {\n      const marker = project.isActive ? '\u2192 ' : '  ';\n      const activeLabel = project.isActive ? ' (active)' : '';\n      \n      lines.push(`${marker}**${project.project_name}**${activeLabel}`);\n      \n      // Status indicators\n      const statusLine = [\n        project.status.terrain ? '\u2713 Terrain' : '\u2717 Terrain',\n        project.status.layout ? '\u2713 Layout' : '\u2717 Layout',\n        project.status.simulation ? '\u2713 Simulation' : '\u2717 Simulation',\n        project.status.report ? '\u2713 Report' : '\u2717 Report'\n      ].join(' | ');\n      lines.push(`  ${statusLine}`);\n\n      // Completion percentage\n      lines.push(`  Progress: ${project.status.completionPercentage}%`);\n\n      // Coordinates\n      if (project.coordinates) {\n        lines.push(`  Location: ${project.coordinates.latitude.toFixed(6)}, ${project.coordinates.longitude.toFixed(6)}`);\n      }\n\n      // Metrics\n      if (project.metrics) {\n        const metricParts: string[] = [];\n        if (project.metrics.turbine_count) {\n          metricParts.push(`${project.metrics.turbine_count} turbines`);\n        }\n        if (project.metrics.total_capacity_mw) {\n          metricParts.push(`${project.metrics.total_capacity_mw} MW`);\n        }\n        if (project.metrics.annual_energy_gwh) {\n          metricParts.push(`${project.metrics.annual_energy_gwh.toFixed(1)} GWh/year`);\n        }\n        if (metricParts.length > 0) {\n          lines.push(`  Metrics: ${metricParts.join(', ')}`);\n        }\n      }\n\n      // Timestamps\n      const createdDate = this.formatTimestamp(project.created_at);\n      const updatedDate = this.formatTimestamp(project.updated_at);\n      lines.push(`  Created: ${createdDate} | Updated: ${updatedDate}`);\n\n      lines.push(''); // Empty line between projects\n    }\n\n    lines.push('\\n**Next Steps:**');\n    if (activeProject) {\n      const activeProj = projects.find(p => p.project_name === activeProject);\n      if (activeProj) {\n        const nextStep = this.getNextStep(activeProj.status);\n        lines.push(`- ${nextStep} for ${activeProject}`);\n      }\n    } else {\n      lines.push('- Select a project to continue: \"show project {name}\"');\n    }\n    lines.push('- Start a new project: \"analyze terrain at {coordinates}\"');\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Format project details message for user\n   */\n  private formatProjectDetailsMessage(details: ProjectDetails): string {\n    const lines: string[] = [];\n\n    lines.push(`# Project: ${details.project_name}\\n`);\n\n    // Status section\n    lines.push('## Status');\n    const statusLine = [\n      details.status.terrain ? '\u2713 Terrain Analysis' : '\u2717 Terrain Analysis',\n      details.status.layout ? '\u2713 Layout Optimization' : '\u2717 Layout Optimization',\n      details.status.simulation ? '\u2713 Wake Simulation' : '\u2717 Wake Simulation',\n      details.status.report ? '\u2713 Report Generation' : '\u2717 Report Generation'\n    ].join('\\n');\n    lines.push(statusLine);\n    lines.push(`\\n**Completion:** ${details.status.completionPercentage}%\\n`);\n\n    // Location section\n    if (details.coordinates) {\n      lines.push('## Location');\n      lines.push(`Latitude: ${details.coordinates.latitude.toFixed(6)}`);\n      lines.push(`Longitude: ${details.coordinates.longitude.toFixed(6)}\\n`);\n    }\n\n    // Metrics section\n    if (details.metadata) {\n      lines.push('## Project Metrics');\n      if (details.metadata.turbine_count) {\n        lines.push(`Turbines: ${details.metadata.turbine_count}`);\n      }\n      if (details.metadata.total_capacity_mw) {\n        lines.push(`Total Capacity: ${details.metadata.total_capacity_mw} MW`);\n      }\n      if (details.metadata.annual_energy_gwh) {\n        lines.push(`Annual Energy Production: ${details.metadata.annual_energy_gwh.toFixed(2)} GWh`);\n      }\n      lines.push('');\n    }\n\n    // Analysis results summary\n    lines.push('## Analysis Results\\n');\n\n    if (details.terrain_results) {\n      lines.push('### Terrain Analysis \u2713');\n      lines.push('Terrain and site constraints have been analyzed.');\n      lines.push('');\n    }\n\n    if (details.layout_results) {\n      lines.push('### Layout Optimization \u2713');\n      if (details.metadata?.turbine_count) {\n        lines.push(`Optimized layout with ${details.metadata.turbine_count} turbines.`);\n      } else {\n        lines.push('Turbine layout has been optimized.');\n      }\n      lines.push('');\n    }\n\n    if (details.simulation_results) {\n      lines.push('### Wake Simulation \u2713');\n      if (details.metadata?.annual_energy_gwh) {\n        lines.push(`Estimated annual energy production: ${details.metadata.annual_energy_gwh.toFixed(2)} GWh`);\n      } else {\n        lines.push('Wake effects and energy production have been simulated.');\n      }\n      lines.push('');\n    }\n\n    if (details.report_results) {\n      lines.push('### Report Generation \u2713');\n      lines.push('Comprehensive project report has been generated.');\n      lines.push('');\n    }\n\n    // Timestamps\n    lines.push('## Timeline');\n    lines.push(`Created: ${this.formatTimestamp(details.created_at)}`);\n    lines.push(`Last Updated: ${this.formatTimestamp(details.updated_at)}\\n`);\n\n    // Next steps\n    lines.push('## Next Steps');\n    const nextStep = this.getNextStep(details.status);\n    lines.push(`- ${nextStep}`);\n\n    return lines.join('\\n');\n  }\n\n  /**\n   * Get next step suggestion based on project status\n   */\n  private getNextStep(status: ProjectStatus): string {\n    if (!status.terrain) {\n      return 'Run terrain analysis';\n    } else if (!status.layout) {\n      return 'Optimize turbine layout';\n    } else if (!status.simulation) {\n      return 'Run wake simulation';\n    } else if (!status.report) {\n      return 'Generate comprehensive report';\n    } else {\n      return 'Project complete! Start a new project or refine this one';\n    }\n  }\n\n  /**\n   * Format timestamp to human-readable format\n   */\n  private formatTimestamp(isoString: string): string {\n    try {\n      const date = new Date(isoString);\n      const now = new Date();\n      const diffMs = now.getTime() - date.getTime();\n      const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));\n\n      if (diffDays === 0) {\n        return 'Today';\n      } else if (diffDays === 1) {\n        return 'Yesterday';\n      } else if (diffDays < 7) {\n        return `${diffDays} days ago`;\n      } else if (diffDays < 30) {\n        const weeks = Math.floor(diffDays / 7);\n        return `${weeks} week${weeks > 1 ? 's' : ''} ago`;\n      } else {\n        return date.toLocaleDateString('en-US', {\n          year: 'numeric',\n          month: 'short',\n          day: 'numeric'\n        });\n      }\n    } catch (error) {\n      return isoString;\n    }\n  }\n\n  /**\n   * Generate dashboard artifact for UI rendering\n   * Requirements: 2.1, 2.2, 2.5\n   */\n  async generateDashboardArtifact(sessionId?: string): Promise<{\n    success: boolean;\n    message: string;\n    artifacts: any[];\n    projectCount: number;\n  }> {\n    try {\n      console.log('[ProjectListHandler] Generating dashboard artifact');\n      \n      // Get all projects from ProjectStore\n      const allProjects = await this.projectStore.list();\n      \n      // Even if no projects, still generate dashboard artifact (empty dashboard)\n      const hasProjects = allProjects.length > 0;\n\n      // Get active project from SessionContextManager\n      let activeProjectName: string | undefined;\n      if (sessionId && hasProjects) {\n        try {\n          activeProjectName = await this.sessionContextManager.getActiveProject(sessionId);\n          console.log('[ProjectListHandler] Active project:', activeProjectName);\n        } catch (error) {\n          console.warn('[ProjectListHandler] Could not get active project:', error);\n        }\n      }\n\n      // Detect duplicates (projects within 1km radius)\n      const duplicateGroups = hasProjects ? this.detectDuplicates(allProjects) : [];\n      console.log('[ProjectListHandler] Found', duplicateGroups.length, 'duplicate groups');\n\n      // Create dashboard data with all required fields\n      const dashboardData = {\n        projects: allProjects.map(project => ({\n          name: project.project_name,\n          location: this.formatLocation(project.coordinates),\n          completionPercentage: this.calculateCompletionPercentage(project),\n          lastUpdated: project.updated_at,\n          isActive: project.project_name === activeProjectName,\n          isDuplicate: this.isProjectDuplicate(project, duplicateGroups),\n          status: this.getProjectStatusLabel(project)\n        })),\n        totalProjects: allProjects.length,\n        activeProject: activeProjectName || null,\n        duplicateGroups: duplicateGroups.map(group => ({\n          location: this.formatLocation(group.coordinates),\n          count: group.projects.length,\n          projects: group.projects.map(p => ({\n            project_name: p.project_name,\n            coordinates: p.coordinates\n          }))\n        }))\n      };\n\n      // Create artifact structure\n      const artifact = {\n        type: 'project_dashboard',\n        title: 'Renewable Energy Projects Dashboard',\n        data: dashboardData\n      };\n\n      console.log('[ProjectListHandler] Dashboard artifact generated successfully');\n\n      const message = hasProjects \n        ? `Found ${allProjects.length} renewable energy project${allProjects.length !== 1 ? 's' : ''}.`\n        : 'You don\\'t have any renewable energy projects yet.';\n\n      return {\n        success: true,\n        message,\n        artifacts: [artifact],\n        projectCount: allProjects.length\n      };\n\n    } catch (error) {\n      console.error('[ProjectListHandler] Error generating dashboard artifact:', error);\n      return {\n        success: false,\n        message: 'Failed to load project dashboard.',\n        artifacts: [],\n        projectCount: 0\n      };\n    }\n  }\n\n  /**\n   * Detect duplicate projects within 1km radius\n   * Requirements: 2.3\n   */\n  private detectDuplicates(projects: ProjectData[]): Array<{\n    coordinates: { latitude: number; longitude: number };\n    projects: ProjectData[];\n  }> {\n    const duplicateGroups: Array<{\n      coordinates: { latitude: number; longitude: number };\n      projects: ProjectData[];\n    }> = [];\n    \n    const processed = new Set<string>();\n\n    for (const project of projects) {\n      // Skip if no coordinates or already processed\n      if (!project.coordinates || processed.has(project.project_name)) {\n        continue;\n      }\n\n      // Find all projects within 1km\n      const nearby = projects.filter(p => {\n        if (!p.coordinates || p.project_name === project.project_name) {\n          return false;\n        }\n\n        const distance = this.calculateDistance(\n          project.coordinates.latitude,\n          project.coordinates.longitude,\n          p.coordinates.latitude,\n          p.coordinates.longitude\n        );\n\n        return distance <= 1.0; // 1km radius\n      });\n\n      if (nearby.length > 0) {\n        // Found duplicates - create group\n        const group = [project, ...nearby];\n        duplicateGroups.push({\n          coordinates: project.coordinates,\n          projects: group\n        });\n\n        // Mark all as processed\n        group.forEach(p => processed.add(p.project_name));\n      }\n    }\n\n    return duplicateGroups;\n  }\n\n  /**\n   * Calculate distance between two coordinates in km using Haversine formula\n   * Requirements: 5.5\n   */\n  private calculateDistance(lat1: number, lon1: number, lat2: number, lon2: number): number {\n    const R = 6371; // Earth's radius in km\n    const dLat = (lat2 - lat1) * Math.PI / 180;\n    const dLon = (lon2 - lon1) * Math.PI / 180;\n    const a = \n      Math.sin(dLat / 2) * Math.sin(dLat / 2) +\n      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *\n      Math.sin(dLon / 2) * Math.sin(dLon / 2);\n    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));\n    return R * c;\n  }\n\n  /**\n   * Format location for display\n   * Requirements: 5.1\n   */\n  private formatLocation(coordinates?: { latitude: number; longitude: number }): string {\n    if (!coordinates) return 'Unknown';\n    return `${coordinates.latitude.toFixed(4)}, ${coordinates.longitude.toFixed(4)}`;\n  }\n\n  /**\n   * Calculate completion percentage for a project\n   * Requirements: 5.2\n   */\n  private calculateCompletionPercentage(project: ProjectData): number {\n    const steps = [\n      !!project.terrain_results,\n      !!project.layout_results,\n      !!project.simulation_results,\n      !!project.report_results\n    ];\n    const completed = steps.filter(Boolean).length;\n    return Math.round((completed / 4) * 100);\n  }\n\n  /**\n   * Check if project is in duplicate groups\n   * Requirements: 5.3\n   */\n  private isProjectDuplicate(\n    project: ProjectData,\n    duplicateGroups: Array<{ projects: ProjectData[] }>\n  ): boolean {\n    return duplicateGroups.some(group =>\n      group.projects.some(p => p.project_name === project.project_name)\n    );\n  }\n\n  /**\n   * Get project status label\n   * Requirements: 5.4\n   */\n  private getProjectStatusLabel(project: ProjectData): string {\n    if (project.report_results) return 'Complete';\n    if (project.simulation_results) return 'Simulation Complete';\n    if (project.layout_results) return 'Layout Complete';\n    if (project.terrain_results) return 'Terrain Complete';\n    return 'Not Started';\n  }\n\n  /**\n   * Check if query is a dashboard request (requires UI artifact)\n   * Requirements: 1.1, 1.2, 1.3, 1.4\n   */\n  static isProjectDashboardQuery(query: string): boolean {\n    console.log('[ProjectListHandler] Testing dashboard query:', query);\n    \n    // Dashboard-specific patterns\n    const dashboardPatterns = [\n      /\\bshow\\b.*\\bproject\\b.*\\bdashboard\\b/i,\n      /\\bproject\\b.*\\bdashboard\\b/i,\n      /\\bdashboard\\b/i,\n      /\\bview\\b.*\\bdashboard\\b/i,\n      /\\bopen\\b.*\\bdashboard\\b/i,\n      /\\bmy\\b.*\\bdashboard\\b/i\n    ];\n\n    // Exclusion patterns - queries that should NOT trigger dashboard\n    const exclusionPatterns = [\n      /\\blist\\b/i,                          // Any \"list\" query should be text-only\n      /\\banalyze\\b/i,                       // Action verbs should not trigger dashboard\n      /\\boptimize\\b/i,\n      /\\bsimulate\\b/i,\n      /\\bgenerate\\b/i,\n      /\\bcreate\\b/i,\n      /\\brun\\b/i,\n      /\\bperform\\b/i\n    ];\n\n    // First check exclusions - if any match, reject immediately\n    for (let i = 0; i < exclusionPatterns.length; i++) {\n      if (exclusionPatterns[i].test(query)) {\n        console.log(`[ProjectListHandler] \u274C Dashboard rejected: Matched exclusion pattern ${i + 1}`);\n        return false;\n      }\n    }\n\n    // Then check dashboard patterns\n    for (let i = 0; i < dashboardPatterns.length; i++) {\n      if (dashboardPatterns[i].test(query)) {\n        console.log(`[ProjectListHandler] \u2705 Dashboard matched pattern ${i + 1}:`, dashboardPatterns[i].source);\n        return true;\n      }\n    }\n    \n    console.log('[ProjectListHandler] \u274C No dashboard patterns matched');\n    return false;\n  }\n\n  /**\n   * Check if query is a project list request\n   */\n  static isProjectListQuery(query: string): boolean {\n    console.log('[ProjectListHandler] Testing query:', query);\n    \n    // Use word boundaries to ensure exact word matches\n    const patterns = [\n      /\\blist\\b.*\\bmy\\b.*\\bprojects?\\b/i,\n      /\\bshow\\b.*\\bmy\\b.*\\bprojects?\\b/i,\n      /\\bwhat\\b.*\\bprojects?\\b.*\\bdo\\b.*\\bi\\b.*\\bhave\\b/i,\n      /\\bmy\\b.*\\brenewable\\b.*\\bprojects?\\b/i,\n      /\\ball\\b.*\\bmy\\b.*\\bprojects?\\b/i,\n      /\\bview\\b.*\\bprojects?\\b/i,\n      /\\bsee\\b.*\\bmy\\b.*\\bprojects?\\b/i\n    ];\n\n    // Additional safety check: reject if query contains action verbs\n    const actionVerbs = ['analyze', 'optimize', 'simulate', 'generate', 'create', 'run', 'perform'];\n    const lowerQuery = query.toLowerCase();\n    const hasActionVerb = actionVerbs.some(verb => lowerQuery.includes(verb));\n    \n    if (hasActionVerb) {\n      console.log('[ProjectListHandler] \u274C Rejected: Query contains action verb');\n      return false;\n    }\n\n    // Test each pattern individually for debugging\n    for (let i = 0; i < patterns.length; i++) {\n      if (patterns[i].test(query)) {\n        console.log(`[ProjectListHandler] \u2705 Matched pattern ${i + 1}:`, patterns[i].source);\n        return true;\n      }\n    }\n    \n    console.log('[ProjectListHandler] \u274C No patterns matched');\n    return false;\n  }\n\n  /**\n   * Check if query is a project details request\n   */\n  static isProjectDetailsQuery(query: string): { isMatch: boolean; projectName?: string } {\n    console.log('[ProjectListHandler] Testing project details query:', query);\n    \n    // Additional safety check: must explicitly mention \"project\"\n    if (!query.toLowerCase().includes('project')) {\n      console.log('[ProjectListHandler] \u274C No \"project\" keyword found');\n      return { isMatch: false };\n    }\n\n    // Use word boundaries to ensure exact word matches\n    const patterns = [\n      /\\bshow\\b.*\\bproject\\b\\s+([a-z0-9-]+)/i,\n      /\\bdetails\\b.*\\bfor\\b.*\\bproject\\b\\s+([a-z0-9-]+)/i,\n      /\\bproject\\b\\s+([a-z0-9-]+).*\\bdetails\\b/i,\n      /\\bview\\b.*\\bproject\\b\\s+([a-z0-9-]+)/i,\n      /\\binfo\\b.*\\babout\\b.*\\bproject\\b\\s+([a-z0-9-]+)/i,\n      /\\bstatus\\b.*\\bof\\b.*\\bproject\\b\\s+([a-z0-9-]+)/i\n    ];\n\n    for (let i = 0; i < patterns.length; i++) {\n      const match = query.match(patterns[i]);\n      if (match && match[1]) {\n        console.log(`[ProjectListHandler] \u2705 Matched pattern ${i + 1}, extracted project name:`, match[1]);\n        return {\n          isMatch: true,\n          projectName: match[1]\n        };\n      }\n    }\n\n    console.log('[ProjectListHandler] \u274C No project details patterns matched');\n    return { isMatch: false };\n  }\n}\n", "/**\n * Strands Agent Handler for Renewable Energy Orchestrator\n * \n * This handler invokes the Strands Agent system instead of individual tool Lambdas.\n * The agents handle intelligent decision-making, tool selection, and workflow orchestration.\n */\n\nimport { InvokeCommand, LambdaClient } from '@aws-sdk/client-lambda';\nimport { RenewableIntentClassifier } from './RenewableIntentClassifier';\nimport type { OrchestratorResponse } from './types';\n\ninterface StrandsAgentEvent {\n  userMessage: string;\n  chatSessionId: string;\n  projectContext: Record<string, any>;\n}\n\nconst lambda = new LambdaClient({});\nconst intentClassifier = new RenewableIntentClassifier();\n\n// Get Strands Agent function name from environment\nconst STRANDS_AGENT_FUNCTION_NAME = process.env.RENEWABLE_AGENTS_FUNCTION_NAME;\n\n/**\n * Invoke the Strands Agent system asynchronously\n * \n * Uses Event invocation type to avoid timeout issues.\n * The agent will write progress to DynamoDB which can be polled.\n */\nasync function invokeStrandsAgentAsync(\n  agentType: 'multi' | 'terrain' | 'layout' | 'simulation' | 'report',\n  query: string,\n  parameters: Record<string, any>,\n  requestId: string\n): Promise<void> {\n  \n  if (!STRANDS_AGENT_FUNCTION_NAME) {\n    throw new Error('RENEWABLE_AGENTS_FUNCTION_NAME environment variable not set');\n  }\n\n  const payload = {\n    agent: agentType,\n    query,\n    parameters,\n    requestId  // Include requestId for progress tracking\n  };\n\n  console.log(`\uD83D\uDE80 Invoking Strands Agent ASYNC (${agentType})`);\n  console.log(`   Request ID: ${requestId}`);\n  console.log(`   Query: ${query.substring(0, 200)}`);\n\n  const command = new InvokeCommand({\n    FunctionName: STRANDS_AGENT_FUNCTION_NAME,\n    InvocationType: 'Event',  // \u2190 ASYNC INVOCATION\n    Payload: JSON.stringify(payload),\n  });\n\n  await lambda.send(command);\n  \n  console.log(`\u2705 Async invocation started for request ${requestId}`);\n}\n\n/**\n * Main handler using Strands Agents\n */\nexport async function handleWithStrandsAgents(\n  event: StrandsAgentEvent\n): Promise<OrchestratorResponse> {\n  \n  const { userMessage, chatSessionId, projectContext } = event;\n\n  console.log('=== Strands Agent Handler ===');\n  console.log('User message:', userMessage);\n  console.log('Project context:', JSON.stringify(projectContext, null, 2));\n\n  try {\n    // Classify intent\n    const intent = intentClassifier.classifyIntent(userMessage);\n    console.log('Classified intent:', intent.intent);\n\n    // Build parameters from project context\n    const parameters: Record<string, any> = {\n      chat_session_id: chatSessionId,\n      ...projectContext\n    };\n\n    // Route to appropriate agent based on intent\n    let agentType: 'multi' | 'terrain' | 'layout' | 'simulation' | 'report';\n    let agentQuery = userMessage;\n\n    switch (intent.intent) {\n      case 'terrain_analysis':\n        agentType = 'terrain';\n        break;\n      \n      case 'layout_optimization':\n        agentType = 'layout';\n        break;\n      \n      case 'wake_simulation':\n      case 'wind_rose':\n        agentType = 'simulation';\n        break;\n      \n      case 'report_generation':\n        agentType = 'report';\n        break;\n      \n      case 'complete_workflow':\n        // Use multi-agent for complete workflows\n        agentType = 'multi';\n        break;\n      \n      default:\n        // For unknown intents, use multi-agent to figure it out\n        agentType = 'multi';\n    }\n\n    console.log(`Routing to ${agentType} agent`);\n\n    // Generate unique request ID for tracking\n    const requestId = chatSessionId || `req-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n\n    // Invoke Strands Agent asynchronously\n    await invokeStrandsAgentAsync(agentType, agentQuery, parameters, requestId);\n\n    // Return immediately with polling instructions\n    const estimatedTime = getEstimatedTime(agentType);\n    \n    return {\n      success: true,\n      message: `\uD83D\uDE80 ${getAgentDisplayName(agentType)} analysis started. This may take ${estimatedTime}...`,\n      artifacts: [],\n      thoughtSteps: [{\n        step: 1,\n        action: 'Starting analysis',\n        reasoning: `Invoking ${getAgentDisplayName(agentType)} with async pattern`,\n        status: 'in_progress',\n        timestamp: new Date().toISOString(),\n        duration: 0\n      }],\n      metadata: {\n        executionTime: 0,\n        toolsUsed: [`strands_${agentType}_agent`],\n        requestId,\n        polling: {\n          enabled: true,\n          interval: 5000,  // Poll every 5 seconds\n          maxAttempts: 36  // 3 minutes max (36 * 5s = 180s)\n        }\n      }\n    };\n\n  } catch (error: any) {\n    console.error('Error in Strands Agent handler:', error);\n    \n    // Check if this is a timeout or throttling error that should trigger fallback\n    const errorMessage = error.message || String(error);\n    const isTimeoutError = errorMessage.includes('timeout') || \n                          errorMessage.includes('Timeout') ||\n                          errorMessage.includes('timed out');\n    const isThrottlingError = error.name === 'TooManyRequestsException' ||\n                             errorMessage.includes('TooManyRequestsException') ||\n                             errorMessage.includes('Rate exceeded');\n    \n    if (isTimeoutError || isThrottlingError) {\n      // Re-throw to trigger fallback in main handler\n      throw error;\n    }\n    \n    // For other errors, return error response\n    return {\n      success: false,\n      message: `Agent error: ${error instanceof Error ? error.message : String(error)}`,\n      artifacts: [],\n      thoughtSteps: [],\n      metadata: {\n        executionTime: 0,\n        toolsUsed: [],\n        requestId: chatSessionId\n      }\n    };\n  }\n}\n\n/**\n * Get estimated time for agent execution\n */\nfunction getEstimatedTime(agentType: string): string {\n  const estimates: Record<string, string> = {\n    terrain: '30-45 seconds',\n    layout: '45-60 seconds',\n    simulation: '60-90 seconds',\n    report: '30-45 seconds',\n    multi: '3-4 minutes'\n  };\n  return estimates[agentType] || '1-2 minutes';\n}\n\n/**\n * Get display name for agent type\n */\nfunction getAgentDisplayName(agentType: string): string {\n  const names: Record<string, string> = {\n    terrain: 'Terrain Analysis',\n    layout: 'Layout Optimization',\n    simulation: 'Wake Simulation',\n    report: 'Report Generation',\n    multi: 'Complete Workflow'\n  };\n  return names[agentType] || 'Analysis';\n}\n\n/**\n * Check if Strands Agents are available\n * \n * Checks for RENEWABLE_AGENTS_FUNCTION_NAME environment variable.\n * Agents will use async invocation pattern to handle long execution times.\n */\nexport function isStrandsAgentAvailable(): boolean {\n  const isAvailable = !!STRANDS_AGENT_FUNCTION_NAME;\n  \n  if (isAvailable) {\n    console.log('\u2705 Strands Agents ENABLED - Function:', STRANDS_AGENT_FUNCTION_NAME);\n  } else {\n    console.log('\u26A0\uFE0F  Strands Agents DISABLED - RENEWABLE_AGENTS_FUNCTION_NAME not set');\n  }\n  \n  return isAvailable;\n}\n"],
  "mappings": "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",
  "names": ["ProjectLifecycleError", "import_client_lambda", "projects", "ProjectLifecycleManager", "S3Client", "GetObjectCommand", "result"]
}
