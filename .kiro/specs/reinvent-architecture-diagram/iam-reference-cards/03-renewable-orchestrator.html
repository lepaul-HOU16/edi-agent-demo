<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IAM Reference Card - Renewable Orchestrator</title>
    <style>
        @page {
            size: letter;
            margin: 0.5in;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 8.5in;
            margin: 0 auto;
            padding: 20px;
            background: white;
            color: #232f3e;
        }
        
        .header {
            background: linear-gradient(135deg, #232f3e 0%, #ff9900 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .header h1 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        
        .header .subtitle {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .section {
            margin-bottom: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 15px;
        }
        
        .section h2 {
            margin: 0 0 15px 0;
            font-size: 18px;
            color: #232f3e;
            border-bottom: 2px solid #ff9900;
            padding-bottom: 5px;
        }
        
        .permission-item {
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-left: 4px solid #ff9900;
            border-radius: 4px;
        }
        
        .permission-item.required {
            border-left-color: #d13212;
        }
        
        .permission-item.optional {
            border-left-color: #1d8102;
        }
        
        .permission-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .permission-action {
            font-family: 'Courier New', monospace;
            font-weight: bold;
            font-size: 14px;
        }
        
        .badge {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge.required {
            background: #d13212;
            color: white;
        }
        
        .badge.optional {
            background: #1d8102;
            color: white;
        }
        
        .permission-resource {
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: #545b64;
            margin-top: 5px;
        }
        
        .permission-description {
            font-size: 13px;
            color: #545b64;
            margin-top: 5px;
        }
        
        .code-block {
            background: #232f3e;
            color: #ffffff;
            padding: 15px;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 10px;
            overflow-x: auto;
            margin-top: 10px;
        }
        
        .info-box {
            background: #e7f6fd;
            border-left: 4px solid #0073bb;
            padding: 12px;
            margin: 15px 0;
            border-radius: 4px;
        }
        
        .info-box strong {
            color: #0073bb;
        }
        
        .footer {
            margin-top: 30px;
            padding-top: 15px;
            border-top: 2px solid #ddd;
            font-size: 12px;
            color: #545b64;
            text-align: center;
        }
        
        @media print {
            body {
                padding: 0;
            }
            
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üå¨Ô∏è Renewable Orchestrator IAM Permissions</h1>
        <div class="subtitle">AWS Energy Data Insights Platform | Multi-Tool Coordinator</div>
    </div>

    <div class="section">
        <h2>üìã Overview</h2>
        <p><strong>Service Role:</strong> <code>RenewableOrchestratorRole</code></p>
        <p><strong>Function Name:</strong> <code>renewable-orchestrator</code></p>
        <p><strong>Purpose:</strong> Coordinates multiple tool invocations for wind farm analysis, manages project lifecycle, and aggregates results</p>
        <p><strong>Timeout:</strong> 300 seconds | <strong>Memory:</strong> 1024 MB</p>
    </div>

    <div class="section">
        <h2>üóÑÔ∏è DynamoDB Permissions</h2>
        
        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">dynamodb:PutItem</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resources:</strong><br>
                ‚Ä¢ arn:aws:dynamodb:*:*:table/ChatMessage-*<br>
                ‚Ä¢ arn:aws:dynamodb:*:*:table/SessionContext-*<br>
                ‚Ä¢ arn:aws:dynamodb:*:*:table/AgentProgress-*
            </div>
            <div class="permission-description">
                Save AI responses with artifacts, persist session context across tool invocations, and track analysis progress for transparency.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">dynamodb:GetItem</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resources:</strong> Same as PutItem
            </div>
            <div class="permission-description">
                Retrieve session context for multi-step workflows and check existing project state before creating new analyses.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">dynamodb:Query</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resources:</strong><br>
                ‚Ä¢ arn:aws:dynamodb:*:*:table/SessionContext-*<br>
                ‚Ä¢ arn:aws:dynamodb:*:*:table/AgentProgress-*
            </div>
            <div class="permission-description">
                Query project history and progress steps for a session. Essential for maintaining context across multiple tool invocations.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">dynamodb:UpdateItem</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resources:</strong> Same as PutItem
            </div>
            <div class="permission-description">
                Update session context with new project information and mark progress steps as complete.
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üì¶ S3 Permissions</h2>
        
        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">s3:GetObject</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resource:</strong> arn:aws:s3:::storage-bucket/renewable-projects/*
            </div>
            <div class="permission-description">
                Read existing project data and artifacts from previous analyses. Required for incremental analysis workflows.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">s3:PutObject</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resource:</strong> arn:aws:s3:::storage-bucket/renewable-projects/*
            </div>
            <div class="permission-description">
                Store aggregated analysis results and project metadata. Critical for artifact persistence and retrieval.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">s3:ListBucket</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resource:</strong> arn:aws:s3:::storage-bucket
            </div>
            <div class="permission-description">
                List objects in project directories to check for existing analyses and avoid duplicate work.
            </div>
        </div>
    </div>

    <div class="section">
        <h2>‚ö° Lambda Invocation Permissions</h2>
        
        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">lambda:InvokeFunction</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resources:</strong><br>
                ‚Ä¢ arn:aws:lambda:*:*:function:renewable-tools-terrain<br>
                ‚Ä¢ arn:aws:lambda:*:*:function:renewable-tools-layout<br>
                ‚Ä¢ arn:aws:lambda:*:*:function:renewable-tools-simulation<br>
                ‚Ä¢ arn:aws:lambda:*:*:function:renewable-tools-report<br>
                ‚Ä¢ arn:aws:lambda:*:*:function:renewable-tools-windrose
            </div>
            <div class="permission-description">
                Invoke specialized tool Lambdas for terrain analysis, layout optimization, wake simulation, report generation, and wind rose visualization. Core orchestration capability.
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üìä CloudWatch Logs Permissions</h2>
        
        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">logs:CreateLogGroup</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resource:</strong> arn:aws:logs:*:*:log-group:/aws/lambda/renewable-orchestrator:*
            </div>
            <div class="permission-description">
                Standard Lambda logging permission for CloudWatch log group creation.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">logs:CreateLogStream</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resource:</strong> arn:aws:logs:*:*:log-group:/aws/lambda/renewable-orchestrator:*
            </div>
            <div class="permission-description">
                Create log streams for each orchestration workflow. Essential for debugging multi-tool coordination.
            </div>
        </div>

        <div class="permission-item required">
            <div class="permission-header">
                <span class="permission-action">logs:PutLogEvents</span>
                <span class="badge required">Required</span>
            </div>
            <div class="permission-resource">
                <strong>Resource:</strong> arn:aws:logs:*:*:log-group:/aws/lambda/renewable-orchestrator:*
            </div>
            <div class="permission-description">
                Write orchestration logs including tool invocation results and error details. Critical for troubleshooting.
            </div>
        </div>
    </div>

    <div class="section">
        <h2>üìÑ Complete IAM Policy JSON</h2>
        <div class="code-block">{
  "Version": "2012-10-17",
  "Statement": [
    {
      "Effect": "Allow",
      "Action": [
        "dynamodb:PutItem",
        "dynamodb:GetItem",
        "dynamodb:Query",
        "dynamodb:UpdateItem"
      ],
      "Resource": [
        "arn:aws:dynamodb:*:*:table/ChatMessage-*",
        "arn:aws:dynamodb:*:*:table/SessionContext-*",
        "arn:aws:dynamodb:*:*:table/AgentProgress-*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "s3:GetObject",
        "s3:PutObject",
        "s3:ListBucket"
      ],
      "Resource": [
        "arn:aws:s3:::storage-bucket",
        "arn:aws:s3:::storage-bucket/renewable-projects/*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": "lambda:InvokeFunction",
      "Resource": [
        "arn:aws:lambda:*:*:function:renewable-tools-*"
      ]
    },
    {
      "Effect": "Allow",
      "Action": [
        "logs:CreateLogGroup",
        "logs:CreateLogStream",
        "logs:PutLogEvents"
      ],
      "Resource": "arn:aws:logs:*:*:log-group:/aws/lambda/renewable-orchestrator:*"
    }
  ]
}</div>
    </div>

    <div class="info-box">
        <strong>üí° Orchestration Pattern:</strong> This Lambda coordinates 5 specialized tool Lambdas in sequence or parallel depending on the analysis workflow. It maintains project state across invocations and aggregates results into a cohesive response with multiple artifacts.
    </div>

    <div class="section">
        <h2>üîÑ Typical Orchestration Flow</h2>
        <ol>
            <li>Receive wind farm analysis request from chat Lambda</li>
            <li>Parse intent and extract parameters (location, radius, etc.)</li>
            <li>Check SessionContext for existing project</li>
            <li>Invoke terrain analysis tool Lambda</li>
            <li>Store terrain results in S3 and DynamoDB</li>
            <li>Invoke layout optimization tool Lambda (uses terrain data)</li>
            <li>Invoke wake simulation tool Lambda (uses layout data)</li>
            <li>Invoke report generation tool Lambda (aggregates all data)</li>
            <li>Update SessionContext with project information</li>
            <li>Return aggregated response with all artifacts</li>
        </ol>
    </div>

    <div class="footer">
        <p>AWS Energy Data Insights Platform | re:Invent Chalk Talk | IAM Reference Card 3 of 5</p>
        <p>Generated: 2025-01-15 | Version 1.0</p>
    </div>
</body>
</html>
